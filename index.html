<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CEK KESEHATAN LAMBUNG</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        /* Styling tambahan untuk hasil analisa agar lebih rapi di WhatsApp (opsional, untuk tampilan di web) */
        .whatsapp-pre {
            white-space: pre-wrap; /* Mempertahankan spasi dan baris baru */
            font-family: monospace; /* Font monospasi agar format lebih konsisten */
        }
        /* Style untuk tingkat keparahan */
        #tingkatKeparahanText {
            font-weight: bold;
        }
        /* Styles untuk elemen yang ditambahkan via JS */
        .analysis-results-card .final-note {
            font-size: 1.1em;
            font-weight: bold;
            text-align: center;
            margin-top: 25px;
            color: #28a745; /* Warna hijau untuk pesan positif */
        }
        .analysis-results-card .whatsapp-call-to-action {
            font-size: 1.0em; /* Disesuaikan agar tidak terlalu besar */
            font-weight: bold;
            text-align: center;
            margin-top: 10px; /* Disesuaikan margin */
        }
        .analysis-results-card .whatsapp-call-to-action a {
            color: #25D366; /* Warna hijau WhatsApp untuk link */
            text-decoration: none;
        }
        .analysis-results-card .whatsapp-call-to-action a:hover {
            text-decoration: underline;
        }
        .analysis-results-card .whatsapp-call-to-action.warning {
            color: #dc3545; /* Warna merah untuk peringatan */
        }
        /* Style untuk produk unggulan (featured) */
        .product.featured {
            border: 2px solid #25D366; /* Contoh border untuk produk unggulan */
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
        }
        .product-catalog {
            display: flex;
            overflow-x: auto;
            scroll-behavior: smooth;
            padding: 10px 0;
            gap: 20px;
            -webkit-overflow-scrolling: touch; /* Untuk smooth scrolling di iOS */
        }
        .product {
            flex: 0 0 auto; /* Penting untuk mencegah item mengecil */
            width: 250px; /* Lebar setiap produk */
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .product img {
            max-width: 100%;
            height: 150px; /* Atur tinggi gambar agar seragam */
            object-fit: contain; /* Memastikan gambar pas tanpa terdistorsi */
            margin-bottom: 10px;
        }
        .product h3 {
            font-size: 1.2em;
            margin-bottom: 5px;
            color: #333;
        }
        .product p {
            font-size: 0.9em;
            color: #666;
            min-height: 80px; /* Tinggi minimum untuk deskripsi */
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 4; /* Batasi 4 baris */
            -webkit-box-orient: vertical;
        }
        /* Carousel Navigation */
        .carousel-container {
            position: relative;
            margin: 20px 0;
        }
        .carousel-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            z-index: 10;
            border-radius: 50%;
            font-size: 1.5em;
            line-height: 1; /* Agar simbol panah di tengah */
            height: 40px;
            width: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .carousel-button.left {
            left: 5px;
        }
        .carousel-button.right {
            right: 5px;
        }
        .carousel-button:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }

        /* Menyamakan ukuran tombol Konsultasi dengan Cek Hasil */
        #konsultasiWaButton {
            padding: 15px 30px; /* Sesuaikan dengan tombol cek hasil */
            font-size: 1.2em; /* Sesuaikan dengan tombol cek hasil */
            background-color: #25D366; /* Warna WhatsApp hijau */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%; /* Atau sesuaikan lebar yang diinginkan */
            max-width: 300px; /* Batasi lebar maksimum agar tidak terlalu besar di desktop */
            box-sizing: border-box; /* Pastikan padding termasuk dalam lebar */
            margin-top: 20px; /* Memberi sedikit jarak dari hasil analisa */
        }

        #konsultasiWaButton:hover {
            background-color: #1DA851; /* Warna hover WhatsApp */
        }

        /* Tombol Cek Hasil tetap berwarna hijau */
        #cekButton {
            padding: 15px 30px;
            font-size: 1.2em;
            width: 100%;
            max-width: 300px;
            box-sizing: border-box;
            background-color: #28a745; /* Warna hijau untuk tombol cek hasil */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #cekButton:hover {
            background-color: #218838; /* Warna hijau gelap saat hover */
        }

        /* Container untuk tombol agar di tengah */
        .tombol-container {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px; /* Tambahkan margin bawah untuk jarak ke elemen selanjutnya */
        }

        /* ----- Penyesuaian Ukuran Font di Beberapa Bagian ----- */
        body {
            font-size: 16px; /* Ukuran font dasar untuk body, bisa diubah sesuai keinginan */
        }

        h1 {
            font-size: 2.2em; /* Contoh: 2.2 * 16px = 35.2px */
        }

        h2 {
            font-size: 1.8em; /* Contoh: 1.8 * 16px = 28.8px */
            margin-bottom: 15px; /* Tambahkan sedikit jarak bawah */
        }

        p {
            font-size: 1.1em; /* Contoh: 1.1 * 16px = 17.6px */
            line-height: 1.6; /* Tinggikan baris untuk readability */
        }

        label {
            font-size: 1.1em; /* Ukuran font untuk label checkbox dan input */
            margin-bottom: 5px; /* Sedikit jarak antar label */
            display: inline-block; /* Agar margin-bottom berfungsi */
        }

        /* Perubahan di sini: Hapus max-width untuk input number dan select */
        input[type="number"],
        select {
            padding: 10px;
            font-size: 1.1em; /* Ukuran font untuk input angka dan select */
            border-radius: 5px;
            border: 1px solid #ccc;
            width: 100%; /* Tetap 100% */
            /* max-width: 300px; <--- DIHAPUS */
            box-sizing: border-box;
        }

        /* Menyesuaikan ukuran checkbox */
        input[type="checkbox"] {
            transform: scale(1.2); /* Memperbesar checkbox */
            margin-right: 8px; /* Memberi jarak antara checkbox dan teks label */
            vertical-align: middle; /* Agar sejajar dengan teks */
        }

        .checkbox-columns label {
            margin-bottom: 10px; /* Jarak antar item checkbox */
        }

        /* Untuk hasil penilaian */
        #hasilPenilaian p,
        #hasilPenilaian ul li {
            font-size: 1.1em;
        }
        #hasilPenilaian h3,
        #hasilPenilaian h4 {
            font-size: 1.4em;
        }
    </style>
</head>
<body>
    <header>
        <h1>CEK KESEHATAN LAMBUNG</h1>
        <p>Nyeri ulu hati, kembung dan Mual adalah gejala umum dari *Gastritis (Maag)*</p>
    </header>

    <section class="age-check">
        <h2>Usia Anda</h2>
        <form id="ageForm">
            <label for="age">Umur Anda:</label>
            <input type="number" id="age" name="age" min="1" max="120" required />
        </form>
        <p id="ageMessage"></p>
    </section>

    <section class="symptoms">
        <h2>Pilih Gejala yang Anda Alami</h2>
        <form id="symptomForm">
            <div class="checkbox-columns">
                <div class="left-column">
                    <label><input type="checkbox" name="gejala" value="Perut kembung" /> Perut kembung</label><br />
                    <label><input type="checkbox" name="gejala" value="Dada terasa panas (heartburn)" /> Dada terasa panas (heartburn)</label><br />
                    <label><input type="checkbox" name="gejala" value="Asam naik ke tenggorokan" /> Asam naik ke tenggorongan</label><br />
                    <label><input type="checkbox" name="gejala" value="Mual/muntah" /> Mual/muntah</label><br />
                    <label><input type="checkbox" name="gejala" value="Sering sendawa" /> Sering sendawa</label><br />
                    <label><input type="checkbox" name="gejala" value="Tenggorokan Gatal atau Batuk Kering" /> Tenggorokan Gatal atau Batuk Kering</label><br />
                </div>
                <div class="right-column">
                    <label><input type="checkbox" name="gejala" value="Sesak Nafas Terutama Malam" /> Sesak Nafas Terutama Malam</label><br />
                    <label><input type="checkbox" name="gejala" value="Pusing atau Kepala Ringan" /> Pusing atau Kepala Ringan</label><br />
                    <label><input type="checkbox" name="gejala" value="Merasa ingin Pingsan" /> Merasa ingin Pingsan</label><br />
                    <label><input type="checkbox" name="gejala" value="Dada tertekan seperti Serangan Jantung" /> Dada tertekan seperti Serangan Jantung</label><br />
                    <label><input type="checkbox" name="gejala" value="Nafas Pendek/Berat saat Cemas" /> Nafas Pendek/Berat saat Cemas</label><br />
                </div>
            </div>
        </form>
        <p id="symptomResult"></p>
    </section>

    <section class="mental-checklist hidden-section" id="mentalSection">
        <h2>Gejala psikologi yang Anda Rasakan</h2>
        <form id="mentalForm">
            <div class="checkbox-columns" id="mentalCheckboxesContainer">
            </div>
        </form>
    </section>

    <section class="habit-checklist hidden-section" id="habitSection">
        <h2>Kebiasaan Sehari-hari</h2>
        <form id="habitForm">
            <div class="checkbox-columns" id="habitCheckboxesContainer">
            </div>
        </form>
    </section>

    <section class="impact-checklist hidden-section" id="impactSection">
        <h2>Dampak yang Anda Alami</h2>
        <form id="impactForm">
            <div class="checkbox-columns" id="impactCheckboxesContainer">
            </div>
        </form>
    </section>

    <section class="duration-select hidden-section" id="durationSection">
        <h2>Berapa Lama Gejala Dialami?</h2>
        <form id="durationForm">
            <select id="duration" name="duration" required>
                <option value="" disabled selected>Pilih Durasi</option>
                <option value="<<1 minggu"> << 1 minggu</option>
                <option value="1-3 minggu">1-4 minggu</option>
                <option value="1-3 bulan">1-3 bulan</option>
                <option value=">> 3 bulan">>> 3 bulan</option>
                <option value="1 tahun">1 tahun</option>
                <option value="2 tahun">2 tahun</option>
                <option value="3 tahun">3 tahun</option>
                <option value="Lebih dari 3 tahun">Lebih dari 3 tahun</option>
            </select>
        </form>
        <p id="durationResult"></p>
    </section>

    <div class="tombol-container">
        <button id="cekButton">Cek Hasil</button>
    </div>

    <div id="hasilPenilaian" class="hasil-container" style="display: none;"></div>

    <div class="tombol-container" id="konsultasiButtonContainer" style="display: none;">
        <button id="konsultasiWaButton">Konsultasi via WhatsApp</button>
    </div>

    <section class="menu">
        <h2>Katalog Produk Tiens</h2>
        <div class="carousel-container">
            <button class="carousel-button left" onclick="scrollCarousel('left')">&#10094;</button>
            <div class="product-catalog" id="tiensProductCatalog">
            </div>
            <button class="carousel-button right" onclick="scrollCarousel('right')">&#10095;</button>
        </div>
    </section>

    <footer>
        <p>TERIMAKASIH TELAH BERKUNJUNG DAN MEMPERCAI KAMI</p>
        <p>&copy; SEMOGA LEKAS SEMBUH</p>
    </footer>

    <script>
        // Data lengkap produk Tiens
        const tiensProducts = [
            {
                id: "Nutrient Super Calcium Powder",
                name: "Nutrient Super Calcium Powder",
                image: "images/calcium.jpg", // PASTIKAN PATH INI BENAR
                description: "Suplemen kalsium tinggi untuk kesehatan tulang, gigi, dan mendukung fungsi tubuh. Dapat membantu menetralkan asam lambung."
            },
            {
                id: "Zinc Capsules",
                name: "Zinc Capsules",
                image: "images/zinc.jpg", // PASTIKAN PATH INI BENAR
                description: "Meningkatkan daya tahan tubuh, membantu regenerasi sel, dan penting untuk penyembuhan luka termasuk di saluran pencernaan."
            },
            {
                id: "Chitin Chitosan Capsules",
                name: "Chitin Chitosan Capsules",
                image: "images/chitosan.jpg", // PASTIKAN PATH INI BENAR
                description: "Serat alami yang membantu detoksifikasi, mengikat lemak, dan mendukung kesehatan pencernaan secara menyeluruh."
            }
        ];

        // Definisikan semua opsi checkbox untuk masing-masing kategori
        const allMentalSymptoms = [
            { value: "Pikiran berlebihan", label: "Pikiran berlebihan" },
            { value: "Sering gelisah tanpa alasan", label: "Sering gelisah tanpa alasan" },
            { value: "Sulit tidur", label: "Sulit tidur" },
            { value: "Sering merasa takut atau panik", label: "Sering merasa takut atau panik" },
            { value: "Bangun tidur dengan rasa cemas", label: "Bangun tidur dengan rasa cemas" },
            { value: "Takut makan karena takut kambuh", label: "Takut makan karena takut kambuh" },
            { value: "Ketergantungan pada obat-obatan", label: "Ketergantungan pada obat-obatan (antacid/obat lambung)" }
        ];

        const allHabits = [
            { value: "Makan tidak teratur", label: "Makan tidak teratur" },
            { value: "Sering makan pedas/berminyak", label: "Sering makan pedas/berminyak" },
            { value: "Sering minum kopi, soda, teh kental", label: "Sering minum kopi, soda, teh kental" },
            { value: "Suka rebahan langsung setelah makan", label: "Suka rebahan langsung setelah makan" },
            { value: "Sering begadang", label: "Sering begadang" },
            { value: "Jarang olahraga", label: "Jarang olahraga" },
            { value: "Merokok", label: "Merokok" },
            { value: "Sering konsumsi obat kimia", label: "Sering konsumsi obat kimia (NSAID, antibiotik, dll)" }
        ];

        const allImpacts = [
            { value: "Tidak nyaman saat ibadah/aktivitas sosial", label: "Tidak nyaman saat ibadah/aktivitas sosial" },
            { value: "Kehilangan nafsu makan", label: "Kehilangan nafsu makan" },
            { value: "Berat badan turun drastis", label: "Berat badan turun drastis" },
            { value: "Ketakutan berlebihan untuk kambuh", label: "Ketakutan berlebihan untuk kambuh" },
            { value: "Sudah konsultasi ke dokter tapi tetap kambuh", label: "Sudah konsultasi ke dokter tapi tetap kambuh" },
            { value: "Pernah dirawat karena asam lambung/GERD", label: "Pernah dirawat karena asam lambung/GERD" }
        ];

        // Variabel global untuk menyimpan teks hasil analisa
        let currentAnalysisResultText = "";

        // Variabel global untuk menyimpan daftar gejala yang dipilih dalam format teks
        let selectedSymptomsDetails = {
            fisik: "",
            mental: "",
            habit: "",
            impact: ""
        };

        // Fungsi untuk menampilkan katalog produk Tiens dalam carousel
        function displayTiensProducts(featuredProductIds = []) {
            console.log("Fungsi displayTiensProducts dipanggil!");
            const catalogContainer = document.getElementById('tiensProductCatalog');
            if (!catalogContainer) {
                console.error("Elemen 'tiensProductCatalog' tidak ditemukan!");
                return;
            }
            catalogContainer.innerHTML = '';

            const sortedProducts = [...tiensProducts].sort((a, b) => {
                const aIsFeatured = featuredProductIds.includes(a.id);
                const bIsFeatured = featuredProductIds.includes(b.id);

                if (aIsFeatured && !bIsFeatured) return -1;
                if (!aIsFeatured && bIsFeatured) return 1;
                return 0;
            });

            sortedProducts.forEach(product => {
                const productDiv = document.createElement('div');
                productDiv.classList.add('product');
                if (featuredProductIds.includes(product.id)) {
                    productDiv.classList.add('featured');
                }

                productDiv.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" />
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                `;
                catalogContainer.appendChild(productDiv);
            });

            // Otomatis scroll ke produk unggulan jika ada
            if (featuredProductIds.length > 0) {
                setTimeout(() => {
                    const firstFeaturedElement = catalogContainer.querySelector('.product.featured');
                    if (firstFeaturedElement) {
                        const carouselParent = firstFeaturedElement.closest('.carousel-container');
                        if (carouselParent) {
                            const carouselTrack = carouselParent.querySelector('.product-catalog');
                            // Scroll ke tengah elemen yang di-featured
                            carouselTrack.scrollLeft = firstFeaturedElement.offsetLeft - (carouselTrack.offsetWidth / 2) + (firstFeaturedElement.offsetWidth / 2);
                        }
                    }
                }, 100); // Sedikit delay untuk memastikan rendering
            }
        }

        // Fungsi untuk scroll carousel
        function scrollCarousel(direction) {
            const carousel = document.getElementById('tiensProductCatalog');
            if (!carousel) {
                console.error("Elemen 'tiensProductCatalog' tidak ditemukan untuk scroll!");
                return;
            }
            const scrollAmount = 300;

            if (direction === 'left') {
                carousel.scrollBy({
                    left: -scrollAmount,
                    behavior: 'smooth'
                });
            } else {
                carousel.scrollBy({
                    left: scrollAmount,
                    behavior: 'smooth'
                });
            }
        }

        // Fungsi untuk merender checkbox
        function renderCheckboxes(containerId, checkboxesData, nameAttribute, checkedValues = []) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`Elemen '${containerId}' tidak ditemukan untuk merender checkbox!`);
                return;
            }
            container.innerHTML = '';

            const leftColumn = document.createElement('div');
            leftColumn.classList.add('left-column');
            const rightColumn = document.createElement('div');
            rightColumn.classList.add('right-column');

            const itemsPerColumn = Math.ceil(checkboxesData.length / 2);

            checkboxesData.forEach((item, index) => {
                const label = document.createElement('label');
                const input = document.createElement('input');
                input.type = 'checkbox';
                input.name = nameAttribute;
                input.value = item.value;
                if (checkedValues.includes(item.value)) {
                    input.checked = true;
                }
                label.appendChild(input);
                label.appendChild(document.createTextNode(` ${item.label}`));

                if (index < itemsPerColumn) {
                    leftColumn.appendChild(label);
                } else {
                    rightColumn.appendChild(label);
                }
                if ((index < itemsPerColumn && index < itemsPerColumn - 1) || (index >= itemsPerColumn && index < checkboxesData.length - 1)) {
                     const column = (index < itemsPerColumn) ? leftColumn : rightColumn;
                     if (index !== (itemsPerColumn -1) && index !== (checkboxesData.length -1) && (index + 1) % itemsPerColumn !== 0) {
                         column.appendChild(document.createElement('br'));
                     }
                 }
            });


            container.appendChild(leftColumn);
            container.appendChild(rightColumn);
        }

        // --- Logika Progresif untuk Menampilkan Bagian Form ---

        const fisikCheckboxes = document.querySelectorAll('input[name="gejala"]');
        const mentalSection = document.getElementById('mentalSection');
        const habitSection = document.getElementById('habitSection');
        const impactSection = document.getElementById('impactSection');
        const durationSection = document.getElementById('durationSection');
        const ageInput = document.getElementById('age');
        const durationSelect = document.getElementById('duration');

        const symptomForm = document.getElementById('symptomForm');
        const mentalForm = document.getElementById('mentalForm');
        const habitForm = document.getElementById('habitForm');
        const impactForm = document.getElementById('impactForm');

        let selectedMentalValues = [];
        let selectedHabitValues = [];
        let selectedImpactValues = [];


        function checkFormProgress() {
            if (!mentalSection || !habitSection || !impactSection || !durationSection || !ageInput || !durationSelect) {
                console.error("Salah satu elemen section form tidak ditemukan. Pastikan ID HTML sudah benar.");
                return;
            }

            const selectedFisik = Array.from(fisikCheckboxes).some(cb => cb.checked);
            const currentMentalChecked = Array.from(document.querySelectorAll('#mentalForm input[name="mental"]:checked')).map(cb => cb.value);
            const currentHabitChecked = Array.from(document.querySelectorAll('#habitForm input[name="habit"]:checked')).map(cb => cb.value);
            const currentImpactChecked = Array.from(document.querySelectorAll('#impactForm input[name="impact"]:checked')).map(cb => cb.value);

            selectedMentalValues = currentMentalChecked;
            selectedHabitValues = currentHabitChecked;
            selectedImpactValues = currentImpactChecked;

            const hasSelectedMental = selectedMentalValues.length > 0;
            const hasSelectedHabit = selectedHabitValues.length > 0;
            const hasSelectedImpact = selectedImpactValues.length > 0;

            if (selectedFisik) {
                mentalSection.classList.remove('hidden-section');
                const checkedFisikValues = Array.from(fisikCheckboxes).filter(cb => cb.checked).map(cb => cb.value);
                let relevantMentalSymptoms = [];
                const isAnxietyRelated = checkedFisikValues.some(symptom =>
                    ["Sesak Nafas Terutama Malam", "Pusing atau Kepala Ringan", "Merasa ingin Pingsan", "Dada tertekan seperti Serangan Jantung", "Nafas Pendek/Berat saat Cemas"].includes(symptom)
                );
                const isGastricRelated = checkedFisikValues.some(symptom =>
                    ["Perut kembung", "Dada terasa panas (heartburn)", "Asam naik ke tenggorokan", "Mual/muntah", "Sering sendawa", "Tenggorokan Gatal atau Batuk Kering"].includes(symptom)
                );

                if (isAnxietyRelated && isGastricRelated) {
                    relevantMentalSymptoms = allMentalSymptoms;
                } else if (isAnxietyRelated) {
                    relevantMentalSymptoms = allMentalSymptoms.filter(symptom =>
                        ["Pikiran berlebihan", "Sering gelisah tanpa alasan", "Sulit tidur", "Sering merasa takut atau panik", "Bangun tidur dengan rasa cemas", "Takut makan karena takut kambuh"].includes(symptom.value)
                    );
                } else if (isGastricRelated) {
                    relevantMentalSymptoms = allMentalSymptoms.filter(symptom =>
                        ["Pikiran berlebihan", "Sering gelisah tanpa alasan", "Sulit tidur", "Takut makan karena takut kambuh"].includes(symptom.value)
                    );
                } else {
                    relevantMentalSymptoms = allMentalSymptoms;
                }
                renderCheckboxes('mentalCheckboxesContainer', relevantMentalSymptoms, 'mental', selectedMentalValues);

            } else {
                mentalSection.classList.add('hidden-section');
                selectedMentalValues = [];
                document.querySelectorAll('#mentalForm input[name="mental"]').forEach(cb => cb.checked = false);
            }

            if (selectedFisik && hasSelectedMental) {
                habitSection.classList.remove('hidden-section');
                renderCheckboxes('habitCheckboxesContainer', allHabits, 'habit', selectedHabitValues);
            } else {
                habitSection.classList.add('hidden-section');
                selectedHabitValues = [];
                document.querySelectorAll('#habitForm input[name="habit"]').forEach(cb => cb.checked = false);
            }

            if (selectedFisik && hasSelectedMental && hasSelectedHabit) {
                impactSection.classList.remove('hidden-section');
                renderCheckboxes('impactCheckboxesContainer', allImpacts, 'impact', selectedImpactValues);
            } else {
                impactSection.classList.add('hidden-section');
                selectedImpactValues = [];
                document.querySelectorAll('#impactForm input[name="impact"]').forEach(cb => cb.checked = false);
            }

            if (selectedFisik && hasSelectedMental && hasSelectedHabit && hasSelectedImpact) {
                durationSection.classList.remove('hidden-section');
            } else {
                durationSection.classList.add('hidden-section');
                durationSelect.value = "";
            }
        }

        ageInput.addEventListener('input', checkFormProgress);
        symptomForm.addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'gejala') {
                checkFormProgress();
            }
        });
        mentalForm.addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'mental') {
                checkFormProgress();
            }
        });
        habitForm.addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'habit') {
                checkFormProgress();
            }
        });
        impactForm.addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'impact') {
                checkFormProgress();
            }
        });
        durationSelect.addEventListener('change', checkFormProgress);


        // JavaScript logika Analisa Keparahan dan Rekomendasi
        function calculateSeverity() {
            const fisikCheckboxes = Array.from(document.querySelectorAll('input[name="gejala"]:checked'));
            const mentalCheckboxes = Array.from(document.querySelectorAll('#mentalForm input[name="mental"]:checked'));
            const habitCheckboxes = Array.from(document.querySelectorAll('#habitForm input[name="habit"]:checked'));
            const impactCheckboxes = Array.from(document.querySelectorAll('#impactForm input[name="impact"]:checked'));

            const durasiEl = document.getElementById("duration");
            const umurEl = document.getElementById("age");

            const durasi = durasiEl && durasiEl.value ? durasiEl.value : null;
            const umur = umurEl && umurEl.value ? umurEl.value : null;

            const isMentalSectionVisible = !mentalSection.classList.contains('hidden-section');
            const isHabitSectionVisible = !habitSection.classList.contains('hidden-section');
            const isImpactSectionVisible = !impactSection.classList.contains('hidden-section');
            const isDurationSectionVisible = !durationSection.classList.contains('hidden-section');

            // Validasi agar semua bagian terisi sebelum analisa
            if (!umur || umur === "" ||
                fisikCheckboxes.length === 0 ||
                (isMentalSectionVisible && selectedMentalValues.length === 0) ||
                (isHabitSectionVisible && selectedHabitValues.length === 0) ||
                (isImpactSectionVisible && selectedImpactValues.length === 0) ||
                (isDurationSectionVisible && (!durasi || durasi === ""))) {
                return { error: "Harap isi semua data dan keluhan Anda terlebih dahulu." };
            }

            // Kumpulkan detail gejala yang dipilih untuk ditampilkan dan dikirim
            selectedSymptomsDetails.fisik = fisikCheckboxes.map(cb => cb.value).join(", ");
            selectedSymptomsDetails.mental = mentalCheckboxes.map(cb => cb.value).join(", ");
            selectedSymptomsDetails.habit = habitCheckboxes.map(cb => cb.value).join(", ");
            selectedSymptomsDetails.impact = impactCheckboxes.map(cb => cb.value).join(", ");

            const fisikSkor = fisikCheckboxes.length;
            const mentalSkor = mentalCheckboxes.length;
            const habitSkor = habitCheckboxes.length;
            const impactSkor = impactCheckboxes.length;

            let durasiSkor = 0;
            if (durasi === "<<1 minggu") durasiSkor = 1;
            else if (durasi === "1-3 minggu" || durasi === "1-3 bulan") durasiSkor = 2;
            else if (
                durasi === ">> 3 bulan" ||
                durasi === "1 tahun" ||
                durasi === "2 tahun" ||
                durasi === "3 tahun" ||
                durasi === "Lebih dari 3 tahun"
            ) {
                durasiSkor = 3;
            }

            const totalSkor = fisikSkor + mentalSkor + habitSkor + impactSkor + durasiSkor;

            let diagnosis = "", deskripsi = "", tingkat = "", rekomendasiProductIds = [];

            if (totalSkor <= 7) {
                tingkat = "Ringan";
                diagnosis = "Tingkat Ringan";
                deskripsi = `
                    <p><strong>Kesimpulan:</strong><br>Gejala yang anda alami masih termasuk ringan dan bisa dikendalikan dengan pola hidup sehat dan perubahan kecil.</p>
                    <h4>Ciri-ciri umum:</h4>
                    <ul>
                        <li>Durasi gejala kurang dari 1 tahun</li>
                        <li>Gejala fisik seperti perut kembung, sendawa, atau heartburn hanya sesekali</li>
                        <li>Gejala psikologis ringan: cemas ringan, bisa tidur, gak mengganggu aktivitas harian</li>
                    </ul>
                    <h4>Saran Pola Hidup:</h4>
                    <ul>
                        <li>Perbaiki pola makan: makan lebih teratur, hindari makanan pedas dan asam</li>
                        <li>Mulai olahraga ringan (jalan pagi, stretching)</li>
                        <li>Tidur cukup dan kurangi rebahan setelah makan</li>
                    </ul>
                    <h4>Saran Produk Tiens:</h4>
                    <ul>
                        <li>Tiens Chitin Chitosan (2x sehari sebelum makan) â†’ bantu mengikat asam lambung & memperbaiki pencernaan ringan</li>
                        <li>Tiens Zinc (1x sehari sesudah makan) â†’ bantu perbaikan jaringan lambung</li>
                    </ul>
                    <p class="final-note">âœ… Lanjutkan gaya hidup sehat dan pantau gejala.</p>
                `;
                rekomendasiProductIds = ["Chitin Chitosan Capsules", "Zinc Capsules"];
            } else if (totalSkor <= 15) {
                tingkat = "Sedang";
                diagnosis = "Tingkat Sedang";
                deskripsi = `
                    <p><strong>Kesimpulan:</strong><br>Gejala GERD anxiety anda sudah mulai mengganggu aktivitas dan butuh penanganan lebih serius.</p>
                    <h4>Ciri-ciri umum:</h4>
                    <ul>
                        <li>Durasi gejala 1â€“2 tahun</li>
                        <li>Heartburn, mual, asam naik mulai sering</li>
                        <li>Gangguan tidur, cemas berlebihan, mulai takut makan</li>
                        <li>Pola makan dan gaya hidup tidak teratur</li>
                    </ul>
                    <h4>Saran Pola Hidup:</h4>
                    <ul>
                        <li>Terapkan diet lambung friendly (hindari kopi, soda, santan, gorengan)</li>
                        <li>Latih pernapasan untuk redakan anxiety</li>
                        <li>Hindari makan terlalu malam</li>
                        <li>Perbaiki jam tidur dan mulai relaksasi harian</li>
                    </ul>
                    <h4>Saran Produk Tiens:</h4>
                    <ul>
                        <li>Tiens Chitin Chitosan â†’ bantu netralkan asam lambung, detox lambung</li>
                        <li>Tiens Zinc â†’ regenerasi lapisan lambung yang terirritasi</li>
                        <li>Tiens Calcium â†’ bantu stabilkan asam lambung dan memperkuat saraf, terutama saat cemas</li>
                    </ul>
                    <p class="final-note">ðŸ”” Gejala seperti ini gak bisa dianggap enteng. Butuh terapi & suplemen rutin.</p>
                `;
                rekomendasiProductIds = ["Chitin Chitosan Capsules", "Zinc Capsules", "Nutrient Super Calcium Powder"];
            } else {
                tingkat = "Berat";
                diagnosis = "Tingkat Parah";
                deskripsi = `
                    <p><strong>Kesimpulan:</strong><br>Gejala GERD anxiety anda tergolong berat dan bisa berisiko ke gangguan fungsional/psikologis yang lebih serius.</p>
                    <h4>Ciri-ciri umum:</h4>
                    <ul>
                        <li>Sudah berlangsung lebih dari 2 tahun</li>
                        <li>Nyeri dada seperti serangan jantung</li>
                        <li>Sering pusing, mual berat, sesak napas parah terutama malam</li>
                        <li>Ketergantungan obat lambung, gangguan makan, berat badan turun</li>
                        <li>Anxiety berat: takut kambuh, panik tanpa sebab, isolasi sosial</li>
                    </ul>
                    <h4>Saran Pola Hidup:</h4>
                    <ul>
                        <li>Terapi kombinasi: relaksasi, pola makan khusus, penanganan stress</li>
                        <li>Hindari semua pemicu: kopi, rokok, begadang, junk food</li>
                        <li>Konsultasi intensif (bisa dengan psikolog atau coach anxiety lambung)</li>
                    </ul>
                    <h4>Saran Produk Tiens (WAJIB):</h4>
                    <ul>
                        <li>Tiens Chitin Chitosan (2x sehari sebelum makan)</li>
                        <li>Tiens Zinc (2x sehari setelah makan)</li>
                        <li>Tiens Calcium (1x sehari malam hari sebelum tidur)</li>
                    </ul>
                    <p class="final-note">ðŸ’¥ Kombinasi ini bantu netralkan asam, sembuhkan luka lambung, dan stabilkan sistem saraf.</p>
                    <p class="whatsapp-call-to-action warning">ðŸ›‘ Jangan tunggu makin parah. Segera atasi.</p>
                `;
                rekomendasiProductIds = ["Chitin Chitosan Capsules", "Zinc Capsules", "Nutrient Super Calcium Powder"];
            }

            return {
                umur,
                durasi,
                fisik: fisikSkor,
                mental: mentalSkor,
                habit: habitSkor,
                impact: impactSkor,
                tingkat,
                diagnosis,
                deskripsi,
                rekomendasiProductIds
            };
        }

        document.getElementById("cekButton").addEventListener("click", function () {
            const hasil = calculateSeverity();
            const hasilBox = document.getElementById("hasilPenilaian");
            const konsultasiButtonContainer = document.getElementById('konsultasiButtonContainer'); // Ambil referensi container tombol

            if (hasil.error) {
                hasilBox.innerHTML = `<h2 style="color: red;">${hasil.error}</h2>`;
                hasilBox.style.display = "block";
                konsultasiButtonContainer.style.display = "none"; // Sembunyikan tombol jika ada error
                displayTiensProducts(); // Tetap tampilkan produk default jika ada error
                return;
            }

            let output = `<h2>ðŸ“‹ Hasil Analisa </h2>`;

            if (hasil.umur) {
                output += `<p><strong>Usia:</strong> ${hasil.umur} tahun</p>`;
            }

            if (hasil.durasi) {
                output += `<p><strong>Durasi Gejala:</strong> ${hasil.durasi}</p>`;
            }

            if (selectedSymptomsDetails.fisik) {
                output += `<p><strong>Gejala Fisik:</strong> ${selectedSymptomsDetails.fisik}</p>`;
            } else {
                output += `<p><strong>Gejala Fisik:</strong> Tidak ada yang dipilih</p>`;
            }

            if (selectedSymptomsDetails.mental) {
                output += `<p><strong>Psikologis:</strong> ${selectedSymptomsDetails.mental}</p>`;
            } else {
                output += `<p><strong>Psikologis:</strong> Tidak ada yang dipilih</p>`;
            }

            if (selectedSymptomsDetails.habit) {
                output += `<p><strong>Kebiasaan Buruk:</strong> ${selectedSymptomsDetails.habit}</p>`;
            } else {
                output += `<p><strong>Kebiasaan Buruk:</strong> Tidak ada yang dipilih</p>`;
            }

            if (selectedSymptomsDetails.impact) {
                output += `<p><strong>Dampak Kehidupan:</strong> ${selectedSymptomsDetails.impact}</p>`;
            } else {
                output += `<p><strong>Dampak Kehidupan:</strong> Tidak ada yang dipilih</p>`;
            }

            output += `
                <hr>
                <p><strong>Tingkat Keparahan:</strong> <span id="tingkatKeparahanText">${hasil.tingkat}</span></p>
                <h3>ðŸ©º Diagnosis: ${hasil.diagnosis}</h3>
                ${hasil.deskripsi}
            `;

            hasilBox.innerHTML = output;
            hasilBox.style.display = "block";

            // Tampilkan tombol konsultasi setelah hasil muncul
            konsultasiButtonContainer.style.display = "block";


            const tingkatKeparahanTextElement = document.getElementById("tingkatKeparahanText");
            if (tingkatKeparahanTextElement) {
                let warna = "";
                if (hasil.tingkat === "Berat") {
                    warna = "red";
                } else if (hasil.tingkat === "Sedang") {
                    warna = "#FFA500"; // Orange
                } else if (hasil.tingkat === "Ringan") {
                    warna = "green";
                }
                tingkatKeparahanTextElement.style.color = warna;
                tingkatKeparahanTextElement.style.fontWeight = "bold";
            }

            let fullWhatsappText = `Hasil Diagnosa Kesehatan Lambung Anda:\n\n`;
            fullWhatsappText += `Usia: ${hasil.umur} tahun\n`;
            fullWhatsappText += `Durasi Gejala: ${hasil.durasi}\n`;
            fullWhatsappText += `Gejala Fisik: ${selectedSymptomsDetails.fisik || 'Tidak ada'}\n`;
            fullWhatsappText += `Psikologis: ${selectedSymptomsDetails.mental || 'Tidak ada'}\n`;
            fullWhatsappText += `Kebiasaan Buruk: ${selectedSymptomsDetails.habit || 'Tidak ada'}\n`;
            fullWhatsappText += `Dampak Kehidupan: ${selectedSymptomsDetails.impact || 'Tidak ada'}\n\n`;
            fullWhatsappText += `Tingkat Keparahan: ${hasil.tingkat}\n`;
            fullWhatsappText += `Diagnosis: ${hasil.diagnosis}\n\n`;

            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = hasil.deskripsi;
            let rawDescriptionText = tempDiv.innerText.replace(/[\u00A0\u200B-\u200D\uFEFF]/g, ' ').trim();
            rawDescriptionText = rawDescriptionText.replace(/(\r\n|\n|\r){2,}/g, '\n\n');
            rawDescriptionText = rawDescriptionText.replace(/(\s){2,}/g, ' ');
            rawDescriptionText = rawDescriptionText.replace(/^-/gm, 'â€¢');
            rawDescriptionText = rawDescriptionText.replace(/âœ…/g, 'âœ… ');
            rawDescriptionText = rawDescriptionText.replace(/ðŸ””/g, 'ðŸ”” ');
            rawDescriptionText = rawDescriptionText.replace(/ðŸ’¥/g, 'ðŸ’¥ ');
            rawDescriptionText = rawDescriptionText.replace(/ðŸ›‘/g, 'ðŸ›‘ ');

            fullWhatsappText += rawDescriptionText;

            currentAnalysisResultText = fullWhatsappText.trim();

            displayTiensProducts(hasil.rekomendasiProductIds); // Memastikan fitur ini tetap terpanggil
        });

        document.addEventListener('DOMContentLoaded', () => {
            if (mentalSection && habitSection && impactSection && durationSection) {
                mentalSection.classList.add('hidden-section');
                habitSection.classList.add('hidden-section');
                impactSection.classList.add('hidden-section');
                durationSection.classList.add('hidden-section');
            } else {
                console.error("Inisialisasi: Salah satu elemen section form tidak ditemukan.");
            }
            displayTiensProducts(); // Tampilkan produk default saat halaman pertama kali dimuat
            checkFormProgress();

            // Sembunyikan tombol konsultasi saat halaman dimuat
            const konsultasiButtonContainer = document.getElementById('konsultasiButtonContainer');
            if (konsultasiButtonContainer) {
                konsultasiButtonContainer.style.display = "none";
            }

            const konsultasiWaButton = document.getElementById('konsultasiWaButton');
            if (konsultasiWaButton) {
                konsultasiWaButton.addEventListener('click', () => {
                    const whatsappPhoneNumber = '6285721368380';
                    let messageToSend = "Halo, saya ingin konsultasi mengenai kondisi lambung saya.";

                    if (currentAnalysisResultText) {
                        messageToSend = currentAnalysisResultText;
                        messageToSend += `\n\nSaya ingin konsultasi lebih lanjut mengenai kondisi ini.`;
                    } else {
                        messageToSend += "\n\nSaya belum melakukan analisis. Bisakah Anda bantu saya memahami kondisi lambung saya?";
                    }

                    const whatsappLink = `https://wa.me/${whatsappPhoneNumber}?text=${encodeURIComponent(messageToSend)}`;
                    window.open(whatsappLink, '_blank');
                });
            }
        });
    </script>
</body>
</html>