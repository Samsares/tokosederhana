<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEK KESEHATAN LAMBUNG</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* General Styles */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #e6f7ed; /* Light green background */
            color: #333;
            line-height: 1.6;
            font-size: 15px; /* Slightly smaller base font size */
        }

        .container {
            max-width: 900px;
            margin: 25px auto; /* Increased margin for better spacing */
            background-color: #ffffff;
            padding: 35px; /* Increased padding */
            border-radius: 18px; /* More rounded corners */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* Stronger, softer shadow */
        }

        h1 {
            text-align: center;
            color: #1a5e3a; /* Darker green for heading */
            margin-bottom: 8px; /* Slightly increased margin */
            font-weight: 700;
            font-size: 2.5em; /* Larger main title */
        }

        .subtitle {
            text-align: center;
            color: #5a7d6e; /* Muted green-grey for subtitle */
            margin-bottom: 35px; /* More space below subtitle */
            font-style: italic;
            font-size: 1.1em;
        }

        h2 {
            color: #28a745; /* Vibrant green for section titles */
            border-bottom: 2px solid #b2e0c2; /* Lighter green border */
            padding-bottom: 12px; /* Increased padding */
            margin-top: 35px;
            margin-bottom: 25px;
            font-weight: 600;
            text-align: center;
            font-size: 1.8em; /* Slightly larger section titles */
        }

        h3 {
            color: #3a5c4b; /* Darker green for sub-headings */
            margin-top: 25px;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 1.3em;
        }

        p {
            margin-bottom: 12px;
        }

        /* Form Sections */
        .form-section {
            background-color: #f0fdf5; /* Very light green */
            padding: 30px;
            border-radius: 15px; /* More rounded */
            margin-bottom: 30px;
            border: 1px solid #d4ecd9; /* Light green border */
            transition: all 0.3s ease;
        }

        .form-section:hover {
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.1); /* Subtle green shadow on hover */
        }

        .form-group {
            margin-bottom: 22px; /* Increased margin */
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a6d59; /* Darker green-grey label */
            font-size: 1.05em;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            width: calc(100% - 24px); /* Adjusted width for padding */
            padding: 13px; /* Increased padding */
            border: 1px solid #c8e6c9; /* Light green border */
            border-radius: 10px; /* More rounded */
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: #ffffff;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group select:focus {
            border-color: #28a745; /* Vibrant green on focus */
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2); /* Green glow effect */
            outline: none;
        }

        /* Checkbox Grid - Modified for two columns (left and right) */
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive columns, min 280px */
            gap: 18px 35px; /* Slightly wider gap */
            justify-content: space-between;
        }

        @media (max-width: 768px) {
            .checkbox-grid {
                grid-template-columns: 1fr; /* Single column on smaller screens */
            }
        }

        .checkbox-item {
            background-color: #e6f9ed; /* Lighter green tint */
            border: 1px solid #b7e8c3; /* Soft green border */
            border-radius: 12px; /* More rounded */
            padding: 18px; /* Increased padding */
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: flex;
            align-items: center;
            font-size: 0.95em;
        }

        .checkbox-item:hover {
            background-color: #d8f0e0; /* Darker green tint on hover */
            border-color: #7bc48c; /* Stronger green border on hover */
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.1); /* Subtle shadow on hover */
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 15px;
            appearance: none;
            width: 22px; /* Slightly larger checkbox */
            height: 22px;
            border: 2px solid #28a745; /* Vibrant green border */
            border-radius: 5px; /* Slightly rounded square */
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
            background-color: #fff;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .checkbox-item input[type="checkbox"]:checked {
            background-color: #28a745; /* Vibrant green when checked */
            border-color: #28a745;
        }

        .checkbox-item input[type="checkbox"]:checked::after {
            content: 'âœ”';
            color: #fff;
            font-size: 15px; /* Larger checkmark */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .checkbox-item.checked {
            background-color: #c0f0cc; /* More pronounced green tint when checked */
            border-color: #28a745;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.15);
        }

        .checkbox-item label {
            cursor: pointer;
            font-weight: 400;
            margin-bottom: 0;
            flex-grow: 1;
            color: #333;
        }

        /* Hidden Section */
        .hidden-section {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }

        .form-section:not(.hidden-section) {
            opacity: 1;
        }

        /* Buttons */
        .button-container {
            text-align: center;
            margin-top: 40px; /* More space */
        }

        .button-container button {
            background-color: #28a745; /* Vibrant green */
            color: white;
            padding: 16px 35px; /* Larger padding */
            border: none;
            border-radius: 10px; /* More rounded */
            font-size: 19px; /* Larger font */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3); /* Subtle shadow */
        }

        .button-container button:hover {
            background-color: #218838; /* Darker green on hover */
            transform: translateY(-3px); /* More pronounced lift effect */
            box-shadow: 0 6px 15px rgba(40, 167, 69, 0.4);
        }

        .konsultasi-button-container {
            text-align: center;
            margin-top: 35px; /* More space */
        }

        .konsultasi-button-container button {
            background-color: #25D366; /* WhatsApp green */
            color: white;
            padding: 16px 35px; /* Larger padding */
            border: none;
            border-radius: 10px; /* More rounded */
            font-size: 19px; /* Larger font */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 12px; /* Increased gap for icon */
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);
        }

        .konsultasi-button-container button:hover {
            background-color: #1DA851;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(37, 211, 102, 0.4);
        }

        /* Modals (Pop-ups) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7); /* Darker overlay */
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
            backdrop-filter: blur(5px); /* Subtle blur effect */
        }

        .modal.active {
            display: flex;
        }

        #productDetailModal {
            z-index: 1001;
        }

        .modal-content {
            background-color: #fff;
            margin: auto;
            padding: 40px; /* More padding */
            border-radius: 20px; /* More rounded */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); /* Stronger shadow */
            width: 90%;
            max-width: 750px; /* Slightly wider modal */
            position: relative;
            animation: fadeInScale 0.4s ease-out; /* New animation */
            max-height: 90vh;
            overflow-y: auto;
            box-sizing: border-box;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: translateY(-30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .close-button {
            color: #888; /* Softer close button color */
            float: right;
            font-size: 38px; /* Larger close button */
            font-weight: bold;
            position: absolute;
            top: 15px;
            right: 25px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
        }

        /* Diagnosis Result Styles */
        .analysis-results-card {
            background-color: #f7feec; /* Very light green background for results */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
            border: 1px solid #dff2e1;
        }

        .user-data-display {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            background-color: #eefaf0; /* Even lighter green */
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #d9e9db;
            box-shadow: inset 0 1px 5px rgba(0,0,0,0.05);
        }

        .profile-image-container {
            width: 90px; /* Slightly larger image */
            height: 90px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 25px;
            flex-shrink: 0;
            border: 4px solid #28a745; /* Vibrant green border */
            box-shadow: 0 0 0 2px #fff, 0 0 0 6px #81c784; /* White and light green outer ring */
        }

        .profile-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-data-details {
            flex-grow: 1;
            font-size: 1.05em;
        }

        .user-data-item {
            display: flex;
            margin-bottom: 7px;
        }

        .user-data-item .label {
            font-weight: 600;
            color: #555;
            width: 110px; /* Align labels */
        }

        .user-data-item .value {
            color: #333;
        }

        #tingkatKeparahanContainer {
            padding: 20px 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        #tingkatKeparahanContainer h3 {
            margin-top: 0;
            font-size: 26px; /* Larger text */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #3a5c4b;
        }

        #tingkatKeparahanText {
            font-weight: 700;
            margin-left: 12px;
            padding: 7px 20px; /* Larger padding */
            border-radius: 8px; /* More rounded */
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            font-size: 1.1em;
        }

        #tingkatKeparahanContainer.parah {
            background-color: #ffeff0; /* Light red for parah */
            border: 1px solid #ffcdd2;
        }
        #tingkatKeparahanContainer.parah #tingkatKeparahanText {
            background-color: #e74c3c; /* Red */
        }

        #tingkatKeparahanContainer.sedang {
            background-color: #fffde7; /* Light yellow for sedang */
            border: 1px solid #ffe082;
        }
        #tingkatKeparahanContainer.sedang #tingkatKeparahanText {
            background-color: #f39c12; /* Orange */
        }

        #tingkatKeparahanContainer.ringan {
            background-color: #e8f5e9; /* Light green for ringan */
            border: 1px solid #c8e6c9;
        }
        #tingkatKeparahanContainer.ringan #tingkatKeparahanText {
            background-color: #4CAF50; /* Green */
        }

        #summaryDescriptionText {
            font-size: 1.1em; /* Slightly larger */
            color: #444;
            margin-top: 18px;
        }

        .lifestyle-tips-section ul,
        .product-benefits ul {
            list-style-type: none;
            padding: 0;
        }

        .lifestyle-tips-section ul li,
        .product-benefits ul li {
            background-color: #f5fcf7; /* Very light green for list items */
            margin-bottom: 10px;
            padding: 12px 18px; /* More padding */
            border-radius: 8px;
            display: flex;
            align-items: flex-start;
            border: 1px solid #e0f2f1; /* Subtle border */
            box-shadow: 0 1px 4px rgba(0,0,0,0.03);
            font-size: 1.0em;
        }

        .lifestyle-tips-section ul li::before,
        .product-benefits ul li::before {
            content: '\f058'; /* FontAwesome checkmark icon */
            font-family: 'Font Awesome 6 Free'; /* Make sure font awesome is loaded */
            font-weight: 900;
            color: #28a745; /* Vibrant green checkmark */
            display: inline-block;
            width: 1.2em;
            margin-left: -1.2em;
            margin-right: 12px;
            font-size: 1.1em;
        }

        .recommendation-section {
            margin-top: 35px;
            padding-top: 25px;
            border-top: 1px dashed #dce7e7; /* Lighter, dashed border */
        }

        .product-recommendations-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Larger min size */
            gap: 25px; /* Larger gap */
            margin-top: 25px;
        }

        .recommended-product-card {
            border: 1px solid #e0f0e0; /* Soft green border */
            border-radius: 15px; /* More rounded */
            padding: 20px; /* More padding */
            text-align: center;
            background-color: #ffffff; /* White background */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); /* Softer shadow */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .recommended-product-card:hover {
            transform: translateY(-7px); /* More pronounced lift */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .recommended-product-card img {
            max-width: 100%;
            height: 140px; /* Taller images */
            object-fit: contain;
            border-radius: 10px;
            margin-bottom: 15px;
            background-color: #f7fdf8; /* Light background for images */
            padding: 5px;
        }

        .recommended-product-card .product-details h4 {
            font-size: 1.15em; /* Slightly larger name */
            color: #2c3e50;
            margin-bottom: 12px;
            min-height: 45px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .recommended-product-card .product-details button {
            background-color: #3498db; /* Blue button */
            color: white;
            padding: 10px 20px; /* Larger button */
            border: none;
            border-radius: 7px; /* More rounded */
            cursor: pointer;
            font-size: 0.95em;
            transition: background-color 0.3s ease;
            width: 100%;
            font-weight: 500;
        }

        .recommended-product-card .product-details button:hover {
            background-color: #2980b9; /* Darker blue on hover */
        }

        .custom-cta-text {
            background-color: #fff3e0; /* Light orange for CTA */
            border: 1px solid #ffe0b2;
            padding: 20px;
            border-radius: 10px;
            margin-top: 35px;
            font-weight: 600;
            color: #e65100; /* Darker orange text */
            text-align: center;
            font-size: 1.1em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        /* Product Detail Modal Specific Styles */
        .product-detail-modal-content img {
            max-width: 220px; /* Larger image */
            display: block;
            margin: 0 auto 25px auto;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            background-color: #fcfcfc;
            padding: 10px;
        }

        .product-detail-modal-content h3 {
            text-align: center;
            font-size: 30px; /* Larger title */
            color: #1a5e3a; /* Dark green */
            margin-bottom: 25px;
        }

        .product-detail-modal-content .section-title {
            font-weight: 700;
            color: #3a5c4b; /* Darker green */
            margin-top: 25px;
            margin-bottom: 12px;
            border-bottom: 1px solid #e0f0e0; /* Lighter green border */
            padding-bottom: 8px;
            font-size: 1.2em;
        }

        .product-detail-modal-content p {
            font-size: 1.05em;
            line-height: 1.7;
        }

        /* Product Carousel (Horizontal Scroll) */
        .product-carousel-wrapper {
            position: relative;
            margin-top: 40px;
            padding-bottom: 20px; /* Space for scrollbar */
        }

        .product-carousel {
            display: flex; /* Use flexbox for horizontal layout */
            overflow-x: auto; /* Enable horizontal scrolling */
            scroll-snap-type: x mandatory; /* Snap to cards for smoother scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            gap: 20px; /* Gap between cards */
            padding: 15px 0; /* Padding inside the scroll area */
            border-radius: 15px;
            background-color: #f7fdf5; /* Light green background */
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
            margin-right: -15px; /* Adjust for scrollbar on some browsers */
            padding-right: 15px; /* Prevent last item from being cut off */
        }

        .product-carousel::-webkit-scrollbar {
            height: 10px; /* Height of the scrollbar */
        }

        .product-carousel::-webkit-scrollbar-track {
            background: #e0f2e8; /* Track color */
            border-radius: 10px;
        }

        .product-carousel::-webkit-scrollbar-thumb {
            background: #a5d6a7; /* Thumb color */
            border-radius: 10px;
            border: 2px solid #f7fdf5; /* Padding around thumb */
        }

        .product-carousel::-webkit-scrollbar-thumb:hover {
            background: #81c784; /* Darker thumb on hover */
        }

        .product-card {
            flex: 0 0 auto; /* Do not grow, do not shrink, base on content */
            width: 220px; /* Fixed width for carousel items */
            border: 1px solid #d4ecd9; /* Soft green border */
            border-radius: 12px; /* More rounded */
            padding: 18px;
            text-align: center;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            scroll-snap-align: start; /* Snap effect */
        }

        .product-card.highlight {
            border-color: #28a745;
            box-shadow: 0 6px 18px rgba(40, 167, 69, 0.25);
            background-color: #e8f5e9; /* Lighter green for highlight */
            transform: translateY(-5px); /* Lift highlighted card slightly */
        }

        .product-card:hover {
            transform: translateY(-7px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .product-card img {
            max-width: 100%;
            height: 160px; /* Taller images in carousel */
            object-fit: contain;
            border-radius: 10px;
            margin-bottom: 15px;
            background-color: #fdfdfd;
            padding: 8px;
        }

        .product-card h3 {
            font-size: 1.1em; /* Smaller font for carousel product names */
            color: #2c3e50;
            margin-bottom: 15px;
            min-height: 45px; /* Consistent height */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .product-card button {
            background-color: #3498db;
            color: white;
            padding: 9px 18px; /* Smaller button */
            border: none;
            border-radius: 7px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
            width: 100%;
            margin-top: auto; /* Push button to bottom */
        }

        .product-card button:hover {
            background-color: #2980b9;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 25px; /* More padding */
            margin-top: 45px;
            background-color: #1a5e3a; /* Dark green footer */
            color: #ecf0f1;
            border-radius: 18px; /* More rounded */
            font-size: 0.9em;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.05);
        }

        .footer p {
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CEK KESEHATAN LAMBUNG</h1>
        <p class="subtitle">Nyeri Ulu Hati, Kembung dan Mual adalah gejala umum dari *Gastritis (Maag)*</p>

        <div class="form-section">
            <h2>Data Diri</h2>
            <div class="form-group">
                <label for="name">Nama Lengkap:</label>
                <input type="text" id="name" placeholder="Masukkan nama Anda">
            </div>
            <div class="form-group">
                <label for="gender">Jenis Kelamin:</label>
                <select id="gender">
                    <option value="">Pilih Jenis Kelamin</option>
                    <option value="pria">Pria</option>
                    <option value="wanita">Wanita</option>
                </select>
            </div>
            <div class="form-group">
                <label for="city">Asal Kota:</label>
                <input type="text" id="city" placeholder="Masukkan asal kota Anda">
            </div>
            <div class="form-group">
                <label for="age">Usia:</label>
                <input type="number" id="age" min="1" placeholder="Masukkan usia Anda">
            </div>
        </div>

        <div id="fisikSection" class="form-section hidden-section">
            <h2>Gejala Fisik yang Dialami</h2>
            <div id="fisikCheckboxesContainer" class="checkbox-grid">
                </div>
        </div>

        <div id="mentalSection" class="form-section hidden-section">
            <h2>Gejala Psikologi yang Dirasakan</h2>
            <div id="mentalCheckboxesContainer" class="checkbox-grid">
                </div>
        </div>

        <div id="habitSection" class="form-section hidden-section">
            <h2>Kebiasaan Sehari-hari</h2>
            <div id="habitCheckboxesContainer" class="checkbox-grid">
                </div>
        </div>

        <div id="impactSection" class="form-section hidden-section">
            <h2>Dampak Kondisi Saat Ini</h2>
            <div id="impactCheckboxesContainer" class="checkbox-grid">
                </div>
        </div>

        <div id="durationSection" class="form-section hidden-section">
            <h2>Sudah berapa lama Anda mengalami gejala ini?</h2>
            <div class="form-group">
                <select id="duration">
                    <option value="">Pilih Durasi</option>
                    <option value="kurang-1-minggu">Kurang dari 1 minggu</option>
                    <option value="1-3-minggu">1 - 3 minggu</option>
                    <option value="1-3-bulan">1 - 3 bulan</option>
                    <option value="lebih-3-bulan">Lebih dari 3 bulan (tapi kurang dari 1 tahun)</option>
                    <option value="1-tahun">Sekitar 1 tahun</option>
                    <option value="2-tahun">Sekitar 2 tahun</option>
                    <option value="3-tahun">Sekitar 3 tahun</option>
                    <option value="lebih-3-tahun">Lebih dari 3 tahun</option>
                </select>
            </div>
        </div>

        <div class="button-container">
            <button id="cekButton">Cek Diagnosa & Rekomendasi</button>
        </div>

        <div class="form-section">
            <h2>Produk Tiens Lainnya</h2>
            <div class="product-carousel-wrapper">
                <div id="productCarousel" class="product-carousel">
                    </div>
            </div>
        </div>
    </div>

    <div id="diagnosisResultModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeDiagnosisModalButton">&times;</span>
            <div id="modalDiagnosisContent">
                </div>
        </div>
    </div>

    <div id="productDetailModal" class="modal">
        <div class="modal-content product-detail-modal-content">
            <span class="close-button" id="closeProductModalButton">&times;</span>
            <h3 id="modalProductName"></h3>
            <img id="modalProductImage" src="" alt="Product Image">
            
            <p class="section-title">Deskripsi:</p>
            <p id="modalProductDescription"></p>
            
            <p class="section-title">Manfaat:</p>
            <ul id="modalProductBenefits"></ul>

            <div id="modalProductDosageSection" style="display: none;">
                <p class="section-title">Aturan Pakai:</p>
                <p id="modalProductDosage"></p>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; TERIMAKASIH TELAH BERKUNJUNG & MEMPERCAYAI KAMI</p>
    </div>

    <script>
        // Data Produk Tiens
        const tiensProducts = [
            {
                id: "Zinc Capsules",
                name: "Tiens Zinc Capsules",
                image: "images/zink.jpg",
                fullDescription: "Zinc Capsules Tiens mengandung seng laktat, glukosa, dan bubuk protein telur. Zinc sangat penting untuk lebih dari 200 jenis enzim dalam tubuh, terlibat dalam sintesis asam nukleat dan protein, serta meningkatkan kekebalan tubuh. Ideal untuk perbaikan sel, pertumbuhan, dan fungsi hormonal, terutama untuk sistem pencernaan dan kekebalan.",
                benefits: [
                    "Meningkatkan nafsu makan",
                    "Membantu meningkatkan kekebalan tubuh",
                    "Mempercepat pertumbuhan dan perkembangan",
                    "Membantu menormalkan sekresi kelenjar pencernaan dan meningkatkan fungsi pencernaan",
                    "Mengoptimalkan penyerapan nutrisi",
                    "Penting untuk fungsi hormon reproduksi dan pertumbuhan",
                    "Membantu perbaikan sel dan jaringan tubuh"
                ],
                dosage: "Dewasa: 2x2 kapsul per hari. Anak-anak: 2x1 kapsul per hari. Diminum dengan air hangat.",
                type: "general_anxiety_gerd"
            },
            {
                id: "Chitin Chitosan Capsules",
                name: "Tiens Chitin Chitosan",
                image: "images/chitin.jpg",
                fullDescription: "Tiens Chitin Chitosan terbuat dari serat tempurung kepiting dan udang. Produk ini memiliki kemampuan unik untuk mengikat zat berbahaya, membersihkan saluran pencernaan, dan mendukung regenerasi sel. Sangat baik untuk detoksifikasi dan menjaga kesehatan lambung.",
                benefits: [
                    "Mengikat dan membuang racun serta logam berat dari tubuh",
                    "Melindungi mukosa lambung dan membantu regenerasi sel lambung",
                    "Membantu mengurangi keasaman lambung berlebih",
                    "Meningkatkan pergerakan usus dan melancarkan BAB",
                    "Menurunkan kadar kolesterol dan gula darah",
                    "Membantu penyembuhan luka dan peradangan"
                ],
                dosage: "2x2 kapsul per hari, 30 menit sebelum makan. Minum banyak air.",
                type: "gerd"
            },
            {
                id: "Nutrient Super Calcium Powder",
                name: "Tiens Nutrient Super Calcium Powder",
                image: "images/kal.jpg",
                fullDescription: "Tiens Nutrient Super Calcium Powder diformulasikan dengan kalsium organik berkadar tinggi yang mudah diserap tubuh. Tidak hanya untuk tulang, kalsium juga berperan penting dalam fungsi saraf, kontraksi otot, dan menjaga keseimbangan pH tubuh. Sangat baik untuk mengatasi masalah saraf terkait kecemasan dan memperbaiki kualitas tidur.",
                benefits: [
                    "Sumber kalsium tinggi yang mudah diserap",
                    "Membantu menenangkan saraf dan mengurangi kecemasan",
                    "Meningkatkan kualitas tidur",
                    "Mencegah osteoporosis dan menjaga kesehatan tulang",
                    "Mengatur detak jantung dan kontraksi otot",
                    "Menjaga keseimbangan pH tubuh (membantu menetralkan asam)",
                    "Meningkatkan transmisi impuls saraf"
                ],
                dosage: "1 bungkus per hari, diseduh dengan air hangat (60-70Â°C) sebelum tidur atau pagi hari.",
                type: "anxiety_gerd"
            },
        ];

        const allFisikSymptomsWithDetails = [
            { label: "Nyeri bagian ulu hati seperti ditekan", value: "Nyeri bagian ulu hati seperti ditekan", weight: 3, type: "gerd", critical: true, desc: "Nyeri ulu hati yang konstan dan menekan adalah gejala khas GERD yang mengindikasikan peradangan atau iritasi serius pada lapisan lambung atau kerongkongan. Ini memerlukan perhatian segera untuk mencegah kerusakan lebih lanjut." },
            { label: "Perut begah / kembung", value: "Perut begah / kembung", weight: 2, type: "gerd", desc: "Perut begah dan kembung sering disebabkan oleh gas berlebih akibat pencernaan yang tidak efisien, fermentasi makanan yang tidak sempurna, atau dismotilitas lambung. Ini sangat umum pada penderita GERD." },
            { label: "Dada terasa panas (heartburn)", value: "Dada terasa panas (heartburn)", weight: 3, type: "gerd", critical: true, desc: "Sensasi terbakar di dada adalah gejala klasik refluks asam (heartburn), menunjukkan asam lambung naik ke kerongkongan. Jika sering terjadi, ini dapat merusak lapisan kerongkongan dan menyebabkan komplikasi serius." },
            { label: "Asam naik ke tenggorokan / mulut pahit", value: "Asam naik ke tenggorokan / mulut pahit", weight: 3, type: "gerd", critical: true, desc: "Refluks asam ke tenggorokan atau mulut pahit adalah tanda jelas asam lambung mencapai area atas saluran pencernaan, berpotensi menyebabkan kerusakan gigi, suara serak, batuk kronis, dan sensasi terbakar yang parah." },
            { label: "Mual / muntah", value: "Mual/muntah", weight: 2, type: "gerd", desc: "Mual dan muntah dapat mengindikasikan iritasi lambung, gangguan pengosongan lambung (gastroparesis), atau bahkan respons tubuh terhadap stres dan kecemasan yang ekstrem. Ini mengganggu asupan nutrisi." },
            { label: "Sering sendawa", value: "Sering sendawa", weight: 1, type: "gerd", desc: "Sendawa berlebihan bisa disebabkan oleh menelan udara saat makan/minum cepat, atau merupakan respons terhadap gas berlebih di lambung akibat pencernaan yang tidak sempurna atau refluks." },
            { label: "Tenggorokan Gatal atau Batuk Kering", value: "Tenggorokan Gatal atau Batuk Kering", weight: 2, type: "gerd", desc: "Iritasi tenggorokan atau batuk kering kronis, terutama tanpa flu, seringkali merupakan gejala ekstra-esofageal GERD yang disebabkan oleh paparan asam lambung yang naik ke tenggorokan dan saluran napas." },
            { label: "Pusing / kleyengan", value: "Pusing / kleyengan", weight: 2, type: "anxiety", desc: "Sensasi pusing atau kleyengan, terutama yang bukan vertigo sejati, sering dikaitkan dengan hyperventilasi (napas cepat dan dangkal) atau respons panik akibat anxiety, mengganggu keseimbangan dan fokus." },
            { label: "Badan lemas seperti mau pingsan", value: "Badan lemas seperti mau pingsan", weight: 3, type: "anxiety", critical: true, desc: "Perasaan lemas yang ekstrem hingga seperti mau pingsan, tanpa sebab fisik jelas, adalah gejala umum serangan panik atau kecemasan berat. Ini sangat mengganggu aktivitas dan menimbulkan ketakutan." },
            { label: "Dada tertekan seperti Serangan Jantung", value: "Dada tertekan seperti Serangan Jantung", weight: 3, type: "anxiety", critical: true, desc: "Nyeri dada yang menekan, seringkali mirip gejala jantung, adalah salah satu manifestasi fisik paling menakutkan dari anxiety atau serangan panik. Ini memerlukan evaluasi medis untuk menyingkirkan kondisi jantung, namun seringkali murni psikosomatik." },
            { label: "Nafas Pendek/Berat saat Cemas", value: "Nafas Pendek/Berat saat Cemas", weight: 2, type: "anxiety", desc: "Sesak napas atau napas berat saat cemas (dyspnea) adalah gejala umum anxiety, seringkali akibat hyperventilasi. Ini menciptakan siklus ketakutan dan memperburuk sensasi fisik yang tidak nyaman." },
            { label: "Sering nyeri bagian perut kiri", value: "Sering nyeri bagian perut kiri", weight: 2, type: "gerd_anxiety", desc: "Nyeri perut kiri bisa berkaitan dengan berbagai kondisi, termasuk sindrom iritasi usus (IBS) yang sering diperparah oleh stres/anxiety, atau masalah lambung (GERD) yang memicu ketegangan di area tersebut. Butuh evaluasi lebih lanjut." }
        ];

        const allMentalSymptomsWithDetails = [
            { label: "Sering pikiran berlebihan / overthinking dimalam hari", value: "Sering pikiran berlebihan / overthinking dimalam hari", weight: 3, type: "anxiety", critical: true, desc: "Overthinking kronis, terutama di malam hari, adalah ciri khas anxiety yang mengganggu kualitas tidur, menyebabkan kelelahan mental, dan memperpanjang siklus stres. Ini secara langsung memperburuk anxiety dan berpotensi memicu atau memperparah masalah lambung (brain-gut axis)." },
            { label: "Sering gelisah tanpa alasan", value: "Sering gelisah tanpa alasan", weight: 3, type: "anxiety", critical: true, desc: "Kegelisahan kronis tanpa pemicu jelas adalah inti dari gangguan kecemasan umum (GAD), menyebabkan ketidaknyamanan mental dan fisik yang konstan. Ini sangat menguras energi dan berdampak buruk pada kesehatan fisik, termasuk pencernaan." },
            { label: "Sulit tidur", value: "Sulit tidur", weight: 2, type: "anxiety", desc: "Insomnia atau kesulitan tidur adalah gejala umum baik pada anxiety maupun GERD. Kurang tidur memperburuk stres, peradangan di tubuh, mengganggu regenerasi sel lambung, dan meningkatkan tingkat kecemasan, menciptakan lingkaran setan." },
            { label: "Sering merasa takut atau panik", value: "Sering merasa takut atau panik", weight: 3, type: "anxiety", critical: true, desc: "Perasaan takut yang intens atau serangan panik yang sering adalah indikator anxiety yang signifikan, membatasi aktivitas sosial dan pribadi, serta menurunkan kualitas hidup secara drastis. Serangan panik dapat meniru gejala penyakit fisik serius." },
            { label: "Bangun tidur dengan rasa cemas", value: "Bangun tidur dengan rasa cemas", weight: 3, type: "anxiety", critical: true, desc: "Membangunkan diri dengan perasaan cemas menunjukkan tingkat stres yang tinggi dan ketidakmampuan tubuh untuk rileks bahkan saat tidur. Ini membuat hari terasa berat sejak awal dan mengganggu produktivitas." },
            { label: "Makan sedikit namun cepat kenyang", value: "Makan sedikit namun cepat kenyang", weight: 2, type: "gerd", desc: "Rasa cepat kenyang dengan porsi sedikit bisa disebabkan oleh gastroparesis (pengosongan lambung yang lambat), lambung yang sangat sensitif, atau tekanan gas. Ini umum pada GERD kronis dan berpotensi menyebabkan kekurangan gizi serta penurunan berat badan yang tidak diinginkan." },
            { label: "Ketergantungan pada obat-obatan", value: "Ketergantungan pada obat-obatan", weight: 3, type: "general", critical: true, desc: "Ketergantungan pada obat-obatan (baik itu obat lambung seperti PPI jangka panjang, atau penenang) menunjukkan bahwa gejala Anda sudah sangat mengganggu dan tubuh mungkin sudah membangun toleransi. Ini memerlukan penanganan holistik dan seringkali pengawasan medis untuk mengurangi ketergantungan." }
        ];

        const allHabitsWithDetails = [
            { label: "Sering telat makan / tidak teratur", value: "Sering telat makan / tidak teratur", weight: 2, type: "gerd", desc: "Pola makan tidak teratur menyebabkan produksi asam lambung tidak seimbang, sering memicu iritasi dan memperburuk GERD karena lambung kosong terlalu lama atau terisi mendadak dengan porsi besar." },
            { label: "Sering konsumsi makanan pedas/asam", value: "Sering konsumsi makanan pedas/asam", weight: 2, type: "gerd", desc: "Makanan pedas dan asam adalah pemicu umum refluks asam dan iritasi lambung. Konsumsi rutin dapat merusak lapisan mukosa lambung dan kerongkongan, memperburuk gejala GERD." },
            { label: "Sering begadang", value: "Sering begadang", weight: 2, type: "anxiety", desc: "Begadang mengganggu ritme sirkadian tubuh, meningkatkan hormon stres (kortisol), dan memperburuk anxiety serta gejala lambung. Kurang tidur juga melemahkan sistem kekebalan tubuh dan menghambat proses pemulihan." },
            { label: "Sering minum kopi / soda", value: "Sering minum kopi / soda", weight: 2, type: "gerd_anxiety", desc: "Kafein (kopi) dapat melemahkan Lower Esophageal Sphincter (LES) dan meningkatkan produksi asam, memperparah GERD. Soda (karbonasi) juga menyebabkan gas dan distensi lambung. Keduanya dapat memicu atau memperburuk kecemasan, detak jantung berdebar, dan sulit tidur." },
            { label: "Sering stress / banyak pikiran", value: "Sering stress / banyak pikiran", weight: 3, type: "anxiety", critical: true, desc: "Stres kronis adalah pemicu utama anxiety dan memiliki dampak langsung pada fungsi pencernaan (sumbu otak-usus), mengubah motilitas usus, sekresi asam, dan permeabilitas usus, sehingga memperburuk gejala GERD dan memperparah lingkaran setan fisik-psikis." },
            { label: "Jarang olahraga", value: "Jarang olahraga", weight: 1, type: "general", desc: "Kurangnya aktivitas fisik dapat memperburuk stres, sirkulasi darah, dan motilitas usus. Olahraga secara teratur adalah pereda stres alami dan membantu meningkatkan kesehatan fisik serta mental secara keseluruhan." },
            { label: "Merokok", value: "Merokok", weight: 2, type: "gerd", desc: "Merokok secara signifikan melemahkan LES, meningkatkan produksi asam, dan secara umum merusak sel-sel tubuh, memperparah GERD dan memperburuk kondisi pernapasan. Ini juga dapat meningkatkan kecemasan pada beberapa individu." },
            { label: "Minum alkohol", value: "Minum alkohol", weight: 3, type: "gerd_anxiety", critical: true, desc: "Alkohol sangat mengiritasi lambung, melemahkan LES, dan dapat memperburuk kecemasan serta gangguan tidur. Konsumsi alkohol kronis dapat menyebabkan kerusakan serius pada sistem pencernaan dan memperburuk kondisi mental." }
        ];

        const allImpactsWithDetails = [
            { label: "Penurunan berat badan", value: "Penurunan berat badan", weight: 3, type: "gerd", critical: true, desc: "Penurunan berat badan tanpa sebab yang jelas sering menunjukkan gangguan pencernaan yang serius, seperti malabsorpsi nutrisi akibat GERD kronis, mual parah, atau bahkan kondisi medis lain yang lebih serius. Ini memerlukan evaluasi medis." },
            { label: "Sulit melakukan aktivitas sehari-hari", value: "Sulit melakukan aktivitas sehari-hari", weight: 3, type: "anxiety", critical: true, desc: "Kesulitan beraktivitas sehari-hari adalah indikator kuat bahwa anxiety sudah mencapai tingkat yang signifikan dan melumpuhkan, mengganggu fungsi normal hidup, pekerjaan, atau sekolah. Ini membutuhkan intervensi segera." },
            { label: "Menarik diri dari lingkungan sosial", value: "Menarik diri dari lingkungan sosial", weight: 3, type: "anxiety", critical: true, desc: "Isolasi sosial adalah tanda anxiety atau depresi yang memburuk, menghambat dukungan sosial yang krusial untuk pemulihan, dan dapat memperparah kondisi mental secara keseluruhan." },
            { label: "Sering izin tidak masuk kerja/sekolah", value: "Sering izin tidak masuk kerja/sekolah", weight: 2, type: "anxiety", desc: "Absensi yang sering dari pekerjaan atau sekolah menunjukkan bahwa gejala Anda sudah berdampak serius pada kewajiban sosial dan profesional, mengganggu stabilitas hidup Anda." },
            { label: "Kualitas hidup menurun drastis", value: "Kualitas hidup menurun drastis", weight: 3, type: "gerd_anxiety", critical: true, desc: "Penurunan kualitas hidup secara drastis mencerminkan dampak kumulatif dari gejala fisik dan mental yang tidak tertangani. Ini adalah tanda bahwa intervensi menyeluruh dan segera diperlukan untuk mengembalikan kesejahteraan." },
            { label: "Performa kerja/belajar menurun", value: "Performa kerja/belajar menurun", weight: 2, type: "gerd_anxiety", desc: "Penurunan performa kerja atau belajar menunjukkan bahwa konsentrasi, energi, dan fokus terganggu oleh gejala yang dialami, menghambat potensi diri dan dapat memengaruhi stabilitas karir/pendidikan." }
        ];

        // Durasi baru dengan bobot yang disesuaikan
        const durationWeights = {
            "kurang-1-minggu": 1,
            "1-3-minggu": 2,
            "1-3-bulan": 3,
            "lebih-3-bulan": 4,
            "1-tahun": 5,
            "2-tahun": 6,
            "3-tahun": 7,
            "lebih-3-tahun": 8
        };

        // Global variables to store selected symptoms for WhatsApp message
        let selectedSymptomsDetails = {
            fisik: "",
            mental: "",
            habit: "",
            impact: ""
        };
        let currentRecommendationProducts = [];
        let currentLifestyleTips = [];
        let currentDiagnosisResultText = "";
        let currentSymptomAnalysisList = []; // New array to store detailed symptom analysis
        let currentGeneralCharacteristics = []; // New: Stores overall characteristics for WA message
        let currentFinalNote = "";
        let currentCtaMessage = ""; // New variable for CTA


        // Get section elements
        const nameInput = document.getElementById('name');
        const genderSelect = document.getElementById('gender');
        const cityInput = document.getElementById('city');
        const ageInput = document.getElementById('age');
        const fisikSection = document.getElementById('fisikSection');
        const mentalSection = document.getElementById('mentalSection');
        const habitSection = document.getElementById('habitSection');
        const impactSection = document.getElementById('impactSection');
        const durationSection = document.getElementById('durationSection');
        const durationSelect = document.getElementById('duration');


        // Function to render checkboxes dynamically
        function renderCheckboxes(containerId, data, nameAttribute, checkedValues = []) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`Container with ID ${containerId} not found.`);
                return;
            }
            container.innerHTML = ''; // Clear existing checkboxes

            data.forEach(item => {
                const checkboxId = `${nameAttribute}-${item.value.replace(/\s+/g, '-').replace(/[<>\/]/g, '')}`; // Clean ID
                const isChecked = checkedValues.includes(item.value);
                const checkboxItemDiv = document.createElement('div');
                checkboxItemDiv.classList.add('checkbox-item');
                if (isChecked) {
                    checkboxItemDiv.classList.add('checked');
                }

                checkboxItemDiv.innerHTML = `
                    <input type="checkbox" id="${checkboxId}" name="${nameAttribute}" value="${item.value}" ${isChecked ? 'checked' : ''}>
                    <label for="${checkboxId}">${item.label}</label>
                `;
                container.appendChild(checkboxItemDiv);

                // Add event listener to div to toggle checkbox and class
                checkboxItemDiv.addEventListener('click', (event) => {
                    // Only toggle if the click target is the div or label, not the checkbox itself
                    if (event.target === checkboxItemDiv || event.target.tagName === 'LABEL') {
                        const checkbox = checkboxItemDiv.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked; // Toggle the checkbox state
                        checkboxItemDiv.classList.toggle('checked', checkbox.checked); // Toggle the class
                        checkFormProgress(); // Recalculate progress on any change
                    }
                });
            });
        }

        // Function to display Tiens products in the carousel
        function displayTiensProducts(highlightedProductIds = []) {
            const productCarousel = document.getElementById('productCarousel');
            if (!productCarousel) {
                console.error("Elemen 'productCarousel' tidak ditemukan!");
                return;
            }
            productCarousel.innerHTML = ''; // Clear existing products

            tiensProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');
                if (highlightedProductIds.includes(product.id)) {
                    productCard.classList.add('highlight');
                }
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}">
                    <h3>${product.name}</h3>
                    <button onclick="showProductModal('${product.id}', false)">Lihat Detail</button> `;
                productCarousel.appendChild(productCard);
            });
        }

        // Function to check form progress and show/hide sections
        function checkFormProgress() {
            const nameValid = nameInput.value.trim() !== '';
            const genderValid = genderSelect.value !== '';
            const cityValid = cityInput.value.trim() !== '';
            const umur = parseInt(ageInput.value);
            const umurValid = !isNaN(umur) && umur > 0;

            // All personal data must be valid to show next section
            if (nameValid && genderValid && cityValid && umurValid) {
                fisikSection.classList.remove('hidden-section');
                renderCheckboxes('fisikCheckboxesContainer', allFisikSymptomsWithDetails, 'gejala',
                    Array.from(document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]:checked')).map(cb => cb.value)
                );
            } else {
                fisikSection.classList.add('hidden-section');
                document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]').forEach(cb => cb.checked = false);
            }

            const selectedFisikCheckboxes = Array.from(document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]:checked'));
            const selectedFisikCount = selectedFisikCheckboxes.length;

            const currentMentalChecked = Array.from(document.querySelectorAll('#mentalCheckboxesContainer input[name="mental"]:checked')).map(cb => cb.value);
            const currentHabitChecked = Array.from(document.querySelectorAll('#habitCheckboxesContainer input[name="habit"]:checked')).map(cb => cb.value);
            const currentImpactChecked = Array.from(document.querySelectorAll('#impactCheckboxesContainer input[name="impact"]:checked')).map(cb => cb.value);

            let selectedMentalValues = currentMentalChecked;
            let selectedHabitValues = currentHabitChecked;
            let selectedImpactValues = currentImpactChecked;

            const hasSelectedMental = selectedMentalValues.length > 0;
            const hasSelectedHabit = selectedHabitValues.length > 0;
            const hasSelectedImpact = selectedImpactValues.length > 0;

            if (selectedFisikCount > 0 && nameValid && genderValid && cityValid && umurValid) {
                mentalSection.classList.remove('hidden-section');
                let relevantMentalSymptoms = allMentalSymptomsWithDetails;

                const isAnxietyRelatedFisik = selectedFisikCheckboxes.some(symptom =>
                    ["Pusing / kleyengan", "Badan lemas seperti mau pingsan", "Dada tertekan seperti Serangan Jantung", "Nafas Pendek/Berat saat Cemas", "Sering nyeri bagian perut kiri"].includes(symptom.value)
                );
                const isGastricRelatedFisik = selectedFisikCheckboxes.some(symptom =>
                    ["Nyeri bagian ulu hati seperti ditekan", "Perut begah / kembung", "Dada terasa panas (heartburn)", "Asam naik ke tenggorokan / mulut pahit", "Mual / muntah", "Sering sendawa", "Tenggorokan Gatal atau Batuk Kering"].includes(symptom.value)
                );

                if (isAnxietyRelatedFisik && !isGastricRelatedFisik) {
                    relevantMentalSymptoms = allMentalSymptomsWithDetails.filter(symptom =>
                        symptom.type === "anxiety" || symptom.type === "general"
                    );
                } else if (isGastricRelatedFisik && !isAnxietyRelatedFisik) {
                    relevantMentalSymptoms = allMentalSymptomsWithDetails.filter(symptom =>
                        symptom.type === "gerd" || symptom.type === "general"
                    );
                }
                // If both or neither, show all mental symptoms
                renderCheckboxes('mentalCheckboxesContainer', relevantMentalSymptoms, 'mental', selectedMentalValues);

            } else {
                mentalSection.classList.add('hidden-section');
                selectedMentalValues = [];
                document.querySelectorAll('#mentalCheckboxesContainer input[name="mental"]').forEach(cb => cb.checked = false);
            }

            if (selectedFisikCount > 0 && hasSelectedMental && nameValid && genderValid && cityValid && umurValid) {
                habitSection.classList.remove('hidden-section');
                renderCheckboxes('habitCheckboxesContainer', allHabitsWithDetails, 'habit', selectedHabitValues);
            } else {
                habitSection.classList.add('hidden-section');
                selectedHabitValues = [];
                document.querySelectorAll('#habitCheckboxesContainer input[name="habit"]').forEach(cb => cb.checked = false);
            }

            if (selectedFisikCount > 0 && hasSelectedMental && hasSelectedHabit && nameValid && genderValid && cityValid && umurValid) {
                impactSection.classList.remove('hidden-section');
                renderCheckboxes('impactCheckboxesContainer', allImpactsWithDetails, 'impact', selectedImpactValues);
            } else {
                impactSection.classList.add('hidden-section');
                selectedImpactValues = [];
                document.querySelectorAll('#impactCheckboxesContainer input[name="impact"]').forEach(cb => cb.checked = false);
            }

            if (selectedFisikCount > 0 && hasSelectedMental && hasSelectedHabit && hasSelectedImpact && nameValid && genderValid && cityValid && umurValid) {
                durationSection.classList.remove('hidden-section');
            } else {
                durationSection.classList.add('hidden-section');
                durationSelect.value = "";
            }
        }

        // Event listeners for form fields to trigger checkFormProgress
        nameInput.addEventListener('input', checkFormProgress);
        genderSelect.addEventListener('change', checkFormProgress);
        cityInput.addEventListener('input', checkFormProgress);
        ageInput.addEventListener('input', checkFormProgress);

        // Event listeners for checkbox sections to trigger checkFormProgress
        document.getElementById('fisikCheckboxesContainer').addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'gejala') {
                checkFormProgress();
            }
        });
        document.getElementById('mentalCheckboxesContainer').addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'mental') {
                checkFormProgress();
            }
        });
        document.getElementById('habitCheckboxesContainer').addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'habit') {
                checkFormProgress();
            }
        });
        document.getElementById('impactCheckboxesContainer').addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'impact') {
                checkFormProgress();
            }
        });
        durationSelect.addEventListener('change', checkFormProgress);


        // JavaScript logika Diagnosa Keparahan dan Rekomendasi
        function calculateSeverity() {
            const nameEl = document.getElementById("name");
            const genderEl = document.getElementById("gender");
            const cityEl = document.getElementById("city");
            const ageEl = document.getElementById("age");

            const name = nameEl.value.trim();
            const gender = genderEl.value;
            const city = cityEl.value.trim();
            const umur = parseInt(ageEl.value);

            const fisikCheckboxes = Array.from(document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]:checked'));
            const mentalCheckboxes = Array.from(document.querySelectorAll('#mentalCheckboxesContainer input[name="mental"]:checked'));
            const habitCheckboxes = Array.from(document.querySelectorAll('#habitCheckboxesContainer input[name="habit"]:checked'));
            const impactCheckboxes = Array.from(document.querySelectorAll('#impactCheckboxesContainer input[name="impact"]:checked'));

            const durasiEl = document.getElementById("duration");
            const durasiValue = durasiEl.value;
            const durasiText = durasiEl.options[durasiEl.selectedIndex].text; // Get the displayed text for WA message

            // --- Validasi yang Lebih Jelas dan Komprehensif ---
            let firstInvalidElement = null;

            if (name === '') {
                alert("Mohon masukkan Nama Lengkap Anda.");
                firstInvalidElement = nameEl;
            } else if (gender === '') {
                alert("Mohon pilih Jenis Kelamin Anda.");
                firstInvalidElement = genderEl;
            } else if (city === '') {
                alert("Mohon masukkan Asal Kota Anda.");
                firstInvalidElement = cityEl;
            } else if (isNaN(umur) || umur <= 0) {
                alert("Mohon masukkan usia Anda dengan benar (angka positif).");
                firstInvalidElement = ageEl;
            } else if (fisikCheckboxes.length === 0) {
                alert("Mohon pilih setidaknya satu gejala di bagian 'Gejala Fisik yang Dialami'.");
                firstInvalidElement = fisikSection;
            } else if (mentalCheckboxes.length === 0) {
                alert("Mohon pilih setidaknya satu gejala di bagian 'Gejala Psikologi yang Dirasakan'.");
                firstInvalidElement = mentalSection;
            } else if (habitCheckboxes.length === 0) {
                alert("Mohon pilih setidaknya satu kebiasaan di bagian 'Kebiasaan Sehari-hari'.");
                firstInvalidElement = habitSection;
            } else if (impactCheckboxes.length === 0) {
                alert("Mohon pilih setidaknya satu dampak di bagian 'Dampak Kondisi Saat Ini'.");
                firstInvalidElement = impactSection;
            } else if (!durasiValue) {
                alert("Mohon pilih durasi gejala di bagian 'Sudah berapa lama Anda mengalami gejala ini?'.");
                firstInvalidElement = durasiEl;
            }

            if (firstInvalidElement) {
                if (firstInvalidElement.scrollIntoView) {
                    firstInvalidElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                if (firstInvalidElement.focus) { // Try to focus for input/select elements
                    firstInvalidElement.focus();
                }
                return; // Stop function execution if validation fails
            }
            // --- Akhir Validasi ---

            let totalScore = 0; // Tetap hitung total skor untuk referensi, tapi penentuan keparahan lebih kualitatif
            let gerdScore = 0;
            let anxietyScore = 0;

            // List to store detailed descriptions for analysis (for WA message, not displaying on web)
            currentSymptomAnalysisList = [];
            currentGeneralCharacteristics = []; // Reset general characteristics for each new calculation

            // Track critical symptoms and general impact for severity determination
            let hasCriticalGerdSymptom = false;
            let hasCriticalAnxietySymptom = false;
            let hasSignificantImpact = false; // Based on critical impacts
            let longDurationFactor = 0; // 0 for <3 months, 1 for 3-12 months, 2 for >1 year

            // Process Fisik Symptoms
            let selectedGejalaFisikLabels = [];
            fisikCheckboxes.forEach(checkbox => {
                const symptom = allFisikSymptomsWithDetails.find(s => s.value === checkbox.value);
                if (symptom) {
                    totalScore += symptom.weight;
                    selectedGejalaFisikLabels.push(symptom.label);
                    currentSymptomAnalysisList.push(symptom.desc);
                    if (symptom.type === "gerd") gerdScore += symptom.weight;
                    else if (symptom.type === "anxiety") anxietyScore += symptom.weight;
                    else if (symptom.type === "gerd_anxiety") { gerdScore += symptom.weight / 2; anxietyScore += symptom.weight / 2; }
                    if (symptom.critical) hasCriticalGerdSymptom = true;
                }
            });

            // Process Mental Symptoms
            let selectedGejalaMentalLabels = [];
            mentalCheckboxes.forEach(checkbox => {
                const symptom = allMentalSymptomsWithDetails.find(s => s.value === checkbox.value);
                if (symptom) {
                    totalScore += symptom.weight;
                    selectedGejalaMentalLabels.push(symptom.label);
                    currentSymptomAnalysisList.push(symptom.desc);
                    if (symptom.type === "gerd") gerdScore += symptom.weight;
                    else if (symptom.type === "anxiety") anxietyScore += symptom.weight;
                    else if (symptom.type === "general") totalScore += symptom.weight; // General contribute to total, not specific sub-score for recommendation
                    if (symptom.critical) hasCriticalAnxietySymptom = true;
                }
            });

            // Process Habits
            let selectedKebiasaanLabels = [];
            habitCheckboxes.forEach(checkbox => {
                const habit = allHabitsWithDetails.find(h => h.value === checkbox.value);
                if (habit) {
                    totalScore += habit.weight;
                    selectedKebiasaanLabels.push(habit.label);
                    currentSymptomAnalysisList.push(habit.desc);
                    // Habits also contribute to gerd/anxiety intensity, but less directly than symptoms
                    if (habit.type === "gerd") gerdScore += habit.weight * 0.5;
                    else if (habit.type === "anxiety") anxietyScore += habit.weight * 0.5;
                    else if (habit.type === "gerd_anxiety") { gerdScore += habit.weight * 0.25; anxietyScore += habit.weight * 0.25; }
                }
            });

            // Process Impacts
            let selectedDampakLabels = [];
            impactCheckboxes.forEach(checkbox => {
                const impact = allImpactsWithDetails.find(i => i.value === checkbox.value);
                if (impact) {
                    totalScore += impact.weight;
                    selectedDampakLabels.push(impact.label);
                    currentSymptomAnalysisList.push(impact.desc);
                    if (impact.critical) hasSignificantImpact = true;
                }
            });

            // Process Duration
            totalScore += durationWeights[durasiValue] || 0; // Add duration to total score
            if (durasiValue === "lebih-3-tahun" || durasiValue === "3-tahun") {
                longDurationFactor = 2; // Very long duration
                currentSymptomAnalysisList.push("Durasi gejala yang sudah sangat lama ini menunjukkan kondisi yang persisten dan kronis, membutuhkan penanganan serius untuk mencegah kerusakan jangka panjang atau keparahan lebih lanjut. Ini bisa menjadi tanda masalah yang lebih dalam.");
            } else if (durasiValue === "1-tahun" || durasiValue === "2-tahun") {
                longDurationFactor = 1; // Long duration
                currentSymptomAnalysisList.push("Durasi gejala selama ini menandakan bahwa kondisi Anda sudah cukup mengakar dan perlu penanganan konsisten agar tidak menjadi kronis. Gejala mungkin sudah sering muncul.");
            } else if (durasiValue === "1-3-bulan" || durasiValue === "lebih-3-bulan") {
                currentSymptomAnalysisList.push("Gejala yang Anda rasakan sudah berlangsung beberapa bulan, menunjukkan bahwa kondisi ini perlu perhatian serius agar tidak berkembang menjadi lebih parah atau kronis.");
            } else {
                 currentSymptomAnalysisList.push("Gejala yang Anda alami masih relatif baru. Ini adalah waktu yang tepat untuk melakukan intervensi agar kondisi tidak memburuk.");
            }


            // --- Penentuan Tingkat Keparahan (Kualitatif) ---
            let severityText = "";
            let summaryText = "";
            let severityClass = "";
            let productsToRecommend = [];
            let lifestyleTips = [];

            // Prioritize PARAH
            if (hasCriticalGerdSymptom || hasCriticalAnxietySymptom || hasSignificantImpact || longDurationFactor === 2 || totalScore >= 25) {
                severityText = "Parah";
                severityClass = "parah";
                summaryText = "Kondisi Anda menunjukkan tingkat keparahan yang serius, dengan gejala fisik dan psikologis yang signifikan dan sudah mengganggu kualitas hidup secara drastis. Ada risiko komplikasi jika tidak ditangani segera.";
                currentGeneralCharacteristics.push("Anda mengalami kombinasi gejala fisik dan psikologis yang signifikan, menunjukkan GERD dan Anxiety berada pada fase serius. Gejala ini sangat memengaruhi kualitas hidup Anda.");
                if (hasCriticalGerdSymptom) {
                    currentGeneralCharacteristics.push("Indikator kuat GERD parah terlihat dari nyeri ulu hati yang menekan, asam yang sering naik hingga tenggorokan, dan/atau mual/muntah kronis, yang menandakan iritasi lambung yang sudah lanjut dan potensi kerusakan organ.");
                }
                if (hasCriticalAnxietySymptom) {
                    currentGeneralCharacteristics.push("Tingkat anxiety yang parah ditandai dengan serangan panik, ketakutan berlebihan yang konstan, sulit beraktivitas normal, dan kecenderungan menarik diri dari sosial. Ini memerlukan penanganan serius.");
                }
                if (hasSignificantImpact) {
                    currentGeneralCharacteristics.push("Dampak pada kualitas hidup Anda, seperti penurunan berat badan tanpa sebab jelas, atau kesulitan melakukan aktivitas sehari-hari, adalah alarm bahwa kondisi ini sangat mendesak untuk ditangani.");
                }
                if (longDurationFactor === 2) {
                    currentGeneralCharacteristics.push(`Durasi gejala yang sudah *lebih dari 3 tahun* mengindikasikan kondisi kronis yang sangat sulit ditangani jika tidak ada perubahan drastis.`);
                }
                currentCtaMessage = "Penanganan khusus dan komprehensif sangat mendesak. Segera konsultasi untuk mencegah komplikasi yang lebih serius.";

                productsToRecommend = [
                    { id: "Chitin Chitosan Capsules", name: "Tiens Chitin Chitosan" },
                    { id: "Zinc Capsules", name: "Tiens Zinc Capsules" },
                    { id: "Nutrient Super Calcium Powder", name: "Tiens Nutrient Super Calcium Powder" }
                ];

                lifestyleTips = [
                    "Wajib konsultasi medis (dokter spesialis) untuk evaluasi menyeluruh dan penanganan yang terarah, serta ahli gizi untuk diet khusus lambung yang ketat dan terpersonalisasi.",
                    "Terapkan teknik relaksasi mendalam (meditasi, yoga, mindful breathing) setiap hari secara konsisten untuk menenangkan sistem saraf.",
                    "Hindari semua pemicu lambung dan anxiety secara total: kafein, alkohol, rokok, makanan olahan, serta pastikan tidak begadang dan kelola stres dengan sangat serius.",
                    "Prioritaskan tidur berkualitas 7-9 jam per malam dan bangun/tidur pada waktu yang sama setiap hari. Ciptakan rutinitas tidur yang menenangkan.",
                    "Cari dukungan psikologis (terapi kognitif, konseling, atau psikiater) jika diperlukan untuk mengatasi anxiety berat dan dampaknya pada fungsi harian Anda."
                ];

            } else if (totalScore >= 12 || longDurationFactor === 1 || (gerdScore >= 6 && anxietyScore >= 6) ) { // SEDANG
                severityText = "Sedang";
                severityClass = "sedang";
                summaryText = "Gejala GERD dan anxiety Anda mulai mengganggu fungsi harian dan muncul cukup sering. Bila terus dibiarkan, ada potensi kuat untuk berkembang menjadi kronis dan sulit dikendalikan.";
                currentGeneralCharacteristics.push("Anda mengalami gejala GERD dan Anxiety yang cukup sering dan mulai memengaruhi rutinitas harian Anda.");
                currentGeneralCharacteristics.push("Gejala lambung seperti heartburn yang sering, perut begah berkepanjangan, atau mual menunjukkan adanya iritasi yang perlu ditangani segera agar tidak memburuk.");
                currentGeneralCharacteristics.push("Kecemasan sering muncul dalam bentuk overthinking, sulit tidur, atau kegelisahan yang mengganggu konsentrasi dan aktivitas.");
                if (longDurationFactor === 1) {
                    currentGeneralCharacteristics.push(`Durasi gejala sekitar ${durasiText} menunjukkan bahwa kondisi ini membutuhkan perhatian serius agar tidak memburuk menjadi kronis.`);
                }
                currentGeneralCharacteristics.push("Pola hidup kurang sehat seperti telat makan, begadang, atau konsumsi pemicu lambung dan stres sering memperburuk kondisi Anda.");
                currentCtaMessage = "Langkah cepat saat ini akan mencegah kondisi memburuk dan memudahkan pemulihan. Jangan tunda penanganan.";

                productsToRecommend = [
                    { id: "Chitin Chitosan Capsules", name: "Tiens Chitin Chitosan" },
                    { id: "Zinc Capsules", name: "Tiens Zinc Capsules" }
                ];
                // Tambahkan Calcium jika ada gejala anxiety atau sulit tidur yang menonjol
                if (selectedGejalaMentalLabels.some(s => ["Sulit tidur", "Sering pikiran berlebihan / overthinking dimalam hari", "Sering gelisah tanpa alasan"].includes(s)) ||
                    selectedKebiasaanLabels.includes("Sering begadang")) {
                     if (!productsToRecommend.some(p => p.id === "Nutrient Super Calcium Powder")) {
                         productsToRecommend.push({ id: "Nutrient Super Calcium Powder", name: "Tiens Nutrient Super Calcium Powder" });
                    }
                }

                lifestyleTips = [
                    "Tinjau ulang diet Anda: hindari makanan pemicu (pedas, asam, berlemak, kafein, soda). Makan porsi kecil tapi sering.",
                    "Kelola stres dengan teknik pernapasan dalam, meditasi singkat, atau hobi yang menenangkan.",
                    "Prioritaskan tidur yang cukup dan berkualitas. Hindari gadget sebelum tidur.",
                    "Lakukan aktivitas fisik ringan hingga sedang secara teratur (misal: jalan kaki 30 menit setiap hari).",
                    "Pertimbangkan untuk berbicara dengan profesional kesehatan mental jika kecemasan terasa sulit dikelola sendiri."
                ];

            } else { // RINGAN
                severityText = "Ringan";
                severityClass = "ringan";
                summaryText = "Gejala yang Anda alami masih tergolong ringan dan muncul sesekali. Ini adalah kesempatan terbaik untuk melakukan penyesuaian gaya hidup dan mencegahnya bertambah parah.";
                currentGeneralCharacteristics.push("Gejala Anda masih pada tahap awal dan muncul sesekali, belum mengganggu aktivitas harian secara signifikan. Ini adalah kesempatan terbaik untuk intervensi dini.");
                currentGeneralCharacteristics.push("Keluhan lambung mungkin berupa sendawa berlebihan atau perut begah setelah makan tertentu, yang bisa dipicu oleh pola makan tidak teratur.");
                currentGeneralCharacteristics.push("Kecemasan mungkin hanya berupa sedikit overthinking atau sulit tidur sesekali, yang belum sampai memicu serangan panik.");
                currentGeneralCharacteristics.push(`Durasi gejala yang ${durasiText} menunjukkan kondisi ini masih sangat baru dan responsif terhadap perubahan gaya hidup sederhana.`);
                currentGeneralCharacteristics.push("Beberapa kebiasaan kurang sehat seperti telat makan, konsumsi kopi/soda sesekali, atau kurang olahraga dapat menjadi pemicu yang bisa dihindari.");
                currentCtaMessage = "Jangan biarkan gejala kecil berkembang jadi masalah besar. Ambil tindakan sekarang untuk menjaga kesehatan Anda.";

                productsToRecommend = [
                    { id: "Chitin Chitosan Capsules", name: "Tiens Chitin Chitosan" },
                    { id: "Zinc Capsules", name: "Tiens Zinc Capsules" }
                ];

                lifestyleTips = [
                    "Atur kembali pola makan: hindari telat makan, makan porsi berlebihan, dan makan terlalu cepat. Utamakan makanan yang dimasak sederhana dan mudah dicerna.",
                    "Kurangi konsumsi makanan pedas, asam, berlemak, serta minuman berkafein dan bersoda secara bertahap. Perhatikan apa yang memicu gejala Anda.",
                    "Coba olahraga ringan secara rutin (misal: jalan santai, peregangan ringan) untuk meningkatkan mood, metabolisme, dan melancarkan pencernaan.",
                    "Pastikan tidur cukup 7-8 jam setiap malam untuk mendukung pemulihan tubuh dan menenangkan pikiran.",
                    "Identifikasi dan kelola pemicu stres utama Anda dengan teknik relaksasi dasar atau aktivitas yang menyenangkan."
                ];

                // Tambahkan Calcium jika ada gejala sulit tidur atau cemas sangat ringan
                if (selectedGejalaMentalLabels.some(s => s === "Sulit tidur" || s === "Sering pikiran berlebihan / overthinking dimalam hari")) {
                    if (!productsToRecommend.some(p => p.id === "Nutrient Super Calcium Powder")) {
                        productsToRecommend.push({ id: "Nutrient Super Calcium Powder", name: "Tiens Nutrient Super Calcium Powder" });
                    }
                }
            }


            // Update global variable for WhatsApp message
            selectedSymptomsDetails.fisik = selectedGejalaFisikLabels.length > 0 ? selectedGejalaFisikLabels.join(", ") : "-";
            selectedSymptomsDetails.mental = selectedGejalaMentalLabels.length > 0 ? selectedGejalaMentalLabels.join(", ") : "-";
            selectedSymptomsDetails.habit = selectedKebiasaanLabels.length > 0 ? selectedKebiasaanLabels.join(", ") : "-";
            selectedSymptomsDetails.impact = selectedDampakLabels.length > 0 ? selectedDampakLabels.join(", ") : "-";
            
            // Store the text of the selected duration for the WA message
            selectedSymptomsDetails.durationText = durasiText;


            currentRecommendationProducts = productsToRecommend;
            currentLifestyleTips = lifestyleTips;
            currentDiagnosisResultText = summaryText; // This is the short summary


            // --- HTML untuk Data Diri Pengguna di Hasil Diagnosa ---
            const genderDisplay = gender === 'pria' ? 'Pria' : (gender === 'wanita' ? 'Wanita' : '-');
            // Choose profile image based on gender
            const profileImageSrc = (gender === 'pria') ? 'images/pria.jpg' : ( (gender === 'wanita') ? 'images/wanita.jpg' : 'https://i.ibb.co/x7Y0Yp2/default-profile.png'); // Updated with more appealing profile images

            const userProfileHTML = `
                <div class="user-data-display">
                    <div class="profile-image-container">
                        <img src="${profileImageSrc}" alt="User Profile Picture">
                    </div>
                    <div class="user-data-details">
                        <div class="user-data-item">
                            <span class="label">Nama:</span>
                            <span class="value">${name}</span>
                        </div>
                        <div class="user-data-item">
                            <span class="label">Usia:</span>
                            <span class="value">${umur} tahun</span>
                        </div>
                        <div class="user-data-item">
                            <span class="label">Gender:</span>
                            <span class="value">${genderDisplay}</span>
                        </div>
                        <div class="user-data-item">
                            <span class="label">Kota:</span>
                            <span class="value">${city}</span>
                        </div>
                    </div>
                </div>
            `;
            // --- Akhir HTML untuk Data Diri Pengguna ---

            // Render Lifestyle Tips (moved up)
            let lifestyleTipsHTML = ``;
            if (lifestyleTips.length > 0) {
                lifestyleTipsHTML = `<div class="lifestyle-tips-section">
                    <h3>Saran Pola Hidup & Pola Makan</h3>
                    <ul>`;
                lifestyleTips.forEach(tip => {
                    lifestyleTipsHTML += `<li>${tip}</li>`;
                });
                lifestyleTipsHTML += `</ul></div>`;
            }

            // Render Product Recommendations
            let productRecommendationsHTML = ``;
            if (productsToRecommend.length > 0) {
                productRecommendationsHTML = `<div class="recommendation-section">
                    <h3>Saran Produk Tiens (Rekomendasi Penanganan)</h3>
                    <div class="product-recommendations-container">`;
                productsToRecommend.forEach(rec => {
                    const product = tiensProducts.find(p => p.id === rec.id);
                    const imageUrl = product ? product.image : '';
                    const productName = product ? product.name : rec.name;

                    productRecommendationsHTML += `
                                <div class="recommended-product-card">
                                    <img src="${imageUrl}" alt="${productName}" />
                                    <div class="product-details">
                                        <h4>${productName}</h4>
                                        <button onclick="showProductModal('${rec.id}', true)">Lihat Detail</button>
                                    </div>
                                </div>
                            `;
                });
               productRecommendationsHTML += `</div></div>`; // Close recommendation-section here
            }

            // Custom CTA text
            const customCtaTextHTML = `<div class="custom-cta-text">${currentCtaMessage}</div>`;

            // NEW: Fill the Diagnosis Result Modal content
            const modalDiagnosisContent = document.getElementById("modalDiagnosisContent");
            if (!modalDiagnosisContent) {
                console.error("Elemen 'modalDiagnosisContent' tidak ditemukan!");
                return;
            }

            modalDiagnosisContent.innerHTML = `
                <div class="analysis-results-card" style="display: block;">
                    <h2>Hasil Diagnosa Kesehatan Lambung</h2>
                    ${userProfileHTML}
                    <div id="tingkatKeparahanContainer" class="${severityClass}">
                        <h3>Tingkat Keparahan: <span id="tingkatKeparahanText">${severityText}</span></h3>
                        <p id="summaryDescriptionText">${summaryText}</p>
                    </div>
                    ${lifestyleTipsHTML}
                    ${productRecommendationsHTML}
                    ${customCtaTextHTML}
                    <div class="konsultasi-button-container">
                        <button id="konsultasiWaButtonModal">
                            <i class="fab fa-whatsapp"></i> Konsultasi via WhatsApp
                        </button>
                    </div>
                </div>
            `;
            
            // Event listener for the WhatsApp button INSIDE the modal
            const konsultasiWaButtonModal = document.getElementById('konsultasiWaButtonModal');
            if (konsultasiWaButtonModal) {
                konsultasiWaButtonModal.addEventListener('click', () => {
                    const whatsappNumber = '6285721368380';
                    const message = generateWhatsAppMessage();
                    window.open(`https://wa.me/${whatsappNumber}?text=${message}`, '_blank');
                });
            } else {
                console.error("Tombol 'konsultasiWaButtonModal' tidak ditemukan!");
            }


            // Show the diagnosis result modal
            const diagnosisResultModal = document.getElementById('diagnosisResultModal');
            diagnosisResultModal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scrolling of background when modal is open

            // Ensure product carousel at the bottom of the main page is still updated
            displayTiensProducts(productsToRecommend.map(p => p.id));
        }

        // Fungsi untuk membuat pesan WhatsApp
        function generateWhatsAppMessage() {
            const name = document.getElementById("name").value.trim();
            const gender = document.getElementById("gender").value;
            const city = document.getElementById("city").value.trim();
            const umur = document.getElementById("age").value;
            // Get severity text from the modal content after it's been rendered
            const severityText = document.querySelector('#modalDiagnosisContent #tingkatKeparahanText').innerText;
            const durasiTextForWA = selectedSymptomsDetails.durationText || document.getElementById('duration').options[document.getElementById('duration').selectedIndex].text; // Fallback


            let message = `Halo, saya ingin berkonsultasi mengenai kesehatan lambung dan anxiety saya.\n\n`;
            message += `*Data Diri:*\n`;
            message += `Nama: ${name}\n`;
            message += `Jenis Kelamin: ${gender.charAt(0).toUpperCase() + gender.slice(1)}\n`;
            message += `Asal Kota: ${city}\n`;
            message += `Usia: ${umur} tahun\n`;
            message += `Durasi Gejala: ${durasiTextForWA}\n`;
            message += `Tingkat Keparahan: *${severityText}*\n\n`;

            if (selectedSymptomsDetails.fisik && selectedSymptomsDetails.fisik !== "-") {
                message += `*Gejala Fisik yang Dialami:*\n${selectedSymptomsDetails.fisik}\n\n`;
            }
            if (selectedSymptomsDetails.mental && selectedSymptomsDetails.mental !== "-") {
                message += `*Gejala Psikologi yang Dirasakan:*\n${selectedSymptomsDetails.mental}\n\n`;
            }
            if (selectedSymptomsDetails.habit && selectedSymptomsDetails.habit !== "-") {
                message += `*Kebiasaan Sehari-hari:*\n${selectedSymptomsDetails.habit}\n\n`;
            }
            if (selectedSymptomsDetails.impact && selectedSymptomsDetails.impact !== "-") {
                message += `*Dampak yang Dialami:*\n${selectedSymptomsDetails.impact}\n\n`;
            }

            message += `*Ringkasan Diagnosa:*\n${currentDiagnosisResultText}\n\n`;
            
            // Detailed symptom analysis for WhatsApp message (STILL INCLUDED FOR WA MESSAGE)
            if (currentSymptomAnalysisList.length > 0) {
                message += `*Analisis Mendalam Gejala yang Anda Rasakan:*\n`;
                currentSymptomAnalysisList.forEach(char => {
                    message += `â€¢ ${char}\n`;
                });
                message += `\n`;
            }

            if (currentGeneralCharacteristics.length > 0) {
                message += `*Karakteristik Umum Kondisi Anda:*\n`;
                currentGeneralCharacteristics.forEach(char => {
                    message += `â€¢ ${char}\n`;
                });
                message += `\n`;
            }


            if (currentLifestyleTips.length > 0) {
                message += `*Saran Pola Hidup & Pola Makan:*\n`;
                currentLifestyleTips.forEach(tip => {
                    const cleanedTip = tip.replace(/<\/?(strong|em|b|i)[^>]*>/g, '').replace(/<[^>]*>?/gm, ''); // Remove any lingering HTML tags
                    message += `â€¢ ${cleanedTip}\n`;
                });
                message += `\n`;
            }

            if (currentRecommendationProducts.length > 0) {
                message += `*Saran Produk Tiens:*\n`;
                currentRecommendationProducts.forEach(rec => {
                    const product = tiensProducts.find(p => p.id === rec.id);
                    message += `â€¢ ${rec.name} ${product && product.dosage ? `(Aturan Pakai: ${product.dosage})` : ''}\n`;
                });
                message += `\n`;
            }

            if (currentCtaMessage) {
                message += `*Pesan Penting:*\n_${currentCtaMessage}_\n\n`;
            }
            
            message += `*Konsultasi gratis via WA: 085721368380*`;

            return encodeURIComponent(message);
        }


        // --- MODAL (POP-UP) LOGIC untuk Detail Produk ---
        const productDetailModal = document.getElementById('productDetailModal');
        const closeModalButton = document.getElementById('closeProductModalButton'); // Renamed ID
        const modalProductName = document.getElementById('modalProductName');
        const modalProductImage = document.getElementById('modalProductImage');
        const modalProductDescription = document.getElementById('modalProductDescription');
        const modalProductBenefits = document.getElementById('modalProductBenefits');
        const modalProductDosageElement = document.getElementById('modalProductDosage');
        const modalProductDosageSection = document.getElementById('modalProductDosageSection');

        function showProductModal(productId, isRecommendation = false) {
            const product = tiensProducts.find(p => p.id === productId);
            if (!product) {
                console.error(`Product with ID ${productId} not found.`);
                return;
            }

            modalProductName.textContent = product.name;
            modalProductImage.src = product.image;
            modalProductImage.alt = product.name;
            modalProductDescription.textContent = product.fullDescription;
            
            if (modalProductDosageSection) {
                if (isRecommendation) {
                    modalProductDosageSection.style.display = 'block';
                    modalProductDosageElement.textContent = product.dosage || "Tidak ada informasi aturan pakai.";
                } else {
                    modalProductDosageSection.style.display = 'none';
                }
            }

            modalProductBenefits.innerHTML = '';
            if (product.benefits && product.benefits.length > 0) {
                product.benefits.forEach(benefit => {
                    const li = document.createElement('li');
                    li.textContent = benefit;
                    modalProductBenefits.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = "Tidak ada manfaat spesifik yang tercatat.";
                modalProductBenefits.appendChild(li);
            }

            // Show product detail modal (this will naturally layer on top due to higher z-index)
            productDetailModal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Keep body scroll locked
        }

        function closeProductModal() {
            productDetailModal.classList.remove('active');
            // Only unlock body scroll if the diagnosis modal is also closed
            // If the diagnosis modal is still active, it should control the body overflow
            const diagnosisResultModal = document.getElementById('diagnosisResultModal');
            if (!diagnosisResultModal.classList.contains('active')) {
                document.body.style.overflow = '';
            }
        }

        closeModalButton.addEventListener('click', closeProductModal);
        productDetailModal.addEventListener('click', (event) => {
            if (event.target === productDetailModal) {
                closeProductModal();
            }
        });
        // --- END MODAL LOGIC untuk Detail Produk ---


        // --- NEW: MODAL LOGIC untuk Hasil Diagnosa ---
        const diagnosisResultModal = document.getElementById('diagnosisResultModal');
        const closeDiagnosisModalButton = document.getElementById('closeDiagnosisModalButton');

        function closeDiagnosisResultModal() {
            diagnosisResultModal.classList.remove('active');
            document.body.style.overflow = ''; // Unlock body scroll when diagnosis modal is closed
        }

        closeDiagnosisModalButton.addEventListener('click', closeDiagnosisResultModal);
        diagnosisResultModal.addEventListener('click', (event) => {
            if (event.target === diagnosisResultModal) {
                closeDiagnosisResultModal();
            }
        });
        // --- END NEW: MODAL LOGIC untuk Hasil Diagnosa ---


        document.addEventListener('DOMContentLoaded', () => {
            displayTiensProducts();

            const cekButton = document.getElementById('cekButton');
            if (cekButton) {
                cekButton.addEventListener('click', () => {
                    calculateSeverity();
                });
            } else {
                console.error("Tombol 'cekButton' tidak ditemukan!");
            }
            
            // Initial render of checkboxes and progress check
            renderCheckboxes('fisikCheckboxesContainer', allFisikSymptomsWithDetails, 'gejala');
            checkFormProgress();

            // Ensure grid class is applied to checkbox containers
            document.getElementById('fisikCheckboxesContainer').classList.add('checkbox-grid');
            document.getElementById('mentalCheckboxesContainer').classList.add('checkbox-grid');
            document.getElementById('habitCheckboxesContainer').classList.add('checkbox-grid');
            document.getElementById('impactCheckboxesContainer').classList.add('checkbox-grid');
        });
    </script>
</body>
</html>