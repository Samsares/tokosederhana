<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnosa Kesehatan Lambung & Anxiety</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background-color: #4CAF50;
            color: white;
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
        }

        h1, h2 {
            color: #333;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .form-section {
            background-color: #f9f9f9;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .hidden-section {
            display: none;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: calc(100% - 20px);
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
            outline: none;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .checkbox-item {
            background-color: #e9e9e9;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            border: 1px solid #e9e9e9;
            display: flex;
            align-items: center;
            position: relative;
        }

        .checkbox-item:hover {
            background-color: #dcdcdc;
            border-color: #b0b0b0;
        }

        .checkbox-item.checked {
            background-color: #d4edda;
            border-color: #28a745;
            box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.3);
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 12px;
            appearance: none;
            width: 22px;
            height: 22px;
            border: 2px solid #555;
            border-radius: 4px;
            position: relative;
            cursor: pointer;
            flex-shrink: 0;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .checkbox-item input[type="checkbox"]:checked {
            background-color: #4CAF50;
            border-color: #4CAF50;
        }

        .checkbox-item input[type="checkbox"]:checked::before {
            content: '\2713'; /* Checkmark character */
            display: block;
            color: white;
            font-size: 16px;
            text-align: center;
            line-height: 20px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .checkbox-item label {
            margin-bottom: 0;
            cursor: pointer;
            flex-grow: 1;
            color: #333;
        }

        .button-container {
            text-align: center;
            margin-top: 30px;
        }

        #cekButton {
            background-color: #007bff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
        }

        #cekButton:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        /* Product Carousel */
        .product-carousel-wrapper {
            position: relative;
            margin-top: 30px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 10px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .product-carousel {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            gap: 20px;
            padding-bottom: 10px; /* Space for scrollbar */
        }

        .product-carousel::-webkit-scrollbar {
            height: 8px;
        }

        .product-carousel::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 10px;
        }

        .product-carousel::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .product-carousel::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .product-card {
            flex: 0 0 auto;
            width: 200px; /* Fixed width for each card */
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            scroll-snap-align: start;
            transition: transform 0.2s ease;
        }

        .product-card:hover {
            transform: translateY(-5px);
        }

        .product-card.highlight {
            border-color: #4CAF50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
        }

        .product-card img {
            max-width: 100%;
            height: 120px;
            object-fit: contain;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .product-card h3 {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 15px;
            min-height: 40px; /* Ensure consistent height for titles */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-card button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }

        .product-card button:hover {
            background-color: #45a049;
        }

        /* Modals */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 2000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 10px;
            position: relative;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s ease-out;
            max-height: 90vh; /* Limit height to enable scrolling within modal */
            overflow-y: auto; /* Enable scrolling for modal content */
        }

        .modal-content.product-detail-modal-content {
            max-width: 600px;
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Diagnosis Result Modal Specific Styles */
        #modalDiagnosisContent h2 {
            color: #28a745;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
        }

        .user-data-display {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding: 15px;
            background-color: #e6f7ff;
            border-radius: 8px;
            border: 1px solid #b3e0ff;
        }

        .profile-image-container {
            flex-shrink: 0;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #2196F3;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .profile-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-data-details {
            flex-grow: 1;
        }

        .user-data-item {
            display: flex;
            margin-bottom: 5px;
        }

        .user-data-item .label {
            font-weight: bold;
            color: #333;
            width: 100px; /* Fixed width for labels */
            flex-shrink: 0;
        }

        .user-data-item .value {
            color: #555;
            flex-grow: 1;
        }

        #tingkatKeparahanContainer {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        #tingkatKeparahanContainer h3 {
            margin-top: 0;
            font-size: 1.5em;
        }

        #tingkatKeparahanContainer #tingkatKeparahanText {
            font-weight: bold;
            font-size: 1.2em;
        }

        #tingkatKeparahanContainer.ringan {
            background-color: #e6ffe6; /* Light Green */
            border: 1px solid #4CAF50;
            color: #28a745;
        }

        #tingkatKeparahanContainer.ringan #tingkatKeparahanText {
            color: #28a745;
        }

        #tingkatKeparahanContainer.sedang {
            background-color: #fffacd; /* Light Yellow */
            border: 1px solid #ffc107;
            color: #ffc107;
        }

        #tingkatKeparahanContainer.sedang #tingkatKeparahanText {
            color: #d39e00;
        }

        #tingkatKeparahanContainer.parah {
            background-color: #ffe6e6; /* Light Red */
            border: 1px solid #dc3545;
            color: #dc3545;
        }

        #tingkatKeparahanContainer.parah #tingkatKeparahanText {
            color: #dc3545;
        }

        #summaryDescriptionText {
            font-size: 1.1em;
            color: #555;
            margin-top: 10px;
        }

        .recommendation-section, .lifestyle-tips-section {
            background-color: #f2faff;
            border: 1px solid #cceeff;
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
        }

        .recommendation-section h3, .lifestyle-tips-section h3 {
            color: #007bff;
            font-size: 1.3em;
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
        }

        .lifestyle-tips-section ul {
            list-style-type: disc;
            padding-left: 25px;
            margin: 0;
        }

        .lifestyle-tips-section li {
            margin-bottom: 10px;
            color: #444;
        }

        .product-recommendations-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .recommended-product-card {
            background-color: #ffffff;
            border: 1px solid #d0e0f0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            width: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .recommended-product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.2);
        }

        .recommended-product-card img {
            max-width: 100px;
            height: 100px;
            object-fit: contain;
            margin-bottom: 10px;
        }

        .recommended-product-card h4 {
            font-size: 1.05em;
            color: #333;
            margin-bottom: 10px;
            flex-grow: 1; /* Allow title to take up space */
        }

        .recommended-product-card button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }

        .recommended-product-card button:hover {
            background-color: #0b7dda;
        }

        .custom-cta-text {
            text-align: center;
            margin-top: 25px;
            font-size: 1.1em;
            color: #333;
            padding: 15px;
            background-color: #ffeaa7;
            border: 1px solid #fdcb6e;
            border-radius: 8px;
            font-weight: 500;
        }


        .konsultasi-button-container {
            text-align: center;
            margin-top: 30px;
        }

        #konsultasiWaButtonModal {
            background-color: #25D366;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        #konsultasiWaButtonModal:hover {
            background-color: #1DA851;
            transform: translateY(-2px);
        }

        #konsultasiWaButtonModal i {
            font-size: 1.3em;
        }

        /* Product Detail Modal */
        #productDetailModal h3 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        #productDetailModal img {
            display: block;
            max-width: 70%;
            height: auto;
            margin: 0 auto 20px auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        #productDetailModal .section-title {
            font-weight: bold;
            color: #4CAF50;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 5px;
        }

        #modalProductDescription,
        #modalProductDosage {
            color: #555;
            margin-bottom: 15px;
            text-align: justify;
        }

        #modalProductBenefits {
            list-style-type: disc;
            padding-left: 20px;
            color: #555;
        }

        #modalProductBenefits li {
            margin-bottom: 8px;
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            padding: 20px;
            background-color: #333;
            color: white;
            text-align: center;
            font-size: 0.9em;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 15px auto;
            }

            .checkbox-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            .user-data-display {
                flex-direction: column;
                text-align: center;
            }

            .user-data-item {
                flex-direction: column;
                align-items: center;
            }

            .user-data-item .label {
                width: auto;
                margin-bottom: 5px;
            }

            .product-carousel {
                flex-wrap: nowrap;
                overflow-x: auto;
            }

            .product-card {
                width: 180px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1.5em;
            }
            #cekButton {
                padding: 12px 25px;
                font-size: 16px;
            }
            .product-card {
                width: 160px;
            }
            .recommended-product-card {
                width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Diagnosa Kesehatan Lambung & Anxiety</h1>
    </div>

    <div class="container">
        <div class="form-section">
            <h2>Data Diri</h2>
            <div class="form-group">
                <label for="name">Nama Lengkap:</label>
                <input type="text" id="name" placeholder="Masukkan nama Anda">
            </div>
            <div class="form-group">
                <label for="gender">Jenis Kelamin:</label>
                <select id="gender">
                    <option value="">Pilih Jenis Kelamin</option>
                    <option value="pria">Pria</option>
                    <option value="wanita">Wanita</option>
                </select>
            </div>
            <div class="form-group">
                <label for="city">Asal Kota:</label>
                <input type="text" id="city" placeholder="Masukkan kota asal Anda">
            </div>
            <div class="form-group">
                <label for="age">Usia:</label>
                <input type="number" id="age" placeholder="Masukkan usia Anda">
            </div>
        </div>

        <div id="fisikSection" class="form-section hidden-section">
            <h2>Gejala Fisik yang Dialami</h2>
            <div id="fisikCheckboxesContainer" class="checkbox-grid">
                </div>
        </div>

        <div id="mentalSection" class="form-section hidden-section">
            <h2>Gejala Psikologi yang Dirasakan</h2>
            <div id="mentalCheckboxesContainer" class="checkbox-grid">
                </div>
        </div>

        <div id="durationSection" class="form-section hidden-section">
            <h2>Sudah berapa lama Anda mengalami gejala ini?</h2>
            <div class="form-group">
                <select id="duration">
                    <option value="">Pilih Durasi</option>
                    <option value="kurang-1-minggu">Kurang dari 1 minggu</option>
                    <option value="1-3-minggu">1 - 3 minggu</option>
                    <option value="1-3-bulan">1 - 3 bulan</option>
                    <option value="lebih-3-bulan">Lebih dari 3 bulan (tapi kurang dari 1 tahun)</option>
                    <option value="1-tahun">Sekitar 1 tahun</option>
                    <option value="2-tahun">Sekitar 2 tahun</option>
                    <option value="3-tahun">Sekitar 3 tahun</option>
                    <option value="lebih-3-tahun">Lebih dari 3 tahun</option>
                </select>
            </div>
        </div>

        <div class="button-container">
            <button id="cekButton">Cek Hasil</button>
        </div>

        <div class="form-section">
            <h2>Katalog Produk</h2>
            <div class="product-carousel-wrapper">
                <div id="productCarousel" class="product-carousel">
                    </div>
            </div>
        </div>
    </div>

    <div id="diagnosisResultModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeDiagnosisModalButton">&times;</span>
            <div id="modalDiagnosisContent">
                </div>
        </div>
    </div>

    <div id="productDetailModal" class="modal">
        <div class="modal-content product-detail-modal-content">
            <span class="close-button" id="closeProductModalButton">&times;</span>
            <h3 id="modalProductName"></h3>
            <img id="modalProductImage" src="" alt="Product Image">
            
            <p class="section-title">Deskripsi:</p>
            <p id="modalProductDescription"></p>
            
            <p class="section-title">Manfaat:</p>
            <ul id="modalProductBenefits"></ul>

            <div id="modalProductDosageSection" style="display: none;">
                <p class="section-title">Aturan Pakai:</p>
                <p id="modalProductDosage"></p>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; 2025 Diagnosa Kesehatan Lambung & Anxiety. All rights reserved.</p>
    </div>

    <script>
        // Data Produk Tiens
        const tiensProducts = [
            {
                id: "Zinc Capsules",
                name: "Tiens Zinc Capsules",
                image: "images/zink.jpg",
                fullDescription: "Zinc Capsules Tiens mengandung seng laktat, glukosa, dan bubuk protein telur. Zinc sangat penting untuk lebih dari 200 jenis enzim dalam tubuh, terlibat dalam sintesis asam nukleat dan protein, serta meningkatkan kekebalan tubuh. Ideal untuk perbaikan sel, pertumbuhan, dan fungsi hormonal, terutama untuk sistem pencernaan dan kekebalan.",
                benefits: [
                    "Meningkatkan nafsu makan",
                    "Membantu meningkatkan kekebalan tubuh",
                    "Mempercepat pertumbuhan dan perkembangan",
                    "Membantu menormalkan sekresi kelenjar pencernaan dan meningkatkan fungsi pencernaan",
                    "Mengoptimalkan penyerapan nutrisi",
                    "Penting untuk fungsi hormon reproduksi dan pertumbuhan",
                    "Membantu perbaikan sel dan jaringan tubuh"
                ],
                dosage: "Dewasa: 2x2 kapsul per hari. Anak-anak: 2x1 kapsul per hari. Diminum dengan air hangat.",
                type: "general_anxiety_gerd"
            },
            {
                id: "Chitin Chitosan Capsules",
                name: "Tiens Chitin Chitosan",
                image: "images/chitin.jpg",
                fullDescription: "Tiens Chitin Chitosan terbuat dari serat tempurung kepiting dan udang. Produk ini memiliki kemampuan unik untuk mengikat zat berbahaya, membersihkan saluran pencernaan, dan mendukung regenerasi sel. Sangat baik untuk detoksifikasi dan menjaga kesehatan lambung.",
                benefits: [
                    "Mengikat dan membuang racun serta logam berat dari tubuh",
                    "Melindungi mukosa lambung dan membantu regenerasi sel lambung",
                    "Membantu mengurangi keasaman lambung berlebih",
                    "Meningkatkan pergerakan usus dan melancarkan BAB",
                    "Menurunkan kadar kolesterol dan gula darah",
                    "Membantu penyembuhan luka dan peradangan"
                ],
                dosage: "2x2 kapsul per hari, 30 menit sebelum makan. Minum banyak air.",
                type: "gerd"
            },
            {
                id: "Nutrient Super Calcium Powder",
                name: "Tiens Nutrient Super Calcium Powder",
                image: "images/kal.jpg",
                fullDescription: "Tiens Nutrient Super Calcium Powder diformulasikan dengan kalsium organik berkadar tinggi yang mudah diserap tubuh. Tidak hanya untuk tulang, kalsium juga berperan penting dalam fungsi saraf, kontraksi otot, dan menjaga keseimbangan pH tubuh. Sangat baik untuk mengatasi masalah saraf terkait kecemasan dan memperbaiki kualitas tidur.",
                benefits: [
                    "Sumber kalsium tinggi yang mudah diserap",
                    "Membantu menenangkan saraf dan mengurangi kecemasan",
                    "Meningkatkan kualitas tidur",
                    "Mencegah osteoporosis dan menjaga kesehatan tulang",
                    "Mengatur detak jantung dan kontraksi otot",
                    "Menjaga keseimbangan pH tubuh (membantu menetralkan asam)",
                    "Meningkatkan transmisi impuls saraf"
                ],
                dosage: "1 bungkus per hari, diseduh dengan air hangat (60-70Â°C) sebelum tidur atau pagi hari.",
                type: "anxiety_gerd"
            },
        ];

        const allFisikSymptomsWithDetails = [
            { label: "Nyeri bagian ulu hati seperti ditekan", value: "Nyeri bagian ulu hati seperti ditekan", weight: 3, type: "gerd", critical: true, desc: "Nyeri ulu hati yang konstan dan menekan adalah gejala khas GERD yang mengindikasikan peradangan atau iritasi serius pada lapisan lambung atau kerongkongan. Ini memerlukan perhatian segera untuk mencegah kerusakan lebih lanjut." },
            { label: "Perut begah / kembung", value: "Perut begah / kembung", weight: 2, type: "gerd", desc: "Perut begah dan kembung sering disebabkan oleh gas berlebih akibat pencernaan yang tidak efisien, fermentasi makanan yang tidak sempurna, atau dismotilitas lambung. Ini sangat umum pada penderita GERD." },
            { label: "Dada terasa panas (heartburn)", value: "Dada terasa panas (heartburn)", weight: 3, type: "gerd", critical: true, desc: "Sensasi terbakar di dada adalah gejala klasik refluks asam (heartburn), menunjukkan asam lambung naik ke kerongkongan. Jika sering terjadi, ini dapat merusak lapisan kerongkongan dan menyebabkan komplikasi serius." },
            { label: "Asam naik ke tenggorokan / mulut pahit", value: "Asam naik ke tenggorokan / mulut pahit", weight: 3, type: "gerd", critical: true, desc: "Refluks asam ke tenggorokan atau mulut pahit adalah tanda jelas asam lambung mencapai area atas saluran pencernaan, berpotensi menyebabkan kerusakan gigi, suara serak, batuk kronis, dan sensasi terbakar yang parah." },
            { label: "Mual / muntah", value: "Mual/muntah", weight: 2, type: "gerd", desc: "Mual dan muntah dapat mengindikasikan iritasi lambung, gangguan pengosongan lambung (gastroparesis), atau bahkan respons tubuh terhadap stres dan kecemasan yang ekstrem. Ini mengganggu asupan nutrisi." },
            { label: "Sering sendawa", value: "Sering sendawa", weight: 1, type: "gerd", desc: "Sendawa berlebihan bisa disebabkan oleh menelan udara saat makan/minum cepat, atau merupakan respons terhadap gas berlebih di lambung akibat pencernaan yang tidak sempurna atau refluks." },
            { label: "Tenggorokan Gatal atau Batuk Kering", value: "Tenggorokan Gatal atau Batuk Kering", weight: 2, type: "gerd", desc: "Iritasi tenggorokan atau batuk kering kronis, terutama tanpa flu, seringkali merupakan gejala ekstra-esofageal GERD yang disebabkan oleh paparan asam lambung yang naik ke tenggorokan dan saluran napas." },
            { label: "Pusing / kleyengan", value: "Pusing / kleyengan", weight: 2, type: "anxiety", desc: "Sensasi pusing atau kleyengan, terutama yang bukan vertigo sejati, sering dikaitkan dengan hyperventilasi (napas cepat dan dangkal) atau respons panik akibat anxiety, mengganggu keseimbangan dan fokus." },
            { label: "Badan lemas seperti mau pingsan", value: "Badan lemas seperti mau pingsan", weight: 3, type: "anxiety", critical: true, desc: "Perasaan lemas yang ekstrem hingga seperti mau pingsan, tanpa sebab fisik jelas, adalah gejala umum serangan panik atau kecemasan berat. Ini sangat mengganggu aktivitas dan menimbulkan ketakutan." },
            { label: "Dada tertekan seperti Serangan Jantung", value: "Dada tertekan seperti Serangan Jantung", weight: 3, type: "anxiety", critical: true, desc: "Nyeri dada yang menekan, seringkali mirip gejala jantung, adalah salah satu manifestasi fisik paling menakutkan dari anxiety atau serangan panik. Ini memerlukan evaluasi medis untuk menyingkirkan kondisi jantung, namun seringkali murni psikosomatik." },
            { label: "Nafas Pendek/Berat saat Cemas", value: "Nafas Pendek/Berat saat Cemas", weight: 2, type: "anxiety", desc: "Sesak napas atau napas berat saat cemas (dyspnea) adalah gejala umum anxiety, seringkali akibat hyperventilasi. Ini menciptakan siklus ketakutan dan memperburuk sensasi fisik yang tidak nyaman." },
            { label: "Sering nyeri bagian perut kiri", value: "Sering nyeri bagian perut kiri", weight: 2, type: "gerd_anxiety", desc: "Nyeri perut kiri bisa berkaitan dengan berbagai kondisi, termasuk sindrom iritasi usus (IBS) yang sering diperparah oleh stres/anxiety, atau masalah lambung (GERD) yang memicu ketegangan di area tersebut. Butuh evaluasi lebih lanjut." }
        ];

        const allMentalSymptomsWithDetails = [
            { label: "Sering pikiran berlebihan / overthinking dimalam hari", value: "Sering pikiran berlebihan / overthinking dimalam hari", weight: 3, type: "anxiety", critical: true, desc: "Overthinking kronis, terutama di malam hari, adalah ciri khas anxiety yang mengganggu kualitas tidur, menyebabkan kelelahan mental, dan memperpanjang siklus stres. Ini secara langsung memperburuk anxiety dan berpotensi memicu atau memperparah masalah lambung (brain-gut axis)." },
            { label: "Sering gelisah tanpa alasan", value: "Sering gelisah tanpa alasan", weight: 3, type: "anxiety", critical: true, desc: "Kegelisahan kronis tanpa pemicu jelas adalah inti dari gangguan kecemasan umum (GAD), menyebabkan ketidaknyamanan mental dan fisik yang konstan. Ini sangat menguras energi dan berdampak buruk pada kesehatan fisik, termasuk pencernaan." },
            { label: "Sulit tidur", value: "Sulit tidur", weight: 2, type: "anxiety", desc: "Insomnia atau kesulitan tidur adalah gejala umum baik pada anxiety maupun GERD. Kurang tidur memperburuk stres, peradangan di tubuh, mengganggu regenerasi sel lambung, dan meningkatkan tingkat kecemasan, menciptakan lingkaran setan." },
            { label: "Sering merasa takut atau panik", value: "Sering merasa takut atau panik", weight: 3, type: "anxiety", critical: true, desc: "Perasaan takut yang intens atau serangan panik yang sering adalah indikator anxiety yang signifikan, membatasi aktivitas sosial dan pribadi, serta menurunkan kualitas hidup secara drastis. Serangan panik dapat meniru gejala penyakit fisik serius." },
            { label: "Bangun tidur dengan rasa cemas", value: "Bangun tidur dengan rasa cemas", weight: 3, type: "anxiety", critical: true, desc: "Membangunkan diri dengan perasaan cemas menunjukkan tingkat stres yang tinggi dan ketidakmampuan tubuh untuk rileks bahkan saat tidur. Ini membuat hari terasa berat sejak awal dan mengganggu produktivitas." },
            { label: "Makan sedikit namun cepat kenyang", value: "Makan sedikit namun cepat kenyang", weight: 2, type: "gerd", desc: "Rasa cepat kenyang dengan porsi sedikit bisa disebabkan oleh gastroparesis (pengosongan lambung yang lambat), lambung yang sangat sensitif, atau tekanan gas. Ini umum pada GERD kronis dan berpotensi menyebabkan kekurangan gizi serta penurunan berat badan yang tidak diinginkan." },
            { label: "Ketergantungan pada obat-obatan", value: "Ketergantungan pada obat-obatan", weight: 3, type: "general", critical: true, desc: "Ketergantungan pada obat-obatan (baik itu obat lambung seperti PPI jangka panjang, atau penenang) menunjukkan bahwa gejala Anda sudah sangat mengganggu dan tubuh mungkin sudah membangun toleransi. Ini memerlukan penanganan holistik dan seringkali pengawasan medis untuk mengurangi ketergantungan." },
            { label: "Stres ringan", value: "Stres ringan", weight: 1, type: "anxiety", desc: "Stres ringan adalah respons normal terhadap tekanan hidup, namun jika tidak dikelola dapat berkembang menjadi kecemasan atau masalah fisik. Penting untuk mengidentifikasi pemicu dan melakukan coping yang sehat." } // NEW SYMPTOM ADDED HERE
        ];

        // Durasi baru dengan bobot yang disesuaikan
        const durationWeights = {
            "kurang-1-minggu": 1,
            "1-3-minggu": 2,
            "1-3-bulan": 3,
            "lebih-3-bulan": 4,
            "1-tahun": 5,
            "2-tahun": 6,
            "3-tahun": 7,
            "lebih-3-tahun": 8
        };

        // Global variables to store selected symptoms for WhatsApp message
        let selectedSymptomsDetails = {
            fisik: "",
            mental: ""
        };
        let currentRecommendationProducts = [];
        let currentLifestyleTips = [];
        let currentDiagnosisResultText = "";
        let currentSymptomAnalysisList = []; // New array to store detailed symptom analysis
        let currentGeneralCharacteristics = []; // New: Stores overall characteristics for WA message
        let currentFinalNote = "";
        let currentCtaMessage = ""; // New variable for CTA


        // Get section elements
        const nameInput = document.getElementById('name');
        const genderSelect = document.getElementById('gender');
        const cityInput = document.getElementById('city');
        const ageInput = document.getElementById('age');
        const fisikSection = document.getElementById('fisikSection');
        const mentalSection = document.getElementById('mentalSection');
        const durationSection = document.getElementById('durationSection');
        const durationSelect = document.getElementById('duration');


        // Function to render checkboxes dynamically
        function renderCheckboxes(containerId, data, nameAttribute, checkedValues = []) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`Container with ID ${containerId} not found.`);
                return;
            }
            container.innerHTML = ''; // Clear existing checkboxes

            data.forEach(item => {
                const checkboxId = `${nameAttribute}-${item.value.replace(/\s+/g, '-').replace(/[<>\/]/g, '')}`; // Clean ID
                const isChecked = checkedValues.includes(item.value);
                const checkboxItemDiv = document.createElement('div');
                checkboxItemDiv.classList.add('checkbox-item');
                if (isChecked) {
                    checkboxItemDiv.classList.add('checked');
                }

                checkboxItemDiv.innerHTML = `
                    <input type="checkbox" id="${checkboxId}" name="${nameAttribute}" value="${item.value}" ${isChecked ? 'checked' : ''}>
                    <label for="${checkboxId}">${item.label}</label>
                `;
                container.appendChild(checkboxItemDiv);

                // Add event listener to div to toggle checkbox and class
                checkboxItemDiv.addEventListener('click', (event) => {
                    // Only toggle if the click target is the div or label, not the checkbox itself
                    if (event.target === checkboxItemDiv || event.target.tagName === 'LABEL') {
                        const checkbox = checkboxItemDiv.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked; // Toggle the checkbox state
                        checkboxItemDiv.classList.toggle('checked', checkbox.checked); // Toggle the class
                        checkFormProgress(); // Recalculate progress on any change
                    }
                });
            });
        }

        // Function to display Tiens products in the carousel
        function displayTiensProducts(highlightedProductIds = []) {
            const productCarousel = document.getElementById('productCarousel');
            if (!productCarousel) {
                console.error("Elemen 'productCarousel' tidak ditemukan!");
                return;
            }
            productCarousel.innerHTML = ''; // Clear existing products

            tiensProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');
                if (highlightedProductIds.includes(product.id)) {
                    productCard.classList.add('highlight');
                }
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}">
                    <h3>${product.name}</h3>
                    <button onclick="showProductModal('${product.id}', false)">Lihat Detail</button> `;
                productCarousel.appendChild(productCard);
            });
        }

        // Function to check form progress and show/hide sections
        function checkFormProgress() {
            const nameValid = nameInput.value.trim() !== '';
            const genderValid = genderSelect.value !== '';
            const cityValid = cityInput.value.trim() !== '';
            const umur = parseInt(ageInput.value);
            const umurValid = !isNaN(umur) && umur > 0;

            // All personal data must be valid to show next section
            if (nameValid && genderValid && cityValid && umurValid) {
                fisikSection.classList.remove('hidden-section');
                renderCheckboxes('fisikCheckboxesContainer', allFisikSymptomsWithDetails, 'gejala',
                    Array.from(document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]:checked')).map(cb => cb.value)
                );
            } else {
                fisikSection.classList.add('hidden-section');
                document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]').forEach(cb => cb.checked = false);
            }

            const selectedFisikCheckboxes = Array.from(document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]:checked'));
            const selectedFisikCount = selectedFisikCheckboxes.length;

            const currentMentalChecked = Array.from(document.querySelectorAll('#mentalCheckboxesContainer input[name="mental"]:checked')).map(cb => cb.value);

            if (selectedFisikCount > 0 && nameValid && genderValid && cityValid && umurValid) {
                mentalSection.classList.remove('hidden-section');
                let relevantMentalSymptoms = allMentalSymptomsWithDetails;

                const isAnxietyRelatedFisik = selectedFisikCheckboxes.some(symptom =>
                    ["Pusing / kleyengan", "Badan lemas seperti mau pingsan", "Dada tertekan seperti Serangan Jantung", "Nafas Pendek/Berat saat Cemas", "Sering nyeri bagian perut kiri"].includes(symptom.value)
                );
                const isGastricRelatedFisik = selectedFisikCheckboxes.some(symptom =>
                    ["Nyeri bagian ulu hati seperti ditekan", "Perut begah / kembung", "Dada terasa panas (heartburn)", "Asam naik ke tenggorokan / mulut pahit", "Mual / muntah", "Sering sendawa", "Tenggorokan Gatal atau Batuk Kering"].includes(symptom.value)
                );

                if (isAnxietyRelatedFisik && !isGastricRelatedFisik) {
                    relevantMentalSymptoms = allMentalSymptomsWithDetails.filter(symptom =>
                        symptom.type === "anxiety" || symptom.type === "general"
                    );
                } else if (isGastricRelatedFisik && !isAnxietyRelatedFisik) {
                    relevantMentalSymptoms = allMentalSymptomsWithDetails.filter(symptom =>
                        symptom.type === "gerd" || symptom.type === "general"
                    );
                }
                // If both or neither, show all mental symptoms
                renderCheckboxes('mentalCheckboxesContainer', relevantMentalSymptoms, 'mental', currentMentalChecked);

            } else {
                mentalSection.classList.add('hidden-section');
                document.querySelectorAll('#mentalCheckboxesContainer input[name="mental"]').forEach(cb => cb.checked = false);
            }

            if (selectedFisikCount > 0 && currentMentalChecked.length > 0 && nameValid && genderValid && cityValid && umurValid) {
                durationSection.classList.remove('hidden-section');
            } else {
                durationSection.classList.add('hidden-section');
                durationSelect.value = "";
            }
        }

        // Event listeners for form fields to trigger checkFormProgress
        nameInput.addEventListener('input', checkFormProgress);
        genderSelect.addEventListener('change', checkFormProgress);
        cityInput.addEventListener('input', checkFormProgress);
        ageInput.addEventListener('input', checkFormProgress);

        // Event listeners for checkbox sections to trigger checkFormProgress
        document.getElementById('fisikCheckboxesContainer').addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'gejala') {
                checkFormProgress();
            }
        });
        document.getElementById('mentalCheckboxesContainer').addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'mental') {
                checkFormProgress();
            }
        });
        durationSelect.addEventListener('change', checkFormProgress);


        // JavaScript logika Diagnosa Keparahan dan Rekomendasi
        function calculateSeverity() {
            const nameEl = document.getElementById("name");
            const genderEl = document.getElementById("gender");
            const cityEl = document.getElementById("city");
            const ageEl = document.getElementById("age");

            const name = nameEl.value.trim();
            const gender = genderEl.value;
            const city = cityEl.value.trim();
            const umur = parseInt(ageEl.value);

            const fisikCheckboxes = Array.from(document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]:checked'));
            const mentalCheckboxes = Array.from(document.querySelectorAll('#mentalCheckboxesContainer input[name="mental"]:checked'));

            const durasiEl = document.getElementById("duration");
            const durasiValue = durasiEl.value;
            const durasiText = durasiEl.options[durasiEl.selectedIndex].text; // Get the displayed text for WA message

            // --- Validasi yang Lebih Jelas dan Komprehensif ---
            let firstInvalidElement = null;

            if (name === '') {
                alert("Mohon masukkan Nama Lengkap Anda.");
                firstInvalidElement = nameEl;
            } else if (gender === '') {
                alert("Mohon pilih Jenis Kelamin Anda.");
                firstInvalidElement = genderEl;
            } else if (city === '') {
                alert("Mohon masukkan Asal Kota Anda.");
                firstInvalidElement = cityEl;
            } else if (isNaN(umur) || umur <= 0) {
                alert("Mohon masukkan usia Anda dengan benar (angka positif).");
                firstInvalidElement = ageEl;
            } else if (fisikCheckboxes.length === 0) {
                alert("Mohon pilih setidaknya satu gejala di bagian 'Gejala Fisik yang Dialami'.");
                firstInvalidElement = fisikSection;
            } else if (mentalCheckboxes.length === 0) {
                alert("Mohon pilih setidaknya satu gejala di bagian 'Gejala Psikologi yang Dirasakan'.");
                firstInvalidElement = mentalSection;
            } else if (!durasiValue) {
                alert("Mohon pilih durasi gejala di bagian 'Sudah berapa lama Anda mengalami gejala ini?'.");
                firstInvalidElement = durasiEl;
            }

            if (firstInvalidElement) {
                if (firstInvalidElement.scrollIntoView) {
                    firstInvalidElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                if (firstInvalidElement.focus) { // Try to focus for input/select elements
                    firstInvalidElement.focus();
                }
                return; // Stop function execution if validation fails
            }
            // --- Akhir Validasi ---

            let totalScore = 0; // Tetap hitung total skor untuk referensi, tapi penentuan keparahan lebih kualitatif
            let gerdScore = 0;
            let anxietyScore = 0;

            // List to store detailed descriptions for analysis (for WA message, not displaying on web)
            currentSymptomAnalysisList = [];
            currentGeneralCharacteristics = []; // Reset general characteristics for each new calculation

            // Track critical symptoms and general impact for severity determination
            let hasCriticalGerdSymptom = false;
            let hasCriticalAnxietySymptom = false;
            let hasSignificantImpact = false; // Based on critical impacts
            let longDurationFactor = 0; // 0 for <3 months, 1 for 3-12 months, 2 for >1 year

            // Process Fisik Symptoms
            let selectedGejalaFisikLabels = [];
            fisikCheckboxes.forEach(checkbox => {
                const symptom = allFisikSymptomsWithDetails.find(s => s.value === checkbox.value);
                if (symptom) {
                    totalScore += symptom.weight;
                    selectedGejalaFisikLabels.push(symptom.label);
                    currentSymptomAnalysisList.push(symptom.desc);
                    if (symptom.type === "gerd") gerdScore += symptom.weight;
                    else if (symptom.type === "anxiety") anxietyScore += symptom.weight;
                    else if (symptom.type === "gerd_anxiety") { gerdScore += symptom.weight / 2; anxietyScore += symptom.weight / 2; }
                    if (symptom.critical) hasCriticalGerdSymptom = true;
                }
            });

            // Process Mental Symptoms
            let selectedGejalaMentalLabels = [];
            mentalCheckboxes.forEach(checkbox => {
                const symptom = allMentalSymptomsWithDetails.find(s => s.value === checkbox.value);
                if (symptom) {
                    totalScore += symptom.weight;
                    selectedGejalaMentalLabels.push(symptom.label);
                    currentSymptomAnalysisList.push(symptom.desc);
                    if (symptom.type === "gerd") gerdScore += symptom.weight;
                    else if (symptom.type === "anxiety") anxietyScore += symptom.weight;
                    else if (symptom.type === "general") totalScore += symptom.weight; // General contribute to total, not specific sub-score for recommendation
                    if (symptom.critical) hasCriticalAnxietySymptom = true;
                }
            });

            // Process Duration
            totalScore += durationWeights[durasiValue] || 0;
            if (durasiValue === "lebih-3-tahun" || durasiValue === "3-tahun") {
                longDurationFactor = 2;
                currentSymptomAnalysisList.push("Durasi gejala yang sudah sangat lama ini menunjukkan kondisi yang persisten dan kronis, membutuhkan penanganan serius untuk mencegah kerusakan jangka panjang atau keparahan lebih lanjut. Ini bisa menjadi tanda masalah yang lebih dalam.");
            } else if (durasiValue === "1-tahun" || durasiValue === "2-tahun") {
                longDurationFactor = 1;
                currentSymptomAnalysisList.push("Durasi gejala selama ini menandakan bahwa kondisi Anda sudah cukup mengakar dan perlu penanganan konsisten agar tidak menjadi kronis. Gejala mungkin sudah sering muncul.");
            } else if (durasiValue === "1-3-bulan" || durasiValue === "lebih-3-bulan") {
                currentSymptomAnalysisList.push("Gejala yang Anda rasakan sudah berlangsung beberapa bulan, menunjukkan bahwa kondisi ini perlu perhatian serius agar tidak berkembang menjadi lebih parah atau kronis.");
            } else {
                   currentSymptomAnalysisList.push("Gejala yang Anda alami masih relatif baru. Ini adalah waktu yang tepat untuk melakukan intervensi agar kondisi tidak memburuk.");
            }


            // --- Penentuan Tingkat Keparahan (Kualitatif) Berdasarkan Klasifikasi Baru ---
            let severityText = "";
            let summaryText = "";
            let severityClass = "";
            let productsToRecommend = [];
            let lifestyleTips = [];
            let diseaseName = ""; // New variable for disease name

            const selectedFisikValues = fisikCheckboxes.map(cb => cb.value);
            const selectedMentalValues = mentalCheckboxes.map(cb => cb.value);

            // Function to check if all symptoms in a list are present in selected symptoms
            const containsAllSymptoms = (requiredSymptoms, selectedSymptoms) =>
                requiredSymptoms.every(symptom => selectedSymptoms.includes(symptom));

            // Klasifikasi PARAH (Merah)
            const parahFisikSymptoms = [
                "Nyeri bagian ulu hati seperti ditekan",
                "Dada terasa panas (heartburn)",
                "Mual/muntah",
                "Tenggorokan Gatal atau Batuk Kering",
                "Badan lemas seperti mau pingsan",
                "Nafas Pendek/Berat saat Cemas",
                "Perut begah / kembung",
                "Asam naik ke tenggorokan / mulut pahit",
                "Pusing / kleyengan",
                "Dada tertekan seperti Serangan Jantung",
                "Sering nyeri bagian perut kiri"
            ];
            const parahMentalSymptoms = [
                "Sering pikiran berlebihan / overthinking dimalam hari",
                "Sulit tidur",
                "Bangun tidur dengan rasa cemas",
                "Sering gelisah tanpa alasan",
                "Sering merasa takut atau panik"
            ];

            const isParah = containsAllSymptoms(parahFisikSymptoms, selectedFisikValues) &&
                            containsAllSymptoms(parahMentalSymptoms, selectedMentalValues);

            // Klasifikasi SEDANG (Kuning)
            const sedangFisikSymptoms = [
                "Nyeri bagian ulu hati seperti ditekan",
                "Dada terasa panas (heartburn)",
                "Asam naik ke tenggorokan / mulut pahit",
                "Pusing / kleyengan",
                "Dada tertekan seperti Serangan Jantung",
                "Badan lemas seperti mau pingsan"
            ];
            const sedangMentalSymptoms = [
                "Sering pikiran berlebihan / overthinking dimalam hari",
                "Sulit tidur",
                "Makan sedikit namun cepat kenyang"
            ];

            const isSedang = containsAllSymptoms(sedangFisikSymptoms, selectedFisikValues) &&
                             containsAllSymptoms(sedangMentalSymptoms, selectedMentalValues);

            // Klasifikasi RINGAN (Hijau)
            const ringanFisikSymptoms = [
                "Perut begah / kembung",
                "Mual/muntah",
                "Sering sendawa",
                "Sering nyeri bagian perut kiri",
                "Tenggorokan Gatal atau Batuk Kering"
            ];
            const ringanMentalSymptoms = [
                "Makan sedikit namun cepat kenyang",
                "Ketergantungan pada obat-obatan",
                "Stres ringan"
            ];

            const isRingan = containsAllSymptoms(ringanFisikSymptoms, selectedFisikValues) &&
                             containsAllSymptoms(ringanMentalSymptoms, selectedMentalValues);


            if (isParah) {
                severityText = "Parah";
                severityClass = "parah";
                diseaseName = "GERD Anxiety";
                summaryText = "Kondisi Anda menunjukkan tingkat keparahan yang serius, dengan gejala fisik dan psikologis yang signifikan dan sudah mengganggu kualitas hidup secara drastis. Ada risiko komplikasi jika tidak ditangani segera.";
                currentGeneralCharacteristics.push("Anda mengalami kombinasi gejala fisik dan psikologis yang signifikan, menunjukkan GERD dan Anxiety berada pada fase serius. Gejala ini sangat memengaruhi kualitas hidup Anda.");
                currentGeneralCharacteristics.push("Indikator kuat GERD parah terlihat dari nyeri ulu hati yang menekan, asam yang sering naik hingga tenggorokan, dan/atau mual/muntah kronis, yang menandakan iritasi lambung yang sudah lanjut dan potensi kerusakan organ.");
                currentGeneralCharacteristics.push("Tingkat anxiety yang parah ditandai dengan serangan panik, ketakutan berlebihan yang konstan, sulit beraktivitas normal, dan kecenderungan menarik diri dari sosial. Ini memerlukan penanganan serius.");
                currentGeneralCharacteristics.push("Dampak pada kualitas hidup Anda, seperti penurunan berat badan tanpa sebab jelas, atau kesulitan melakukan aktivitas sehari-hari, adalah alarm bahwa kondisi ini sangat mendesak untuk ditangani.");
                if (longDurationFactor === 2) {
                    currentGeneralCharacteristics.push(`Durasi gejala yang sudah *lebih dari 3 tahun* mengindikasikan kondisi kronis yang sangat sulit ditangani jika tidak ada perubahan drastis.`);
                }
                currentCtaMessage = "Penanganan khusus dan komprehensif sangat mendesak. Segera konsultasi untuk mencegah komplikasi yang lebih serius.";

                productsToRecommend = [
                    { id: "Chitin Chitosan Capsules", name: "Tiens Chitin Chitosan" },
                    { id: "Zinc Capsules", name: "Tiens Zinc Capsules" },
                    { id: "Nutrient Super Calcium Powder", name: "Tiens Nutrient Super Calcium Powder" }
                ];

                lifestyleTips = [
                    "Wajib konsultasi medis (dokter spesialis) untuk evaluasi menyeluruh dan penanganan yang terarah, serta ahli gizi untuk diet khusus lambung yang ketat dan terpersonalisasi.",
                    "Terapkan teknik relaksasi mendalam (meditasi, yoga, mindful breathing) setiap hari secara konsisten untuk menenangkan sistem saraf.",
                    "Hindari semua pemicu lambung dan anxiety secara total: kafein, alkohol, rokok, makanan olahan, serta pastikan tidak begadang dan kelola stres dengan sangat serius.",
                    "Prioritaskan tidur berkualitas 7-9 jam per malam dan bangun/tidur pada waktu yang sama setiap hari. Ciptakan rutinitas tidur yang menenangkan.",
                    "Cari dukungan psikologis (terapi kognitif, konseling, atau psikiater) jika diperlukan untuk mengatasi anxiety berat dan dampaknya pada fungsi harian Anda."
                ];
            } else if (isSedang) {
                severityText = "Sedang";
                severityClass = "sedang";
                diseaseName = "GERD"; // Assuming GERD based on symptoms provided
                summaryText = "Gejala GERD dan anxiety Anda mulai mengganggu fungsi harian dan muncul cukup sering. Bila terus dibiarkan, ada potensi kuat untuk berkembang menjadi kronis dan sulit dikendalikan.";
                currentGeneralCharacteristics.push("Anda mengalami gejala GERD dan Anxiety yang cukup sering dan mulai memengaruhi rutinitas harian Anda.");
                currentGeneralCharacteristics.push("Gejala lambung seperti heartburn yang sering, perut begah berkepanjangan, atau mual menunjukkan adanya iritasi yang perlu ditangani segera agar tidak memburuk.");
                currentGeneralCharacteristics.push("Kecemasan sering muncul dalam bentuk overthinking, sulit tidur, atau kegelisahan yang mengganggu konsentrasi dan aktivitas.");
                if (longDurationFactor === 1) {
                    currentGeneralCharacteristics.push(`Durasi gejala sekitar ${durasiText} menunjukkan bahwa kondisi ini membutuhkan perhatian serius agar tidak memburuk menjadi kronis.`);
                }
                currentGeneralCharacteristics.push("Pola hidup kurang sehat seperti telat makan, begadang, atau konsumsi pemicu lambung dan stres sering memperburuk kondisi Anda.");
                currentCtaMessage = "Langkah cepat saat ini akan mencegah kondisi memburuk dan memudahkan pemulihan. Jangan tunda penanganan.";

                productsToRecommend = [
                    { id: "Chitin Chitosan Capsules", name: "Tiens Chitin Chitosan" },
                    { id: "Zinc Capsules", name: "Tiens Zinc Capsules" }
                ];
                // Tambahkan Calcium jika ada gejala anxiety atau sulit tidur yang menonjol
                if (selectedGejalaMentalLabels.some(s => ["Sulit tidur", "Sering pikiran berlebihan / overthinking dimalam hari", "Sering gelisah tanpa alasan"].includes(s))) {
                    if (!productsToRecommend.some(p => p.id === "Nutrient Super Calcium Powder")) {
                        productsToRecommend.push({ id: "Nutrient Super Calcium Powder", name: "Tiens Nutrient Super Calcium Powder" });
                    }
                }

                lifestyleTips = [
                    "Tinjau ulang diet Anda: hindari makanan pemicu (pedas, asam, berlemak, kafein, soda). Makan porsi kecil tapi sering.",
                    "Kelola stres dengan teknik pernapasan dalam, meditasi singkat, atau hobi yang menenangkan.",
                    "Prioritaskan tidur yang cukup dan berkualitas. Hindari gadget sebelum tidur.",
                    "Lakukan aktivitas fisik ringan hingga sedang secara teratur (misal: jalan kaki 30 menit setiap hari).",
                    "Pertimbangkan untuk berbicara dengan profesional kesehatan mental jika kecemasan terasa sulit dikelola sendiri."
                ];
            } else if (isRingan) {
                severityText = "Ringan";
                severityClass = "ringan";
                diseaseName = "Maag (Gastritis)"; // Assuming Maag (Gastritis) based on symptoms provided
                summaryText = "Gejala yang Anda alami masih tergolong ringan dan muncul sesekali. Ini adalah kesempatan terbaik untuk melakukan penyesuaian gaya hidup dan mencegahnya bertambah parah.";
                currentGeneralCharacteristics.push("Gejala Anda masih pada tahap awal dan muncul sesekali, belum mengganggu aktivitas harian secara signifikan. Ini adalah kesempatan terbaik untuk intervensi dini.");
                currentGeneralCharacteristics.push("Keluhan lambung mungkin berupa sendawa berlebihan atau perut begah setelah makan tertentu, yang bisa dipicu oleh pola makan tidak teratur.");
                currentGeneralCharacteristics.push("Kecemasan mungkin hanya berupa sedikit overthinking atau sulit tidur sesekali, yang belum sampai memicu serangan panik.");
                currentGeneralCharacteristics.push(`Durasi gejala yang ${durasiText} menunjukkan kondisi ini masih sangat baru dan responsif terhadap perubahan gaya hidup sederhana.`);
                currentGeneralCharacteristics.push("Beberapa kebiasaan kurang sehat seperti telat makan, konsumsi kopi/soda sesekali, atau kurang olahraga dapat menjadi pemicu yang bisa dihindari.");
                currentCtaMessage = "Jangan biarkan gejala kecil berkembang jadi masalah besar. Ambil tindakan sekarang untuk menjaga kesehatan Anda.";

                productsToRecommend = [
                    { id: "Chitin Chitosan Capsules", name: "Tiens Chitin Chitosan" },
                    { id: "Zinc Capsules", name: "Tiens Zinc Capsules" }
                ];

                // Tambahkan Calcium jika ada gejala sulit tidur atau cemas sangat ringan
                if (selectedGejalaMentalLabels.some(s => s === "Sulit tidur" || s === "Sering pikiran berlebihan / overthinking dimalam hari" || s === "Stres ringan")) {
                    if (!productsToRecommend.some(p => p.id === "Nutrient Super Calcium Powder")) {
                        productsToRecommend.push({ id: "Nutrient Super Calcium Powder", name: "Tiens Nutrient Super Calcium Powder" });
                    }
                }

                lifestyleTips = [
                    "Atur kembali pola makan: hindari telat makan, makan porsi berlebihan, dan makan terlalu cepat. Utamakan makanan yang dimasak sederhana dan mudah dicerna.",
                    "Kurangi konsumsi makanan pedas, asam, berlemak, serta minuman berkafein dan bersoda secara bertahap. Perhatikan apa yang memicu gejala Anda.",
                    "Coba olahraga ringan secara rutin (misal: jalan santai, peregangan ringan) untuk meningkatkan mood, metabolisme, dan melancarkan pencernaan.",
                    "Pastikan tidur cukup 7-8 jam setiap malam untuk mendukung pemulihan tubuh dan menenangkan pikiran.",
                    "Identifikasi dan kelola pemicu stres utama Anda dengan teknik relaksasi dasar atau aktivitas yang menyenangkan."
                ];
            } else {
                // Default fallback if no specific classification matches
                severityText = "Tidak Terklasifikasi";
                severityClass = "netral"; // Anda bisa menambahkan class CSS untuk tampilan netral jika diperlukan
                diseaseName = "Belum dapat ditentukan secara spesifik";
                summaryText = "Berdasarkan gejala yang Anda pilih, belum dapat diklasifikasikan ke dalam kategori spesifik. Namun, ini tidak berarti tidak ada masalah. Tetap perhatikan kesehatan Anda.";
                currentGeneralCharacteristics.push("Gejala yang Anda rasakan mungkin merupakan indikasi awal atau kombinasi yang tidak sesuai dengan pola klasifikasi umum.");
                currentCtaMessage = "Disarankan untuk tetap menjaga pola hidup sehat dan konsultasi jika gejala berlanjut atau memburuk.";
                productsToRecommend = [
                    { id: "Zinc Capsules", name: "Tiens Zinc Capsules" }
                ];
                lifestyleTips = [
                    "Pertahankan pola makan sehat dan teratur.",
                    "Cukupi istirahat dan kelola stres dengan baik.",
                    "Perbanyak minum air putih dan hindari makanan pemicu umum.",
                    "Jika gejala memburuk atau menetap, segera konsultasikan dengan profesional kesehatan."
                ];
            }


            // Update global variable for WhatsApp message
            selectedSymptomsDetails.fisik = selectedGejalaFisikLabels.length > 0 ? selectedGejalaFisikLabels.join(", ") : "-";
            selectedSymptomsDetails.mental = selectedGejalaMentalLabels.length > 0 ? selectedGejalaMentalLabels.join(", ") : "-";
            
            // Store the text of the selected duration for the WA message
            selectedSymptomsDetails.durationText = durasiText;


            currentRecommendationProducts = productsToRecommend;
            currentLifestyleTips = lifestyleTips;
            currentDiagnosisResultText = summaryText; // This is the short summary


            // --- HTML untuk Data Diri Pengguna di Hasil Diagnosa ---
            const genderDisplay = gender === 'pria' ? 'Pria' : (gender === 'wanita' ? 'Wanita' : '-');
            // Choose profile image based on gender
            const profileImageSrc = (gender === 'pria') ? 'images/pria.jpg' : ( (gender === 'wanita') ? 'images/wanita.jpg' : 'https://i.ibb.co/x7Y0Yp2/default-profile.png'); // Updated with more appealing profile images

            const userProfileHTML = `
                <div class="user-data-display">
                    <div class="profile-image-container">
                        <img src="${profileImageSrc}" alt="User Profile Picture">
                    </div>
                    <div class="user-data-details">
                        <div class="user-data-item">
                            <span class="label">Nama:</span>
                            <span class="value">${name}</span>
                        </div>
                        <div class="user-data-item">
                            <span class="label">Usia:</span>
                            <span class="value">${umur} tahun</span>
                        </div>
                        <div class="user-data-item">
                            <span class="label">Gender:</span>
                            <span class="value">${genderDisplay}</span>
                        </div>
                        <div class="user-data-item">
                            <span class="label">Kota:</span>
                            <span class="value">${city}</span>
                        </div>
                    </div>
                </div>
            `;
            // --- Akhir HTML untuk Data Diri Pengguna ---

            // Render Lifestyle Tips (moved up)
            let lifestyleTipsHTML = ``;
            if (lifestyleTips.length > 0) {
                lifestyleTipsHTML = `<div class="lifestyle-tips-section">
                    <h3>Saran Pola Hidup & Pola Makan</h3>
                    <ul>`;
                lifestyleTips.forEach(tip => {
                    lifestyleTipsHTML += `<li>${tip}</li>`;
                });
                lifestyleTipsHTML += `</ul></div>`;
            }

            // Render Product Recommendations
            let productRecommendationsHTML = ``;
            if (productsToRecommend.length > 0) {
                productRecommendationsHTML = `<div class="recommendation-section">
                    <h3>Saran Produk Tiens (Rekomendasi Penanganan)</h3>
                    <div class="product-recommendations-container">`;
                productsToRecommend.forEach(rec => {
                    const product = tiensProducts.find(p => p.id === rec.id);
                    const imageUrl = product ? product.image : '';
                    const productName = product ? product.name : rec.name;

                    productRecommendationsHTML += `
                                <div class="recommended-product-card">
                                    <img src="${imageUrl}" alt="${productName}" />
                                    <div class="product-details">
                                        <h4>${productName}</h4>
                                        <button onclick="showProductModal('${rec.id}', true)">Lihat Detail</button>
                                    </div>
                                </div>
                            `;
                });
                productRecommendationsHTML += `</div></div>`; // Close recommendation-section here
            }

            // Custom CTA text
            const customCtaTextHTML = `<div class="custom-cta-text">${currentCtaMessage}</div>`;

            // NEW: Fill the Diagnosis Result Modal content
            const modalDiagnosisContent = document.getElementById("modalDiagnosisContent");
            if (!modalDiagnosisContent) {
                console.error("Elemen 'modalDiagnosisContent' tidak ditemukan!");
                return;
            }

            modalDiagnosisContent.innerHTML = `
                <div class="analysis-results-card" style="display: block;">
                    <h2>Hasil Diagnosa Kesehatan Lambung</h2>
                    ${userProfileHTML}
                    <div id="tingkatKeparahanContainer" class="${severityClass}">
                        <h3>Tingkat Keparahan: <span id="tingkatKeparahanText">${severityText}</span></h3>
                        <p>Kemungkinan kondisi Anda saat ini: <strong>${diseaseName}</strong></p>
                        <p id="summaryDescriptionText">${summaryText}</p>
                    </div>
                    ${lifestyleTipsHTML}
                    ${productRecommendationsHTML}
                    ${customCtaTextHTML}
                    <div class="konsultasi-button-container">
                        <button id="konsultasiWaButtonModal">
                            <i class="fab fa-whatsapp"></i> Konsultasi via WhatsApp
                        </button>
                    </div>
                </div>
            `;
            
            // Event listener for the WhatsApp button INSIDE the modal
            const konsultasiWaButtonModal = document.getElementById('konsultasiWaButtonModal');
            if (konsultasiWaButtonModal) {
                konsultasiWaButtonModal.addEventListener('click', () => {
                    const whatsappNumber = '6285721368380';
                    const message = generateWhatsAppMessage();
                    window.open(`https://wa.me/${whatsappNumber}?text=${message}`, '_blank');
                });
            } else {
                console.error("Tombol 'konsultasiWaButtonModal' tidak ditemukan!");
            }


            // Show the diagnosis result modal
            const diagnosisResultModal = document.getElementById('diagnosisResultModal');
            diagnosisResultModal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scrolling of background when modal is open

            // Ensure product carousel at the bottom of the main page is still updated
            displayTiensProducts(productsToRecommend.map(p => p.id));
        }

        // Fungsi untuk membuat pesan WhatsApp
        function generateWhatsAppMessage() {
            const name = document.getElementById("name").value.trim();
            const gender = document.getElementById("gender").value;
            const city = document.getElementById("city").value.trim();
            const umur = document.getElementById("age").value;
            // Get severity text from the modal content after it's been rendered
            const severityText = document.querySelector('#modalDiagnosisContent #tingkatKeparahanText').innerText;
            const diseaseNameText = document.querySelector('#modalDiagnosisContent strong').innerText; // Get the disease name
            const durasiTextForWA = selectedSymptomsDetails.durationText || document.getElementById('duration').options[document.getElementById('duration').selectedIndex].text; // Fallback


            let message = `Halo, saya ingin berkonsultasi mengenai kesehatan lambung dan anxiety saya.\n\n`;
            message += `*Data Diri:*\n`;
            message += `Nama: ${name}\n`;
            message += `Jenis Kelamin: ${gender.charAt(0).toUpperCase() + gender.slice(1)}\n`;
            message += `Asal Kota: ${city}\n`;
            message += `Usia: ${umur} tahun\n`;
            message += `Durasi Gejala: ${durasiTextForWA}\n`;
            message += `Tingkat Keparahan: *${severityText}*\n`;
            message += `Kemungkinan Kondisi: *${diseaseNameText}*\n\n`; // Include disease name in WA message

            if (selectedSymptomsDetails.fisik && selectedSymptomsDetails.fisik !== "-") {
                message += `*Gejala Fisik yang Dialami:*\n${selectedSymptomsDetails.fisik}\n\n`;
            }
            if (selectedSymptomsDetails.mental && selectedSymptomsDetails.mental !== "-") {
                message += `*Gejala Psikologi yang Dirasakan:*\n${selectedSymptomsDetails.mental}\n\n`;
            }

            message += `*Ringkasan Diagnosa:*\n${currentDiagnosisResultText}\n\n`;
            
            // Detailed symptom analysis for WhatsApp message (STILL INCLUDED FOR WA MESSAGE)
            if (currentSymptomAnalysisList.length > 0) {
                message += `*Analisis Mendalam Gejala yang Anda Rasakan:*\n`;
                currentSymptomAnalysisList.forEach(char => {
                    message += `â¢ ${char}\n`;
                });
                message += `\n`;
            }

            if (currentGeneralCharacteristics.length > 0) {
                message += `*Karakteristik Umum Kondisi Anda:*\n`;
                currentGeneralCharacteristics.forEach(char => {
                    message += `â¢ ${char}\n`;
                });
                message += `\n`;
            }


            if (currentLifestyleTips.length > 0) {
                message += `*Saran Pola Hidup & Pola Makan:*\n`;
                currentLifestyleTips.forEach(tip => {
                    const cleanedTip = tip.replace(/<\/?(strong|em|b|i)[^>]*>/g, '').replace(/<[^>]*>?/gm, ''); // Remove any lingering HTML tags
                    message += `â¢ ${cleanedTip}\n`;
                });
                message += `\n`;
            }

            if (currentRecommendationProducts.length > 0) {
                message += `*Saran Produk Tiens:*\n`;
                currentRecommendationProducts.forEach(rec => {
                    const product = tiensProducts.find(p => p.id === rec.id);
                    message += `â¢ ${rec.name} ${product && product.dosage ? `(Aturan Pakai: ${product.dosage})` : ''}\n`;
                });
                message += `\n`;
            }

            if (currentCtaMessage) {
                message += `*Pesan Penting:*\n_${currentCtaMessage}_\n\n`;
            }
            
            message += `*Konsultasi gratis via WA: 085721368380*`;

            return encodeURIComponent(message);
        }


        // --- MODAL (POP-UP) LOGIC untuk Detail Produk ---
        const productDetailModal = document.getElementById('productDetailModal');
        const closeModalButton = document.getElementById('closeProductModalButton'); // Renamed ID
        const modalProductName = document.getElementById('modalProductName');
        const modalProductImage = document.getElementById('modalProductImage');
        const modalProductDescription = document.getElementById('modalProductDescription');
        const modalProductBenefits = document.getElementById('modalProductBenefits');
        const modalProductDosageElement = document.getElementById('modalProductDosage');
        const modalProductDosageSection = document.getElementById('modalProductDosageSection');

        function showProductModal(productId, isRecommendation = false) {
            const product = tiensProducts.find(p => p.id === productId);
            if (!product) {
                console.error(`Product with ID ${productId} not found.`);
                return;
            }

            modalProductName.textContent = product.name;
            modalProductImage.src = product.image;
            modalProductImage.alt = product.name;
            modalProductDescription.textContent = product.fullDescription;
            
            if (modalProductDosageSection) {
                if (isRecommendation) {
                    modalProductDosageSection.style.display = 'block';
                    modalProductDosageElement.textContent = product.dosage || "Tidak ada informasi aturan pakai.";
                } else {
                    modalProductDosageSection.style.display = 'none';
                }
            }

            modalProductBenefits.innerHTML = '';
            if (product.benefits && product.benefits.length > 0) {
                product.benefits.forEach(benefit => {
                    const li = document.createElement('li');
                    li.textContent = benefit;
                    modalProductBenefits.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = "Tidak ada manfaat spesifik yang tercatat.";
                modalProductBenefits.appendChild(li);
            }

            // Show product detail modal (this will naturally layer on top due to higher z-index)
            productDetailModal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Keep body scroll locked
        }

        function closeProductModal() {
            productDetailModal.classList.remove('active');
            // Only unlock body scroll if the diagnosis modal is also closed
            // If the diagnosis modal is still active, it should control the body overflow
            const diagnosisResultModal = document.getElementById('diagnosisResultModal');
            if (!diagnosisResultModal.classList.contains('active')) {
                document.body.style.overflow = '';
            }
        }

        closeModalButton.addEventListener('click', closeProductModal);
        productDetailModal.addEventListener('click', (event) => {
            if (event.target === productDetailModal) {
                closeProductModal();
            }
        });
        // --- END MODAL LOGIC untuk Detail Produk ---


        // --- NEW: MODAL LOGIC untuk Hasil Diagnosa ---
        const diagnosisResultModal = document.getElementById('diagnosisResultModal');
        const closeDiagnosisModalButton = document.getElementById('closeDiagnosisModalButton');

        function closeDiagnosisResultModal() {
            diagnosisResultModal.classList.remove('active');
            document.body.style.overflow = ''; // Unlock body scroll when diagnosis modal is closed
        }

        closeDiagnosisModalButton.addEventListener('click', closeDiagnosisResultModal);
        diagnosisResultModal.addEventListener('click', (event) => {
            if (event.target === diagnosisResultModal) {
                closeDiagnosisResultModal();
            }
        });
        // --- END NEW: MODAL LOGIC untuk Hasil Diagnosa ---


        document.addEventListener('DOMContentLoaded', () => {
            displayTiensProducts();

            const cekButton = document.getElementById('cekButton');
            if (cekButton) {
                cekButton.addEventListener('click', () => {
                    calculateSeverity();
                });
            } else {
                console.error("Tombol 'cekButton' tidak ditemukan!");
            }
            
            // Initial render of checkboxes and progress check
            renderCheckboxes('fisikCheckboxesContainer', allFisikSymptomsWithDetails, 'gejala');
            checkFormProgress();

            // Ensure grid class is applied to checkbox containers
            document.getElementById('fisikCheckboxesContainer').classList.add('checkbox-grid');
            document.getElementById('mentalCheckboxesContainer').classList.add('checkbox-grid');
        });
    </script>
</body>
</html>