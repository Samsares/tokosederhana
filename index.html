<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEK KESEHATAN LAMBUNG</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #e0f7fa, #bbdefb); /* Gradasi hijau-biru-putih */
            color: #333;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.8s ease-out;
            flex-grow: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 {
            color: #4caf50; /* Biru */
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .form-section {
            background-color: #f5f5f5;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 1px solid #eee;
            transition: all 0.4s ease-in-out;
        }

        .form-section.hidden-section {
            display: none;
            opacity: 0;
            transform: translateY(10px);
        }

        .form-section h2 {
            color: #4caf50; /* Hijau */
            margin-top: 0;
            font-size: 1.8em;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            width: calc(100% - 20px);
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
            box-sizing: border-box; /* Ensures padding doesn't add to the width */
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group select:focus {
            border-color: #2196f3;
            outline: none;
            box-shadow: 0 0 8px rgba(33, 150, 243, 0.2);
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .checkbox-item {
            background-color: #e3f2fd; /* Light blue */
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            border: 1px solid #c3e2fd;
        }

        .checkbox-item:hover {
            background-color: #cdebff;
            border-color: #90caf9;
        }

        .checkbox-item.checked {
            background-color: #a5d6a7; /* Light green for checked */
            border-color: #66bb6a;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.2);
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 12px;
            transform: scale(1.3);
            accent-color: #4caf50; /* Green accent for checkbox */
        }

        .checkbox-item label {
            margin-bottom: 0; /* Override default label margin */
            cursor: pointer;
            flex-grow: 1;
            color: #333;
        }

        .button-container {
            text-align: center;
            margin-top: 30px;
        }

        #cekButton {
            background-color: #4CAF50; /* Hijau */
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
        }

        #cekButton:hover {
            background-color: #43a047;
            transform: translateY(-2px);
        }

        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0, 0, 0, 0.6); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
            animation: fadeInModal 0.3s ease-out;
            padding: 20px; /* Add some padding for smaller screens */
            box-sizing: border-box;
        }

        .modal.active {
            display: flex;
        }

        @keyframes fadeInModal {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            width: 90%; /* Responsive width */
            max-width: 700px;
            position: relative;
            animation: slideIn 0.4s ease-out;
            max-height: 90vh; /* Limit height for scroll */
            overflow-y: auto; /* Enable scrolling inside modal content */
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
        }

        #modalDiagnosisContent h2 {
            color: #3f51b5; /* Darker blue for modal title */
            margin-bottom: 15px;
            font-size: 2em;
        }

        #tingkatKeparahanContainer {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            color: white;
            font-weight: bold;
        }

        #tingkatKeparahanContainer.parah {
            background-color: #f44336; /* Merah */
        }
        #tingkatKeparahanContainer.sedang {
            background-color: #ffc107; /* Kuning */
            color: #333;
        }
        #tingkatKeparahanContainer.ringan {
            background-color: #4caf50; /* Hijau */
        }

        #tingkatKeparahanContainer h3 {
            color: white;
            margin-top: 0;
            font-size: 1.6em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        #tingkatKeparahanContainer.sedang h3 {
             color: #333;
        }

        #tingkatKeparahanContainer p {
            font-size: 1.1em;
            line-height: 1.5;
        }

        .user-data-display {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            padding: 15px;
            background-color: #f0f8ff; /* Lightest blue */
            border-radius: 10px;
            border: 1px solid #e1f5fe;
        }

        .profile-image-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #2196f3;
            flex-shrink: 0;
        }

        .profile-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-data-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px 20px;
            flex-grow: 1;
        }

        .user-data-item .label {
            font-weight: 600;
            color: #555;
        }

        .user-data-item .value {
            color: #333;
        }

        .lifestyle-tips-section, .recommendation-section {
            background-color: #e8f5e9; /* Light green */
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #c8e6c9;
        }

        .lifestyle-tips-section h3, .recommendation-section h3 {
            color: #2e7d32; /* Dark green */
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .lifestyle-tips-section ul {
            list-style: disc inside;
            padding-left: 0;
            color: #444;
        }

        .lifestyle-tips-section li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .product-recommendations-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recommended-product-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }

        .recommended-product-card:hover {
            transform: translateY(-5px);
        }

        .recommended-product-card img {
            max-width: 100px;
            height: auto;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .recommended-product-card h4 {
            color: #3f51b5;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .recommended-product-card button {
            background-color: #2196f3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }

        .recommended-product-card button:hover {
            background-color: #1976d2;
        }

        .custom-cta-text {
            background-color: #ffe0b2; /* Light orange */
            color: #e65100; /* Dark orange */
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 1.1em;
            font-weight: 500;
            text-align: center;
            border: 1px solid #ffcc80;
        }

        .konsultasi-button-container {
            text-align: center;
            margin-top: 30px;
        }

        #konsultasiWaButtonModal {
            background-color: #25D366; /* WhatsApp green */
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 10px rgba(37, 211, 102, 0.4);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        #konsultasiWaButtonModal i {
            font-size: 1.5em;
        }

        #konsultasiWaButtonModal:hover {
            background-color: #1DA851;
            transform: translateY(-2px);
        }

        /* Product Carousel on Main Page */
        .product-carousel-wrapper {
            overflow-x: auto; /* Enable horizontal scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            padding-bottom: 15px; /* Space for scrollbar */
            margin-top: 20px;
        }

        .product-carousel {
            display: flex; /* Arrange items in a row */
            gap: 20px; /* Space between product cards */
            padding: 10px 0;
        }

        .product-card {
            flex: 0 0 auto; /* Do not grow, do not shrink, base size is auto */
            width: 180px; /* Fixed width for each card */
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .product-card.highlight {
            border: 2px solid #2196f3; /* Blue border for highlighted products */
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
            transform: translateY(-5px);
        }


        .product-card img {
            max-width: 120px;
            height: auto;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        .product-card h3 {
            font-size: 1.1em;
            color: #333;
            margin-top: 0;
            margin-bottom: 10px;
        }

        .product-card button {
            background-color: #03a9f4; /* Light blue */
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }

        .product-card button:hover {
            background-color: #0288d1;
        }

        /* Product Detail Modal specific styles */
        .product-detail-modal-content {
            text-align: center;
        }

        .product-detail-modal-content h3 {
            color: #2196f3;
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .product-detail-modal-content img {
            max-width: 200px;
            height: auto;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #eee;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .product-detail-modal-content .section-title {
            font-weight: bold;
            color: #555;
            margin-top: 20px;
            margin-bottom: 8px;
            font-size: 1.1em;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .product-detail-modal-content p,
        .product-detail-modal-content ul {
            text-align: left;
            color: #333;
            margin-bottom: 15px;
        }

        .product-detail-modal-content ul {
            list-style: disc inside;
            padding-left: 20px;
        }

        .product-detail-modal-content li {
            margin-bottom: 5px;
        }

        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            background-color: #e0f7fa;
            color: #555;
            font-size: 0.9em;
            border-top: 1px solid #b2ebf2;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                margin: 15px;
                padding: 20px;
            }

            .checkbox-grid {
                grid-template-columns: 1fr;
            }

            .user-data-details {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }

            #konsultasiWaButtonModal {
                padding: 12px 20px;
                font-size: 1em;
            }

            .product-carousel {
                justify-content: flex-start; /* Align items to the start for scrolling */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>CEK KESEHATAN LAMBUNG</h1>
        <h3>Nyeri Ulu Hati, Kembung dan Mual adalah gejala umum dari *Grastitis (Maag)*</h3>
        
        <div id="personalDataSection" class="form-section">
            <h2>Data Diri</h2>
            <div class="form-group">
                <label for="name">Nama Lengkap:</label>
                <input type="text" id="name" placeholder="Masukkan nama Anda">
            </div>
            <div class="form-group">
                <label for="age">Usia:</label>
                <input type="number" id="age" placeholder="Masukkan usia Anda">
            </div>
            <div class="form-group">
                <label for="gender">Jenis Kelamin:</label>
                <select id="gender">
                    <option value="">Pilih Jenis Kelamin</option>
                    <option value="pria">Pria</option>
                    <option value="wanita">Wanita</option>
                </select>
            </div>
            <div class="form-group">
                <label for="city">Asal Kota:</label>
                <input type="text" id="city" placeholder="Masukkan kota asal Anda">
            </div>
        </div>

        <div id="fisikSection" class="form-section hidden-section">
            <h2>Gejala Fisik yang Dialami</h2>
            <div id="fisikCheckboxesContainer" class="checkbox-grid">
                </div>
        </div>

        <div id="mentalSection" class="form-section hidden-section">
            <h2>Gejala Psikologi yang Dirasakan</h2>
            <div id="mentalCheckboxesContainer" class="checkbox-grid">
                </div>
        </div>

        <div id="durationSection" class="form-section hidden-section">
            <h2>Sudah berapa lama Anda mengalami gejala ini?</h2>
            <div class="form-group">
                <select id="duration">
                    <option value="">Pilih Durasi</option>
                    <option value="kurang-1-minggu">Kurang dari 1 minggu</option>
                    <option value="1-3-minggu">1 - 3 minggu</option>
                    <option value="1-3-bulan">1 - 3 bulan</option>
                    <option value="lebih-3-bulan">Lebih dari 3 bulan (tapi kurang dari 1 tahun)</option>
                    <option value="1-tahun">Sekitar 1 tahun</option>
                    <option value="2-tahun">Sekitar 2 tahun</option>
                    <option value="3-tahun">Sekitar 3 tahun</option>
                    <option value="lebih-3-tahun">Lebih dari 3 tahun</option>
                </select>
            </div>
        </div>

        <div class="button-container">
            <button id="cekButton">Cek Hasil</button>
        </div>

        <div class="form-section">
            <h2>Katalog Produk</h2>
            <div class="product-carousel-wrapper">
                <div id="productCarousel" class="product-carousel">
                    </div>
            </div>
        </div>
    </div>

    <div id="diagnosisResultModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeDiagnosisModalButton">&times;</span>
            <div id="modalDiagnosisContent">
                </div>
        </div>
    </div>

    <div id="productDetailModal" class="modal">
        <div class="modal-content product-detail-modal-content">
            <span class="close-button" id="closeProductModalButton">&times;</span>
            <h3 id="modalProductName"></h3>
            <img id="modalProductImage" src="" alt="Product Image">
            
            <p class="section-title">Deskripsi:</p>
            <p id="modalProductDescription"></p>
            
            <p class="section-title">Manfaat:</p>
            <ul id="modalProductBenefits"></ul>

            <div id="modalProductDosageSection" style="display: none;">
                <p class="section-title">Aturan Pakai:</p>
                <p id="modalProductDosage"></p>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>&copy; 2025 Diagnosa Kesehatan Lambung & Anxiety. All rights reserved.</p>
    </div>

    <script>
        // Data Produk Tiens
        const tiensProducts = [
            {
                id: "Zinc Capsules",
                name: "Tiens Zinc Capsules",
                image: "images/zink.jpg",
                fullDescription: "Zinc Capsules Tiens mengandung seng laktat, glukosa, dan bubuk protein telur. Zinc sangat penting untuk lebih dari 200 jenis enzim dalam tubuh, terlibat dalam sintesis asam nukleat dan protein, serta meningkatkan kekebalan tubuh. Ideal untuk perbaikan sel, pertumbuhan, dan fungsi hormonal, terutama untuk sistem pencernaan dan kekebalan.",
                benefits: [
                    "Meningkatkan nafsu makan",
                    "Membantu meningkatkan kekebalan tubuh",
                    "Mempercepat pertumbuhan dan perkembangan",
                    "Membantu menormalkan sekresi kelenjar pencernaan dan meningkatkan fungsi pencernaan",
                    "Mengoptimalkan penyerapan nutrisi",
                    "Penting untuk fungsi hormon reproduksi dan pertumbuhan",
                    "Membantu perbaikan sel dan jaringan tubuh"
                ],
                dosage: "Dewasa: 2x2 kapsul per hari. Anak-anak: 2x1 kapsul per hari. Diminum dengan air hangat.",
                type: "general_anxiety_gerd"
            },
            {
                id: "Chitin Chitosan Capsules",
                name: "Tiens Chitin Chitosan",
                image: "images/chitin.jpg",
                fullDescription: "Tiens Chitin Chitosan terbuat dari serat tempurung kepiting dan udang. Produk ini memiliki kemampuan unik untuk mengikat zat berbahaya, membersihkan saluran pencernaan, dan mendukung regenerasi sel. Sangat baik untuk detoksifikasi dan menjaga kesehatan lambung.",
                benefits: [
                    "Mengikat dan membuang racun serta logam berat dari tubuh",
                    "Melindungi mukosa lambung dan membantu regenerasi sel lambung",
                    "Membantu mengurangi keasaman lambung berlebih",
                    "Meningkatkan pergerakan usus dan melancarkan BAB",
                    "Menurunkan kadar kolesterol dan gula darah",
                    "Membantu penyembuhan luka dan peradangan"
                ],
                dosage: "2x2 kapsul per hari, 30 menit sebelum makan. Minum banyak air.",
                type: "gerd"
            },
            {
                id: "Nutrient Super Calcium Powder",
                name: "Tiens Nutrient Super Calcium Powder",
                image: "images/kal.jpg",
                fullDescription: "Tiens Nutrient Super Calcium Powder diformulasikan dengan kalsium organik berkadar tinggi yang mudah diserap tubuh. Tidak hanya untuk tulang, kalsium juga berperan penting dalam fungsi saraf, kontraksi otot, dan menjaga keseimbangan pH tubuh. Sangat baik untuk mengatasi masalah saraf terkait kecemasan dan memperbaiki kualitas tidur.",
                benefits: [
                    "Sumber kalsium tinggi yang mudah diserap",
                    "Membantu menenangkan saraf dan mengurangi kecemasan",
                    "Meningkatkan kualitas tidur",
                    "Mencegah osteoporosis dan menjaga kesehatan tulang",
                    "Mengatur detak jantung dan kontraksi otot",
                    "Menjaga keseimbangan pH tubuh (membantu menetralkan asam)",
                    "Meningkatkan transmisi impuls saraf"
                ],
                dosage: "1 bungkus per hari, diseduh dengan air hangat (60-70Â°C) sebelum tidur atau pagi hari.",
                type: "anxiety_gerd"
            },
        ];

        const allFisikSymptomsWithDetails = [
            { label: "Nyeri bagian ulu hati seperti ditekan", value: "Nyeri bagian ulu hati seperti ditekan", weight: 3, type: "gerd", critical: true, desc: "Nyeri ulu hati yang konstan dan menekan adalah gejala khas GERD yang mengindikasikan peradangan atau iritasi serius pada lapisan lambung atau kerongkongan. Ini memerlukan perhatian segera untuk mencegah kerusakan lebih lanjut." },
            { label: "Perut begah / kembung", value: "Perut begah / kembung", weight: 2, type: "gerd", desc: "Perut begah dan kembung sering disebabkan oleh gas berlebih akibat pencernaan yang tidak efisien, fermentasi makanan yang tidak sempurna, atau dismotilitas lambung. Ini sangat umum pada penderita GERD." },
            { label: "Dada terasa panas (heartburn)", value: "Dada terasa panas (heartburn)", weight: 3, type: "gerd", critical: true, desc: "Sensasi terbakar di dada adalah gejala klasik refluks asam (heartburn), menunjukkan asam lambung naik ke kerongkongan. Jika sering terjadi, ini dapat merusak lapisan kerongkongan dan menyebabkan komplikasi serius." },
            { label: "Asam naik ke tenggorokan / mulut pahit", value: "Asam naik ke tenggorokan / mulut pahit", weight: 3, type: "gerd", critical: true, desc: "Refluks asam ke tenggorokan atau mulut pahit adalah tanda jelas asam lambung mencapai area atas saluran pencernaan, berpotensi menyebabkan kerusakan gigi, suara serak, batuk kronis, dan sensasi terbakar yang parah." },
            { label: "Mual / muntah", value: "Mual/muntah", weight: 2, type: "gerd", desc: "Mual dan muntah dapat mengindikasikan iritasi lambung, gangguan pengosongan lambung (gastroparesis), atau bahkan respons tubuh terhadap stres dan kecemasan yang ekstrem. Ini mengganggu asupan nutrisi." },
            { label: "Sering sendawa", value: "Sering sendawa", weight: 1, type: "gerd", desc: "Sendawa berlebihan bisa disebabkan oleh menelan udara saat makan/minum cepat, atau merupakan respons terhadap gas berlebih di lambung akibat pencernaan yang tidak sempurna atau refluks." },
            { label: "Tenggorokan Gatal atau Batuk Kering", value: "Tenggorokan Gatal atau Batuk Kering", weight: 2, type: "gerd", desc: "Iritasi tenggorokan atau batuk kering kronis, terutama tanpa flu, seringkali merupakan gejala ekstra-esofageal GERD yang disebabkan oleh paparan asam lambung yang naik ke tenggorokan dan saluran napas." },
            { label: "Pusing / kleyengan", value: "Pusing / kleyengan", weight: 2, type: "anxiety", desc: "Sensasi pusing atau kleyengan, terutama yang bukan vertigo sejati, sering dikaitkan dengan hyperventilasi (napas cepat dan dangkal) atau respons panik akibat anxiety, mengganggu keseimbangan dan fokus." },
            { label: "Badan lemas seperti mau pingsan", value: "Badan lemas seperti mau pingsan", weight: 3, type: "anxiety", critical: true, desc: "Perasaan lemas yang ekstrem hingga seperti mau pingsan, tanpa sebab fisik jelas, adalah gejala umum serangan panik atau kecemasan berat. Ini sangat mengganggu aktivitas dan menimbulkan ketakutan." },
            { label: "Dada tertekan seperti Serangan Jantung", value: "Dada tertekan seperti Serangan Jantung", weight: 3, type: "anxiety", critical: true, desc: "Nyeri dada yang menekan, seringkali mirip gejala jantung, adalah salah satu manifestasi fisik paling menakutkan dari anxiety atau serangan panik. Ini memerlukan evaluasi medis untuk menyingkirkan kondisi jantung, namun seringkali murni psikosomatik." },
            { label: "Nafas Pendek/Berat saat Cemas", value: "Nafas Pendek/Berat saat Cemas", weight: 2, type: "anxiety", desc: "Sesak napas atau napas berat saat cemas (dyspnea) adalah gejala umum anxiety, seringkali akibat hyperventilasi. Ini menciptakan siklus ketakutan dan memperburuk sensasi fisik yang tidak nyaman." },
            { label: "Sering nyeri bagian perut kiri", value: "Sering nyeri bagian perut kiri", weight: 2, type: "gerd_anxiety", desc: "Nyeri perut kiri bisa berkaitan dengan berbagai kondisi, termasuk sindrom iritasi usus (IBS) yang sering diperparah oleh stres/anxiety, atau masalah lambung (GERD) yang memicu ketegangan di area tersebut. Butuh evaluasi lebih lanjut." }
        ];

        const allMentalSymptomsWithDetails = [
            { label: "Sering pikiran berlebihan / overthinking dimalam hari", value: "Sering pikiran berlebihan / overthinking dimalam hari", weight: 3, type: "anxiety", critical: true, desc: "Overthinking kronis, terutama di malam hari, adalah ciri khas anxiety yang mengganggu kualitas tidur, menyebabkan kelelahan mental, dan memperpanjang siklus stres. Ini secara langsung memperburuk anxiety dan berpotensi memicu atau memperparah masalah lambung (brain-gut axis)." },
            { label: "Sering gelisah tanpa alasan", value: "Sering gelisah tanpa alasan", weight: 3, type: "anxiety", critical: true, desc: "Kegelisahan kronis tanpa pemicu jelas adalah inti dari gangguan kecemasan umum (GAD), menyebabkan ketidaknyamanan mental dan fisik yang konstan. Ini sangat menguras energi dan berdampak buruk pada kesehatan fisik, termasuk pencernaan." },
            { label: "Sulit tidur", value: "Sulit tidur", weight: 2, type: "anxiety", desc: "Insomnia atau kesulitan tidur adalah gejala umum baik pada anxiety maupun GERD. Kurang tidur memperburuk stres, peradangan di tubuh, mengganggu regenerasi sel lambung, dan meningkatkan tingkat kecemasan, menciptakan lingkaran setan." },
            { label: "Sering merasa takut atau panik", value: "Sering merasa takut atau panik", weight: 3, type: "anxiety", critical: true, desc: "Perasaan takut yang intens atau serangan panik yang sering adalah indikator anxiety yang signifikan, membatasi aktivitas sosial dan pribadi, serta menurunkan kualitas hidup secara drastis. Serangan panik dapat meniru gejala penyakit fisik serius." },
            { label: "Bangun tidur dengan rasa cemas", value: "Bangun tidur dengan rasa cemas", weight: 3, type: "anxiety", critical: true, desc: "Membangunkan diri dengan perasaan cemas menunjukkan tingkat stres yang tinggi dan ketidakmampuan tubuh untuk rileks bahkan saat tidur. Ini membuat hari terasa berat sejak awal dan mengganggu produktivitas." },
            { label: "Makan sedikit namun cepat kenyang", value: "Makan sedikit namun cepat kenyang", weight: 2, type: "gerd", desc: "Rasa cepat kenyang dengan porsi sedikit bisa disebabkan oleh gastroparesis (pengosongan lambung yang lambat), lambung yang sangat sensitif, atau tekanan gas. Ini umum pada GERD kronis dan berpotensi menyebabkan kekurangan gizi serta penurunan berat badan yang tidak diinginkan." },
            { label: "Ketergantungan pada obat-obatan", value: "Ketergantungan pada obat-obatan", weight: 3, type: "general", critical: true, desc: "Ketergantungan pada obat-obatan (baik itu obat lambung seperti PPI jangka panjang, atau penenang) menunjukkan bahwa gejala Anda sudah sangat mengganggu dan tubuh mungkin sudah membangun toleransi. Ini memerlukan penanganan holistik dan seringkali pengawasan medis untuk mengurangi ketergantungan." },
            { label: "Stres ringan", value: "Stres ringan", weight: 1, type: "anxiety", desc: "Stres ringan adalah respons normal terhadap tekanan hidup, namun jika tidak dikelola dapat berkembang menjadi kecemasan yang lebih serius dan memicu gejala fisik." } // NEW: Tambahan gejala stres ringan
        ];

        // Durasi baru dengan bobot yang disesuaikan
        const durationWeights = {
            "kurang-1-minggu": 1,
            "1-3-minggu": 2,
            "1-3-bulan": 3,
            "lebih-3-bulan": 4,
            "1-tahun": 5,
            "2-tahun": 6,
            "3-tahun": 7,
            "lebih-3-tahun": 8
        };

        // Global variables to store selected symptoms for WhatsApp message
        let selectedSymptomsDetails = {
            fisik: "",
            mental: ""
        };
        let currentRecommendationProducts = [];
        let currentLifestyleTips = [];
        let currentDiagnosisResultText = "";
        let currentSymptomAnalysisList = []; // New array to store detailed symptom analysis
        let currentGeneralCharacteristics = []; // New: Stores overall characteristics for WA message
        let currentFinalNote = "";
        let currentCtaMessage = ""; // New variable for CTA


        // Get section elements
        const nameInput = document.getElementById('name');
        const genderSelect = document.getElementById('gender');
        const cityInput = document.getElementById('city');
        const ageInput = document.getElementById('age');
        const fisikSection = document.getElementById('fisikSection');
        const mentalSection = document.getElementById('mentalSection');
        const durationSection = document.getElementById('durationSection');
        const durationSelect = document.getElementById('duration');


        // Function to render checkboxes dynamically
        function renderCheckboxes(containerId, data, nameAttribute, checkedValues = []) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error(`Container with ID ${containerId} not found.`);
                return;
            }
            container.innerHTML = ''; // Clear existing checkboxes

            data.forEach(item => {
                const checkboxId = `${nameAttribute}-${item.value.replace(/\s+/g, '-').replace(/[<>\/]/g, '')}`; // Clean ID
                const isChecked = checkedValues.includes(item.value);
                const checkboxItemDiv = document.createElement('div');
                checkboxItemDiv.classList.add('checkbox-item');
                if (isChecked) {
                    checkboxItemDiv.classList.add('checked');
                }

                checkboxItemDiv.innerHTML = `
                    <input type="checkbox" id="${checkboxId}" name="${nameAttribute}" value="${item.value}" ${isChecked ? 'checked' : ''}>
                    <label for="${checkboxId}">${item.label}</label>
                `;
                container.appendChild(checkboxItemDiv);

                // Add event listener to div to toggle checkbox and class
                checkboxItemDiv.addEventListener('click', (event) => {
                    // Only toggle if the click target is the div or label, not the checkbox itself
                    if (event.target === checkboxItemDiv || event.target.tagName === 'LABEL') {
                        const checkbox = checkboxItemDiv.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked; // Toggle the checkbox state
                        checkboxItemDiv.classList.toggle('checked', checkbox.checked); // Toggle the class
                        checkFormProgress(); // Recalculate progress on any change
                    }
                });
            });
        }

        // Function to display Tiens products in the carousel
        function displayTiensProducts(highlightedProductIds = []) {
            const productCarousel = document.getElementById('productCarousel');
            if (!productCarousel) {
                console.error("Elemen 'productCarousel' tidak ditemukan!");
                return;
            }
            productCarousel.innerHTML = ''; // Clear existing products

            tiensProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');
                if (highlightedProductIds.includes(product.id)) {
                    productCard.classList.add('highlight');
                }
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}">
                    <h3>${product.name}</h3>
                    <button onclick="showProductModal('${product.id}', false)">Lihat Detail</button> `;
                productCarousel.appendChild(productCard);
            });
        }

        // Function to check form progress and show/hide sections
        function checkFormProgress() {
            const nameValid = nameInput.value.trim() !== '';
            const genderValid = genderSelect.value !== '';
            const cityValid = cityInput.value.trim() !== '';
            const umur = parseInt(ageInput.value);
            const umurValid = !isNaN(umur) && umur > 0;

            // All personal data must be valid to show next section
            if (nameValid && genderValid && cityValid && umurValid) {
                fisikSection.classList.remove('hidden-section');
                renderCheckboxes('fisikCheckboxesContainer', allFisikSymptomsWithDetails, 'gejala',
                    Array.from(document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]:checked')).map(cb => cb.value)
                );
            } else {
                fisikSection.classList.add('hidden-section');
                document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]').forEach(cb => cb.checked = false);
            }

            const selectedFisikCheckboxes = Array.from(document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]:checked'));
            const selectedFisikCount = selectedFisikCheckboxes.length;

            const currentMentalChecked = Array.from(document.querySelectorAll('#mentalCheckboxesContainer input[name="mental"]:checked')).map(cb => cb.value);

            if (selectedFisikCount > 0 && nameValid && genderValid && cityValid && umurValid) {
                mentalSection.classList.remove('hidden-section');
                let relevantMentalSymptoms = allMentalSymptomsWithDetails;

                const isAnxietyRelatedFisik = selectedFisikCheckboxes.some(symptom =>
                    ["Pusing / kleyengan", "Badan lemas seperti mau pingsan", "Dada tertekan seperti Serangan Jantung", "Nafas Pendek/Berat saat Cemas", "Sering nyeri bagian perut kiri"].includes(symptom.value)
                );
                const isGastricRelatedFisik = selectedFisikCheckboxes.some(symptom =>
                    ["Nyeri bagian ulu hati seperti ditekan", "Perut begah / kembung", "Dada terasa panas (heartburn)", "Asam naik ke tenggorokan / mulut pahit", "Mual / muntah", "Sering sendawa", "Tenggorokan Gatal atau Batuk Kering"].includes(symptom.value)
                );

                if (isAnxietyRelatedFisik && !isGastricRelatedFisik) {
                    relevantMentalSymptoms = allMentalSymptomsWithDetails.filter(symptom =>
                        symptom.type === "anxiety" || symptom.type === "general"
                    );
                } else if (isGastricRelatedFisik && !isAnxietyRelatedFisik) {
                    relevantMentalSymptoms = allMentalSymptomsWithDetails.filter(symptom =>
                        symptom.type === "gerd" || symptom.type === "general"
                    );
                }
                // If both or neither, show all mental symptoms
                renderCheckboxes('mentalCheckboxesContainer', relevantMentalSymptoms, 'mental', currentMentalChecked);

            } else {
                mentalSection.classList.add('hidden-section');
                document.querySelectorAll('#mentalCheckboxesContainer input[name="mental"]').forEach(cb => cb.checked = false);
            }

            if (selectedFisikCount > 0 && currentMentalChecked.length > 0 && nameValid && genderValid && cityValid && umurValid) {
                durationSection.classList.remove('hidden-section');
            } else {
                durationSection.classList.add('hidden-section');
                durationSelect.value = "";
            }
        }

        // Event listeners for form fields to trigger checkFormProgress
        nameInput.addEventListener('input', checkFormProgress);
        genderSelect.addEventListener('change', checkFormProgress);
        cityInput.addEventListener('input', checkFormProgress);
        ageInput.addEventListener('input', checkFormProgress);

        // Event listeners for checkbox sections to trigger checkFormProgress
        document.getElementById('fisikCheckboxesContainer').addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'gejala') {
                checkFormProgress();
            }
        });
        document.getElementById('mentalCheckboxesContainer').addEventListener('change', (event) => {
            if (event.target.type === 'checkbox' && event.target.name === 'mental') {
                checkFormProgress();
            }
        });
        durationSelect.addEventListener('change', checkFormProgress);


        // JavaScript logika Diagnosa Keparahan dan Rekomendasi
        function calculateSeverity() {
            const nameEl = document.getElementById("name");
            const genderEl = document.getElementById("gender");
            const cityEl = document.getElementById("city");
            const ageEl = document.getElementById("age");

            const name = nameEl.value.trim();
            const gender = genderEl.value;
            const city = cityEl.value.trim();
            const umur = parseInt(ageEl.value);

            const fisikCheckboxes = Array.from(document.querySelectorAll('#fisikCheckboxesContainer input[name="gejala"]:checked'));
            const mentalCheckboxes = Array.from(document.querySelectorAll('#mentalCheckboxesContainer input[name="mental"]:checked'));

            const durasiEl = document.getElementById("duration");
            const durasiValue = durasiEl.value;
            const durasiText = durasiEl.options[durasiEl.selectedIndex].text; // Get the displayed text for WA message

            // --- Validasi yang Lebih Jelas dan Komprehensif ---
            let firstInvalidElement = null;

            if (name === '') {
                alert("Mohon masukkan Nama Lengkap Anda.");
                firstInvalidElement = nameEl;
            } else if (gender === '') {
                alert("Mohon pilih Jenis Kelamin Anda.");
                firstInvalidElement = genderEl;
            } else if (city === '') {
                alert("Mohon masukkan Asal Kota Anda.");
                firstInvalidElement = cityEl;
            } else if (isNaN(umur) || umur <= 0) {
                alert("Mohon masukkan usia Anda dengan benar (angka positif).");
                firstInvalidElement = ageEl;
            } else if (fisikCheckboxes.length === 0) {
                alert("Mohon pilih setidaknya satu gejala di bagian 'Gejala Fisik yang Dialami'.");
                firstInvalidElement = fisikSection;
            } else if (mentalCheckboxes.length === 0) {
                alert("Mohon pilih setidaknya satu gejala di bagian 'Gejala Psikologi yang Dirasakan'.");
                firstInvalidElement = mentalSection;
            } else if (!durasiValue) {
                alert("Mohon pilih durasi gejala di bagian 'Sudah berapa lama Anda mengalami gejala ini?'.");
                firstInvalidElement = durasiEl;
            }

            if (firstInvalidElement) {
                if (firstInvalidElement.scrollIntoView) {
                    firstInvalidElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                if (firstInvalidElement.focus) { // Try to focus for input/select elements
                    firstInvalidElement.focus();
                }
                return; // Stop function execution if validation fails
            }
            // --- Akhir Validasi ---

            let totalScore = 0; // Tetap hitung total skor untuk referensi, tapi penentuan keparahan lebih kualitatif
            let gerdScore = 0;
            let anxietyScore = 0;

            // List to store detailed descriptions for analysis (for WA message, not displaying on web)
            currentSymptomAnalysisList = [];
            currentGeneralCharacteristics = []; // Reset general characteristics for each new calculation

            // Track critical symptoms and general impact for severity determination
            let hasCriticalGerdSymptom = false;
            let hasCriticalAnxietySymptom = false;
            let hasSignificantImpact = false; // Based on critical impacts
            let longDurationFactor = 0; // 0 for <3 months, 1 for 3-12 months, 2 for >1 year

            // Process Fisik Symptoms
            let selectedGejalaFisikLabels = [];
            let selectedFisikValues = fisikCheckboxes.map(cb => cb.value); // Get values for easier checking
            fisikCheckboxes.forEach(checkbox => {
                const symptom = allFisikSymptomsWithDetails.find(s => s.value === checkbox.value);
                if (symptom) {
                    totalScore += symptom.weight;
                    selectedGejalaFisikLabels.push(symptom.label);
                    currentSymptomAnalysisList.push(symptom.desc);
                    if (symptom.type === "gerd") gerdScore += symptom.weight;
                    else if (symptom.type === "anxiety") anxietyScore += symptom.weight;
                    else if (symptom.type === "gerd_anxiety") { gerdScore += symptom.weight / 2; anxietyScore += symptom.weight / 2; }
                    if (symptom.critical) hasCriticalGerdSymptom = true;
                }
            });

            // Process Mental Symptoms
            let selectedGejalaMentalLabels = [];
            let selectedMentalValues = mentalCheckboxes.map(cb => cb.value); // Get values for easier checking
            mentalCheckboxes.forEach(checkbox => {
                const symptom = allMentalSymptomsWithDetails.find(s => s.value === checkbox.value);
                if (symptom) {
                    totalScore += symptom.weight;
                    selectedGejalaMentalLabels.push(symptom.label);
                    currentSymptomAnalysisList.push(symptom.desc);
                    if (symptom.type === "gerd") gerdScore += symptom.weight;
                    else if (symptom.type === "anxiety") anxietyScore += symptom.weight;
                    else if (symptom.type === "general") totalScore += symptom.weight; // General contribute to total, not specific sub-score for recommendation
                    if (symptom.critical) hasCriticalAnxietySymptom = true;
                }
            });

            // Process Duration
            totalScore += durationWeights[durasiValue] || 0;
            if (durasiValue === "lebih-3-tahun" || durasiValue === "3-tahun") {
                longDurationFactor = 2;
                currentSymptomAnalysisList.push("Durasi gejala yang sudah sangat lama ini menunjukkan kondisi yang persisten dan kronis, membutuhkan penanganan serius untuk mencegah kerusakan jangka panjang atau keparahan lebih lanjut. Ini bisa menjadi tanda masalah yang lebih dalam.");
            } else if (durasiValue === "1-tahun" || durasiValue === "2-tahun") {
                longDurationFactor = 1;
                currentSymptomAnalysisList.push("Durasi gejala selama ini menandakan bahwa kondisi Anda sudah cukup mengakar dan perlu penanganan konsisten agar tidak menjadi kronis. Gejala mungkin sudah sering muncul.");
            } else if (durasiValue === "1-3-bulan" || durasiValue === "lebih-3-bulan") {
                currentSymptomAnalysisList.push("Gejala yang Anda rasakan sudah berlangsung beberapa bulan, menunjukkan bahwa kondisi ini perlu perhatian serius agar tidak berkembang menjadi lebih parah atau kronis.");
            } else {
                   currentSymptomAnalysisList.push("Gejala yang Anda alami masih relatif baru. Ini adalah waktu yang tepat untuk melakukan intervensi agar kondisi tidak memburuk.");
            }


            // --- Penentuan Tingkat Keparahan (Berdasarkan Klasifikasi Baru) ---
            let severityText = "";
            let summaryText = "";
            let severityClass = "";
            let productsToRecommend = [];
            let lifestyleTips = [];
            let diagnosisName = ""; // New variable for the specific diagnosis name

            // Function to check if a set of symptoms is present (all symptoms in the array must be selected)
            const hasFisik = (symptoms) => symptoms.every(s => selectedFisikValues.includes(s));
            const hasMental = (symptoms) => symptoms.every(s => selectedMentalValues.includes(s));
            
            // Define common products and tips
            const commonProductsGerdAnxiety = [
                { id: "Chitin Chitosan Capsules", name: "Tiens Chitin Chitosan" },
                { id: "Zinc Capsules", name: "Tiens Zinc Capsules" },
                { id: "Nutrient Super Calcium Powder", name: "Tiens Nutrient Super Calcium Powder" }
            ];

            const commonProductsGerd = [
                { id: "Chitin Chitosan Capsules", name: "Tiens Chitin Chitosan" },
                { id: "Zinc Capsules", name: "Tiens Zinc Capsules" }
            ];

            const commonLifestyleTipsParah = [
                "Wajib konsultasi medis (dokter spesialis) untuk evaluasi menyeluruh dan penanganan yang terarah, serta ahli gizi untuk diet khusus lambung yang ketat dan terpersonalisasi.",
                "Terapkan teknik relaksasi mendalam (meditasi, yoga, mindful breathing) setiap hari secara konsisten untuk menenangkan sistem saraf.",
                "Hindari semua pemicu lambung dan anxiety secara total: kafein, alkohol, rokok, makanan olahan, serta pastikan tidak begadang dan kelola stres dengan sangat serius.",
                "Prioritaskan tidur berkualitas 7-9 jam per malam dan bangun/tidur pada waktu yang sama setiap hari. Ciptakan rutinitas tidur yang menenangkan.",
                "Cari dukungan psikologis (terapi kognitif, konseling, atau psikiater) jika diperlukan untuk mengatasi anxiety berat dan dampaknya pada fungsi harian Anda."
            ];

            const commonLifestyleTipsSedang = [
                "Tinjau ulang diet Anda: hindari makanan pemicu (pedas, asam, berlemak, kafein, soda). Makan porsi kecil tapi sering.",
                "Kelola stres dengan teknik pernapasan dalam, meditasi singkat, atau hobi yang menenangkan.",
                "Prioritaskan tidur yang cukup dan berkualitas. Hindari gadget sebelum tidur.",
                "Lakukan aktivitas fisik ringan hingga sedang secara teratur (misal: jalan kaki 30 menit setiap hari).",
                "Pertimbangkan untuk berbicara dengan profesional kesehatan mental jika kecemasan terasa sulit dikelola sendiri."
            ];

            const commonLifestyleTipsRingan = [
                "Atur kembali pola makan: hindari telat makan, makan porsi berlebihan, dan makan terlalu cepat. Utamakan makanan yang dimasak sederhana dan mudah dicerna.",
                "Kurangi konsumsi makanan pedas, asam, berlemak, serta minuman berkafein dan bersoda secara bertahap. Perhatikan apa yang memicu gejala Anda.",
                "Coba olahraga ringan secara rutin (misal: jalan santai, peregangan ringan) untuk meningkatkan mood, metabolisme, dan melancarkan pencernaan.",
                "Pastikan tidur cukup 7-8 jam setiap malam untuk mendukung pemulihan tubuh dan menenangkan pikiran.",
                "Identifikasi dan kelola pemicu stres utama Anda dengan teknik relaksasi dasar atau aktivitas yang menyenangkan."
            ];


            // Define symptom sets for each severity level
            // PARAH Logic
            const parahFisikSymptomsRequired = [
                "Nyeri bagian ulu hati seperti ditekan", "Dada terasa panas (heartburn)", "Mual/muntah",
                "Tenggorokan Gatal atau Batuk Kering", "Badan lemas seperti mau pingsan", "Nafas Pendek/Berat saat Cemas",
                "Perut begah / kembung", "Asam naik ke tenggorokan / mulut pahit", "Pusing / kleyengan",
                "Dada tertekan seperti Serangan Jantung", "Sering nyeri bagian perut kiri"
            ];
            const parahMentalSymptomsRequired = [
                "Sering pikiran berlebihan / overthinking dimalam hari", "Sulit tidur",
                "Bangun tidur dengan rasa cemas", "Sering gelisah tanpa alasan", "Sering merasa takut atau panik"
            ];

            // SEDANG Logic
            const sedangFisikSymptomsRequired = [
                "Nyeri bagian ulu hati seperti ditekan", "Dada terasa panas (heartburn)",
                "Asam naik ke tenggorokan / mulut pahit", "Pusing / kleyengan",
                "Dada tertekan seperti Serangan Jantung", "Badan lemas seperti mau pingsan"
            ];
            const sedangMentalSymptomsRequired = [
                "Sering pikiran berlebihan / overthinking dimalam hari", "Sulit tidur",
                "Makan sedikit namun cepat kenyang"
            ];

            // RINGAN Logic
            const ringanFisikSymptomsRequired = [
                "Perut begah / kembung", "Mual/muntah", "Sering sendawa",
                "Sering nyeri bagian perut kiri", "Tenggorokan Gatal atau Batuk Kering"
            ];
            const ringanMentalSymptomsRequired = [
                "Makan sedikit namun cepat kenyang",
                "Ketergantungan pada obat-obatan", // Although critical, user wants it in ringan classification
                "Stres ringan" // NEW: Added this symptom
            ];


            // Determine severity based on the classification rules
            if (hasFisik(parahFisikSymptomsRequired) && hasMental(parahMentalSymptomsRequired)) {
                severityText = "Parah";
                severityClass = "parah";
                diagnosisName = "GERD Anxiety";
                summaryText = `Kondisi Anda terindikasi *${diagnosisName}* dengan tingkat keparahan yang *serius*. Gejala fisik dan psikologis yang Anda alami sangat signifikan dan sudah mengganggu kualitas hidup secara drastis. Ada risiko komplikasi jika tidak ditangani segera.`;
                currentGeneralCharacteristics.push("Anda mengalami kombinasi gejala fisik dan psikologis yang signifikan, menunjukkan GERD dan Anxiety berada pada fase serius. Gejala ini sangat memengaruhi kualitas hidup Anda.");
                currentGeneralCharacteristics.push("Indikator kuat GERD parah terlihat dari nyeri ulu hati yang menekan, asam yang sering naik hingga tenggorokan, dan/atau mual/muntah kronis, yang menandakan iritasi lambung yang sudah lanjut dan potensi kerusakan organ.");
                currentGeneralCharacteristics.push("Tingkat anxiety yang parah ditandai dengan serangan panik, ketakutan berlebihan yang konstan, sulit beraktivitas normal, dan kecenderungan menarik diri dari sosial. Ini memerlukan penanganan serius.");
                currentGeneralCharacteristics.push("Dampak pada kualitas hidup Anda, seperti penurunan berat badan tanpa sebab jelas, atau kesulitan melakukan aktivitas sehari-hari, adalah alarm bahwa kondisi ini sangat mendesak untuk ditangani.");
                if (longDurationFactor === 2) {
                    currentGeneralCharacteristics.push(`Durasi gejala yang sudah *lebih dari 3 tahun* mengindikasikan kondisi kronis yang sangat sulit ditangani jika tidak ada perubahan drastis.`);
                }
                currentCtaMessage = "Penanganan khusus dan komprehensif sangat mendesak. Segera konsultasi untuk mencegah komplikasi yang lebih serius.";
                productsToRecommend = commonProductsGerdAnxiety;
                lifestyleTips = commonLifestyleTipsParah;

            } else if (hasFisik(sedangFisikSymptomsRequired) && hasMental(sedangMentalSymptomsRequired)) {
                severityText = "Sedang";
                severityClass = "sedang";
                diagnosisName = "GERD";
                summaryText = `Kondisi Anda terindikasi *${diagnosisName}*. Gejala GERD dan anxiety Anda mulai mengganggu fungsi harian dan muncul cukup sering. Bila terus dibiarkan, ada potensi kuat untuk berkembang menjadi kronis dan sulit dikendalikan.`;
                currentGeneralCharacteristics.push("Anda mengalami gejala GERD dan Anxiety yang cukup sering dan mulai memengaruhi rutinitas harian Anda.");
                currentGeneralCharacteristics.push("Gejala lambung seperti heartburn yang sering, perut begah berkepanjangan, atau mual menunjukkan adanya iritasi yang perlu ditangani segera agar tidak memburuk.");
                currentGeneralCharacteristics.push("Kecemasan sering muncul dalam bentuk overthinking, sulit tidur, atau kegelisahan yang mengganggu konsentrasi dan aktivitas.");
                if (longDurationFactor === 1) {
                    currentGeneralCharacteristics.push(`Durasi gejala sekitar ${durasiText} menunjukkan bahwa kondisi ini membutuhkan perhatian serius agar tidak memburuk menjadi kronis.`);
                }
                currentGeneralCharacteristics.push("Pola hidup kurang sehat seperti telat makan, begadang, atau konsumsi pemicu lambung dan stres sering memperburuk kondisi Anda.");
                currentCtaMessage = "Langkah cepat saat ini akan mencegah kondisi memburuk dan memudahkan pemulihan. Jangan tunda penanganan.";
                productsToRecommend = commonProductsGerd;
                // Add Calcium if anxiety/sleep symptoms are present
                if (selectedGejalaMentalLabels.some(s => ["Sulit tidur", "Sering pikiran berlebihan / overthinking dimalam hari", "Bangun tidur dengan rasa cemas", "Sering gelisah tanpa alasan", "Sering merasa takut atau panik", "Stres ringan"].includes(s))) {
                    if (!productsToRecommend.some(p => p.id === "Nutrient Super Calcium Powder")) {
                        productsToRecommend.push({ id: "Nutrient Super Calcium Powder", name: "Tiens Nutrient Super Calcium Powder" });
                    }
                }
                lifestyleTips = commonLifestyleTipsSedang;

            } else if (hasFisik(ringanFisikSymptomsRequired) || hasMental(ringanMentalSymptomsRequired)) { // If any of the ringan symptoms are present
                severityText = "Ringan";
                severityClass = "ringan";
                diagnosisName = "Maag (Gastritis)";
                summaryText = `Gejala yang Anda alami tergolong *${diagnosisName}* dengan tingkat keparahan *ringan* dan muncul sesekali. Ini adalah kesempatan terbaik untuk melakukan penyesuaian gaya hidup dan mencegahnya bertambah parah.`;
                currentGeneralCharacteristics.push("Gejala Anda masih pada tahap awal dan muncul sesekali, belum mengganggu aktivitas harian secara signifikan. Ini adalah kesempatan terbaik untuk intervensi dini.");
                currentGeneralCharacteristics.push("Keluhan lambung mungkin berupa sendawa berlebihan atau perut begah setelah makan tertentu, yang bisa dipicu oleh pola makan tidak teratur.");
                currentGeneralCharacteristics.push("Kecemasan mungkin hanya berupa sedikit overthinking atau sulit tidur sesekali, yang belum sampai memicu serangan panik.");
                currentGeneralCharacteristics.push(`Durasi gejala yang ${durasiText} menunjukkan kondisi ini masih sangat baru dan responsif terhadap perubahan gaya hidup sederhana.`);
                currentGeneralCharacteristics.push("Beberapa kebiasaan kurang sehat seperti telat makan, konsumsi kopi/soda sesekali, atau kurang olahraga dapat menjadi pemicu yang bisa dihindari.");
                currentCtaMessage = "Jangan biarkan gejala kecil berkembang jadi masalah besar. Ambil tindakan sekarang untuk menjaga kesehatan Anda.";
                productsToRecommend = commonProductsGerd; // Zinc and Chitin for Maag
                // Add Calcium if sleep/mild anxiety symptoms are present
                if (selectedGejalaMentalLabels.some(s => s === "Sulit tidur" || s === "Sering pikiran berlebihan / overthinking dimalam hari" || s === "Stres ringan")) {
                    if (!productsToRecommend.some(p => p.id === "Nutrient Super Calcium Powder")) {
                        productsToRecommend.push({ id: "Nutrient Super Calcium Powder", name: "Tiens Nutrient Super Calcium Powder" });
                    }
                }
                lifestyleTips = commonLifestyleTipsRingan;
            } else {
                // Default case if no specific pattern matched, but symptoms were selected
                // This acts as a final fallback for "Ringan" if other classifications aren't met but symptoms exist.
                // This handles scenarios where combinations don't exactly match the strict lists above.
                if (selectedFisikValues.length > 0 || selectedMentalValues.length > 0) {
                     severityText = "Ringan";
                     severityClass = "ringan";
                     diagnosisName = "Maag (Gastritis)"; // Default to Maag if not GERD or GERD Anxiety
                     summaryText = `Gejala yang Anda alami tergolong *${diagnosisName}* dengan tingkat keparahan *ringan* dan muncul sesekali. Ini adalah kesempatan terbaik untuk melakukan penyesuaian gaya hidup dan mencegahnya bertambah parah.`;
                     currentGeneralCharacteristics.push("Gejala Anda masih pada tahap awal dan muncul sesekali, belum mengganggu aktivitas harian secara signifikan. Ini adalah kesempatan terbaik untuk intervensi dini.");
                     currentGeneralCharacteristics.push("Keluhan lambung mungkin berupa sendawa berlebihan atau perut begah setelah makan tertentu, yang bisa dipicu oleh pola makan tidak teratur.");
                     currentGeneralCharacteristics.push("Kecemasan mungkin hanya berupa sedikit overthinking atau sulit tidur sesekali, yang belum sampai memicu serangan panik.");
                     currentGeneralCharacteristics.push(`Durasi gejala yang ${durasiText} menunjukkan kondisi ini masih sangat baru dan responsif terhadap perubahan gaya hidup sederhana.`);
                     currentGeneralCharacteristics.push("Beberapa kebiasaan kurang sehat seperti telat makan, konsumsi kopi/soda sesekali, atau kurang olahraga dapat menjadi pemicu yang bisa dihindari.");
                     currentCtaMessage = "Jangan biarkan gejala kecil berkembang jadi masalah besar. Ambil tindakan sekarang untuk menjaga kesehatan Anda.";
                     productsToRecommend = commonProductsGerd;
                     if (selectedGejalaMentalLabels.some(s => s === "Sulit tidur" || s === "Sering pikiran berlebihan / overthinking dimalam hari" || s === "Stres ringan")) {
                         if (!productsToRecommend.some(p => p.id === "Nutrient Super Calcium Powder")) {
                             productsToRecommend.push({ id: "Nutrient Super Calcium Powder", name: "Tiens Nutrient Super Calcium Powder" });
                         }
                     }
                     lifestyleTips = commonLifestyleTipsRingan;
                } else {
                    // This case should ideally not be hit due to initial validation, but as a safeguard
                    severityText = "Tidak Terdiagnosis";
                    severityClass = "none";
                    diagnosisName = "Tidak Terdiagnosis";
                    summaryText = "Mohon pilih gejala yang Anda alami untuk mendapatkan diagnosa.";
                    currentGeneralCharacteristics = [];
                    currentSymptomAnalysisList = [];
                    currentCtaMessage = "";
                    productsToRecommend = [];
                    lifestyleTips = [];
                }
            }
            
            // Update global variable for WhatsApp message
            selectedSymptomsDetails.fisik = selectedGejalaFisikLabels.length > 0 ? selectedGejalaFisikLabels.join(", ") : "-";
            selectedSymptomsDetails.mental = selectedGejalaMentalLabels.length > 0 ? selectedGejalaMentalLabels.join(", ") : "-";
            
            // Store the text of the selected duration for the WA message
            selectedSymptomsDetails.durationText = durasiText;


            currentRecommendationProducts = productsToRecommend;
            currentLifestyleTips = lifestyleTips;
            currentDiagnosisResultText = summaryText; // This is the short summary


            // --- HTML untuk Data Diri Pengguna di Hasil Diagnosa ---
            const genderDisplay = gender === 'pria' ? 'Pria' : (gender === 'wanita' ? 'Wanita' : '-');
            // Choose profile image based on gender
            const profileImageSrc = (gender === 'pria') ? 'images/pria.jpg' : ( (gender === 'wanita') ? 'images/wanita.jpg' : 'https://i.ibb.co/x7Y0Yp2/default-profile.png'); // Updated with more appealing profile images

            const userProfileHTML = `
                <div class="user-data-display">
                    <div class="profile-image-container">
                        <img src="${profileImageSrc}" alt="User Profile Picture">
                    </div>
                    <div class="user-data-details">
                        <div class="user-data-item">
                            <span class="label">Nama:</span>
                            <span class="value">${name}</span>
                        </div>
                        <div class="user-data-item">
                            <span class="label">Usia:</span>
                            <span class="value">${umur} tahun</span>
                        </div>
                        <div class="user-data-item">
                            <span class="label">Gender:</span>
                            <span class="value">${genderDisplay}</span>
                        </div>
                        <div class="user-data-item">
                            <span class="label">Kota:</span>
                            <span class="value">${city}</span>
                        </div>
                    </div>
                </div>
            `;
            // --- Akhir HTML untuk Data Diri Pengguna ---

            // Render Lifestyle Tips (moved up)
            let lifestyleTipsHTML = ``;
            if (lifestyleTips.length > 0) {
                lifestyleTipsHTML = `<div class="lifestyle-tips-section">
                    <h3>Saran Pola Hidup & Pola Makan</h3>
                    <ul>`;
                lifestyleTips.forEach(tip => {
                    lifestyleTipsHTML += `<li>${tip}</li>`;
                });
                lifestyleTipsHTML += `</ul></div>`;
            }

            // Render Product Recommendations
            let productRecommendationsHTML = ``;
            if (productsToRecommend.length > 0) {
                productRecommendationsHTML = `<div class="recommendation-section">
                    <h3>Saran Produk Tiens (Rekomendasi Penanganan)</h3>
                    <div class="product-recommendations-container">`;
                productsToRecommend.forEach(rec => {
                    const product = tiensProducts.find(p => p.id === rec.id);
                    const imageUrl = product ? product.image : '';
                    const productName = product ? product.name : rec.name;

                    productRecommendationsHTML += `
                                <div class="recommended-product-card">
                                    <img src="${imageUrl}" alt="${productName}" />
                                    <div class="product-details">
                                        <h4>${productName}</h4>
                                        <button onclick="showProductModal('${rec.id}', true)">Lihat Detail</button>
                                    </div>
                                </div>
                            `;
                });
                productRecommendationsHTML += `</div></div>`; // Close recommendation-section here
            }

            // Custom CTA text
            const customCtaTextHTML = `<div class="custom-cta-text">${currentCtaMessage}</div>`;

            // NEW: Fill the Diagnosis Result Modal content
            const modalDiagnosisContent = document.getElementById("modalDiagnosisContent");
            if (!modalDiagnosisContent) {
                console.error("Elemen 'modalDiagnosisContent' tidak ditemukan!");
                return;
            }

            modalDiagnosisContent.innerHTML = `
                <div class="analysis-results-card" style="display: block;">
                    <h2>Hasil Diagnosa Kesehatan Lambung</h2>
                    ${userProfileHTML}
                    <div id="tingkatKeparahanContainer" class="${severityClass}">
                        <h3>Tingkat Keparahan: <span id="tingkatKeparahanText">${severityText}</span></h3>
                        <p id="summaryDescriptionText">${summaryText}</p>
                    </div>
                    ${lifestyleTipsHTML}
                    ${productRecommendationsHTML}
                    ${customCtaTextHTML}
                    <div class="konsultasi-button-container">
                        <button id="konsultasiWaButtonModal">
                            <i class="fab fa-whatsapp"></i> Konsultasi via WhatsApp
                        </button>
                    </div>
                </div>
            `;
            
            // Event listener for the WhatsApp button INSIDE the modal
            const konsultasiWaButtonModal = document.getElementById('konsultasiWaButtonModal');
            if (konsultasiWaButtonModal) {
                konsultasiWaButtonModal.addEventListener('click', () => {
                    const whatsappNumber = '6285721368380';
                    const message = generateWhatsAppMessage();
                    window.open(`https://wa.me/${whatsappNumber}?text=${message}`, '_blank');
                });
            } else {
                console.error("Tombol 'konsultasiWaButtonModal' tidak ditemukan!");
            }


            // Show the diagnosis result modal
            const diagnosisResultModal = document.getElementById('diagnosisResultModal');
            diagnosisResultModal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scrolling of background when modal is open

            // Ensure product carousel at the bottom of the main page is still updated
            displayTiensProducts(productsToRecommend.map(p => p.id));
        }

        // Fungsi untuk membuat pesan WhatsApp
        function generateWhatsAppMessage() {
            const name = document.getElementById("name").value.trim();
            const gender = document.getElementById("gender").value;
            const city = document.getElementById("city").value.trim();
            const umur = document.getElementById("age").value;
            // Get severity text from the modal content after it's been rendered
            const severityText = document.querySelector('#modalDiagnosisContent #tingkatKeparahanText').innerText;
            const durasiTextForWA = selectedSymptomsDetails.durationText || document.getElementById('duration').options[document.getElementById('duration').selectedIndex].text; // Fallback


            let message = `Halo, saya ingin berkonsultasi mengenai kesehatan lambung dan anxiety saya.\n\n`;
            message += `*Data Diri:*\n`;
            message += `Nama: ${name}\n`;
            message += `Jenis Kelamin: ${gender.charAt(0).toUpperCase() + gender.slice(1)}\n`;
            message += `Asal Kota: ${city}\n`;
            message += `Usia: ${umur} tahun\n`;
            message += `Durasi Gejala: ${durasiTextForWA}\n`;
            message += `Tingkat Keparahan: *${severityText}*\n\n`;

            if (selectedSymptomsDetails.fisik && selectedSymptomsDetails.fisik !== "-") {
                message += `*Gejala Fisik yang Dialami:*\n${selectedSymptomsDetails.fisik}\n\n`;
            }
            if (selectedSymptomsDetails.mental && selectedSymptomsDetails.mental !== "-") {
                message += `*Gejala Psikologi yang Dirasakan:*\n${selectedSymptomsDetails.mental}\n\n`;
            }

            message += `*Ringkasan Diagnosa:*\n${currentDiagnosisResultText}\n\n`;
            
            // Detailed symptom analysis for WhatsApp message (STILL INCLUDED FOR WA MESSAGE)
            if (currentSymptomAnalysisList.length > 0) {
                message += `*Analisis Mendalam Gejala yang Anda Rasakan:*\n`;
                currentSymptomAnalysisList.forEach(char => {
                    message += `â¢ ${char}\n`;
                });
                message += `\n`;
            }

            if (currentGeneralCharacteristics.length > 0) {
                message += `*Karakteristik Umum Kondisi Anda:*\n`;
                currentGeneralCharacteristics.forEach(char => {
                    message += `â¢ ${char}\n`;
                });
                message += `\n`;
            }


            if (currentLifestyleTips.length > 0) {
                message += `*Saran Pola Hidup & Pola Makan:*\n`;
                currentLifestyleTips.forEach(tip => {
                    const cleanedTip = tip.replace(/<\/?(strong|em|b|i)[^>]*>/g, '').replace(/<[^>]*>?/gm, ''); // Remove any lingering HTML tags
                    message += `â¢ ${cleanedTip}\n`;
                });
                message += `\n`;
            }

            if (currentRecommendationProducts.length > 0) {
                message += `*Saran Produk Tiens:*\n`;
                currentRecommendationProducts.forEach(rec => {
                    const product = tiensProducts.find(p => p.id === rec.id);
                    message += `â¢ ${rec.name} ${product && product.dosage ? `(Aturan Pakai: ${product.dosage})` : ''}\n`;
                });
                message += `\n`;
            }

            if (currentCtaMessage) {
                message += `*Pesan Penting:*\n_${currentCtaMessage}_\n\n`;
            }
            
            message += `*Konsultasi gratis via WA: 085721368380*`;

            return encodeURIComponent(message);
        }


        // --- MODAL (POP-UP) LOGIC untuk Detail Produk ---
        const productDetailModal = document.getElementById('productDetailModal');
        const closeModalButton = document.getElementById('closeProductModalButton'); // Renamed ID
        const modalProductName = document.getElementById('modalProductName');
        const modalProductImage = document.getElementById('modalProductImage');
        const modalProductDescription = document.getElementById('modalProductDescription');
        const modalProductBenefits = document.getElementById('modalProductBenefits');
        const modalProductDosageElement = document.getElementById('modalProductDosage');
        const modalProductDosageSection = document.getElementById('modalProductDosageSection');

        function showProductModal(productId, isRecommendation = false) {
            const product = tiensProducts.find(p => p.id === productId);
            if (!product) {
                console.error(`Product with ID ${productId} not found.`);
                return;
            }

            modalProductName.textContent = product.name;
            modalProductImage.src = product.image;
            modalProductImage.alt = product.name;
            modalProductDescription.textContent = product.fullDescription;
            
            if (modalProductDosageSection) {
                if (isRecommendation) {
                    modalProductDosageSection.style.display = 'block';
                    modalProductDosageElement.textContent = product.dosage || "Tidak ada informasi aturan pakai.";
                } else {
                    modalProductDosageSection.style.display = 'none';
                }
            }

            modalProductBenefits.innerHTML = '';
            if (product.benefits && product.benefits.length > 0) {
                product.benefits.forEach(benefit => {
                    const li = document.createElement('li');
                    li.textContent = benefit;
                    modalProductBenefits.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = "Tidak ada manfaat spesifik yang tercatat.";
                modalProductBenefits.appendChild(li);
            }

            // Show product detail modal (this will naturally layer on top due to higher z-index)
            productDetailModal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Keep body scroll locked
        }

        function closeProductModal() {
            productDetailModal.classList.remove('active');
            // Only unlock body scroll if the diagnosis modal is also closed
            // If the diagnosis modal is still active, it should control the body overflow
            const diagnosisResultModal = document.getElementById('diagnosisResultModal');
            if (!diagnosisResultModal.classList.contains('active')) {
                document.body.style.overflow = '';
            }
        }

        closeModalButton.addEventListener('click', closeProductModal);
        productDetailModal.addEventListener('click', (event) => {
            if (event.target === productDetailModal) {
                closeProductModal();
            }
        });
        // --- END MODAL LOGIC untuk Detail Produk ---


        // --- NEW: MODAL LOGIC untuk Hasil Diagnosa ---
        const diagnosisResultModal = document.getElementById('diagnosisResultModal');
        const closeDiagnosisModalButton = document.getElementById('closeDiagnosisModalButton');

        function closeDiagnosisResultModal() {
            diagnosisResultModal.classList.remove('active');
            document.body.style.overflow = ''; // Unlock body scroll when diagnosis modal is closed
        }

        closeDiagnosisModalButton.addEventListener('click', closeDiagnosisResultModal);
        diagnosisResultModal.addEventListener('click', (event) => {
            if (event.target === diagnosisResultModal) {
                closeDiagnosisResultModal();
            }
        });
        // --- END NEW: MODAL LOGIC untuk Hasil Diagnosa ---


        document.addEventListener('DOMContentLoaded', () => {
            displayTiensProducts();

            const cekButton = document.getElementById('cekButton');
            if (cekButton) {
                cekButton.addEventListener('click', () => {
                    calculateSeverity();
                });
            } else {
                console.error("Tombol 'cekButton' tidak ditemukan!");
            }
            
            // Initial render of checkboxes and progress check
            renderCheckboxes('fisikCheckboxesContainer', allFisikSymptomsWithDetails, 'gejala');
            checkFormProgress();

            // Ensure grid class is applied to checkbox containers
            document.getElementById('fisikCheckboxesContainer').classList.add('checkbox-grid');
            document.getElementById('mentalCheckboxesContainer').classList.add('checkbox-grid');
        });
    </script>
</body>
</html>